/* ==================================================
#Featured collection
#Featured promotions
#Slideshow
#Testimonials
#Gallery
#Video
#Cart
#Product
#Header
#Map
#Global accordions

/*============================================================================
  Featured collection
==============================================================================*/

var CollectionListSection = {
    init: function(){
      $('.js-collection-slider .products-slider').each(function (index, value) {
        var products_per_slide = $(this).data('products-per-slide');
        var products_limit = $(this).data('products-limit');
        var products_available = $(this).data('products-available');
        var cellAlign,
            draggable,
            prevNext,
            wrapAround,
            initialIndex;
  
      // function to check if browser is IE
      var isIE11 = !!navigator.userAgent.match(/Trident.*rv\:11\./);
  
      // Ensure product media libraries are present
      /*if (!isIE11) {
        window.Shopify.loadFeatures([
          {
            name: 'model-viewer',
            version: '0.8'
          },
          {
            name: 'shopify-xr',
            version: '1.0',
          },
          {
            name: 'model-viewer-ui',
            version: '1.0',
          }
        ], productMedia.setupMedia)
      }*/
  
        if (products_per_slide == "2" && products_available > products_per_slide && products_limit > products_per_slide || products_per_slide == "4" && products_available > products_per_slide && products_limit > products_per_slide || products_per_slide == "6" && products_available > products_per_slide && products_limit > products_per_slide){
          cellAlign = "left";
        } else {
          cellAlign = "center";
        }
  
        if (products_available > products_per_slide && products_limit > products_per_slide) {
          draggable = true;
          prevNext = true;
          wrapAround = true;
        } else {
          draggable = false;
          prevNext = false;
          wrapAround = false;
        }
  
        if (products_per_slide == "2" && products_available > products_per_slide || products_per_slide == "4" && products_available > products_per_slide || products_per_slide == "6" && products_available > products_per_slide){
          initialIndex = 0;
        } else if (products_per_slide == "3" && products_available) {
          initialIndex = 1;
        } else if (products_per_slide == "5" && products_available) {
          initialIndex = 2;
        } else if (products_per_slide == "7" && products_available) {
          initialIndex = 3;
        }
  
        if (Shopify.media_queries.medium.matches) {
          cellAlign = "center";
          draggable = true;
          prevNext = true;
          wrapAround = true;
          initialIndex = 1;
  
          $(this).parents('.even-num-slides').removeClass('even-num-slides');
        }
        $(this).flickity({
          "lazyLoad": 2,
          "imagesLoaded": true,
          "draggable": true,
          "prevNextButtons": prevNext,
          "wrapAround": wrapAround,
          "cellAlign": cellAlign,
          "pageDots": usePageDots,
          "contain": true,
          "freeScroll": true,
          "arrowShape": arrowSize,
          "initialIndex": initialIndex
        });
  
        $(this).addClass('slider-initialized');
      });
    },
    unload: function($target){
      var $slider = $target.find('.js-collection-slider');
      if ($slider.hasClass('flickity-enabled')){
        $slider.flickity('destroy');
      }
    }
  }
  
  var featuredCollectionSection = {
    init: function(){
      $('.js-product-slider .products-slider').each(function (index, value) {
        var products_per_slide = $(this).data('products-per-slide');
        var products_limit = $(this).data('products-limit');
        var products_available = $(this).data('products-available');
        var cellAlign,
            draggable,
            prevNext,
            wrapAround,
            initialIndex;
  
      // function to check if browser is IE
      var isIE11 = !!navigator.userAgent.match(/Trident.*rv\:11\./);
  
      // Ensure product media libraries are present
      /*if (!isIE11) {
        window.Shopify.loadFeatures([
          {
            name: 'model-viewer',
            version: '0.8'
          },
          {
            name: 'shopify-xr',
            version: '1.0',
          },
          {
            name: 'model-viewer-ui',
            version: '1.0',
          }
        ], productMedia.setupMedia)
      }*/
  
        if (products_per_slide == "2" && products_available > products_per_slide && products_limit > products_per_slide || products_per_slide == "4" && products_available > products_per_slide && products_limit > products_per_slide || products_per_slide == "6" && products_available > products_per_slide && products_limit > products_per_slide){
          cellAlign = "left";
        } else {
          cellAlign = "center";
        }
  
        if (products_available > products_per_slide && products_limit > products_per_slide) {
          draggable = true;
          prevNext = true;
          wrapAround = true;
        } else {
          draggable = false;
          prevNext = false;
          wrapAround = false;
        }
  
        if (products_per_slide == "2" && products_available > products_per_slide || products_per_slide == "4" && products_available > products_per_slide || products_per_slide == "6" && products_available > products_per_slide){
          initialIndex = 0;
        } else if (products_per_slide == "3" && products_available) {
          initialIndex = 1;
        } else if (products_per_slide == "5" && products_available) {
          initialIndex = 2;
        } else if (products_per_slide == "7" && products_available) {
          initialIndex = 3;
        }
  
        if (Shopify.media_queries.medium.matches) {
          cellAlign = "center";
          draggable = true;
          prevNext = true;
          wrapAround = true;
          initialIndex = 1;
  
          $(this).parents('.even-num-slides').removeClass('even-num-slides');
        }
  
        $(this).flickity({
          "lazyLoad": 2,
          "imagesLoaded": true,
          "draggable": draggable,
          "prevNextButtons": prevNext,
          "wrapAround": wrapAround,
          "cellAlign": cellAlign,
          "pageDots": usePageDots,
          "contain": true,
          "freeScroll": true,
          "arrowShape": arrowSize,
          "initialIndex": initialIndex
        });
  
        $(this).addClass('slider-initialized');
      });
    },
    unload: function($target){
      var $slider = $target.find('.js-product-slider');
      if ($slider.hasClass('flickity-enabled')){
        $slider.flickity('destroy');
      }
    }
  }
  
  /*============================================================================
    Featured promotions
  ==============================================================================*/
  var featuredPromotions = {
    init: function(){
      $('.feature-overlay').hover(function() {
        $(this).find('.feature-details').slideDown('100', function() {
          $(this).addClass('reveal-details');
        });
      }, function() {
        $(this).find('.feature-details').removeClass('reveal-details');
        $(this).find('.feature-details').slideUp('100');
      });
  
      $('.js-featured-promotions').each(function (index, value) {
        var $promos = $(this);
        var animationStyle = $(this).data('promo-animation');
  
        $promos.waypoint(function() {
          $(this.element).find('.feature-section').addClass("animated " + animationStyle);
        }, { offset: '80%' });
      });
    }
  }
  
  /*============================================================================
    Slideshow
  ==============================================================================*/
  
  var slideshow = {
    init: function(){
  
      $('.js-homepage-slideshow').each(function (index, value){
        var $homepageSlider = $(this);
        var settings = {
          slideshowSpeed: $homepageSlider.data('slideshow-speed')*1000,
          slideshowTextAnimation: $homepageSlider.data('slideshow-text-animation'),
          adaptiveHeight: $homepageSlider.data('adaptive-height')
        }
  
        //initiate the slideshow
        if (!$homepageSlider.hasClass('flickity-enabled')){
          var arrowShow = $homepageSlider.find('.gallery-cell').length === 1 ? false : true;
          $homepageSlider.flickity({
                      wrapAround: false,
                      cellAlign: 'left',
                      prevNextButtons: arrowShow,
                      draggable: arrowShow,
                      pageDots: usePageDots,
                      autoPlay: settings.slideshowSpeed,
                      arrowShape: arrowSize
                    });
  
          // if (settings.slideshowTextAnimation != ''){
          //   var flkty = $homepageSlider.data('flickity');
          //   setTimeout(function() {
          //     $homepageSlider.find('.gallery-cell:nth-child(1) .caption-content').addClass('animated ' + settings.slideshowTextAnimation);
          //   }, 400);
  
          //   $homepageSlider.on( 'select.flickity', function() {
          //     if($homepageSlider.is(':visible')) {
          //       var currentSlide = flkty.selectedIndex + 1;
          //       setTimeout(function() {
          //         $homepageSlider.find('.caption-content').removeClass('animated ' + settings.slideshowTextAnimation);
          //         $homepageSlider.find('.gallery-cell:nth-child(' + currentSlide + ') .caption-content').addClass('animated ' + settings.slideshowTextAnimation);
          //       }, 400);
          //     }
          //   });
          // }
        }
  
        if ($homepageSlider.find('.gallery-cell').length > 1) {
          $homepageSlider.addClass('multi-image');
        } else {
          $homepageSlider.addClass('single-image');
        }
  
        $homepageSlider.find('.gallery-cell').each(function(){
          var buttonWidth = 0;
          $(this).find('.action_button').each(function(){
            $button = $(this);
            if($(this).width() > buttonWidth){
                buttonWidth = $(this).width();
            }
          });
          $(this).find('.action_button').width(buttonWidth);
        });
  
      });
    },
    unload: function($target){
  
      var $slider = $target.find('.js-homepage-slideshow');
      $slider.flickity('destroy');
  
    }
  }
  
  /*============================================================================
    Testimonials
  ==============================================================================*/
  
  var testimonial = {
    init: function(){
  
      $('.js-testimonial').each(function (index, value){
        var $testimonialSlider = $(this);
        var settings = {
          slideshowSpeed: $testimonialSlider.data('slideshow-speed')*1000,
          slideshowTextAnimation: $testimonialSlider.data('slideshow-text-animation')
        }
  
        if( $('.testimonial-image').length > 0){
          $('.testimonial-block').each(function(){
            if( $(this).find('.testimonial-image').length == 0){
              var theBlock = $(this).closest('.testimonial-block');
              $(theBlock).addClass('set-testimonial-height');
            }
          })
        }
  
        //initiate the slideshow
        if (!$testimonialSlider.hasClass('flickity-enabled')){
          var arrowShow = $testimonialSlider.find('.gallery-cell').length === 1 ? false : true;
          $testimonialSlider.flickity({
                          wrapAround: true,
                          cellAlign: 'left',
                          imagesLoaded: true,
                          prevNextButtons: arrowShow,
                          draggable: arrowShow,
                          pageDots: true,
                          autoPlay: settings.slideshowSpeed,
                          arrowShape: arrowSize
                        });
  
          if (settings.slideshowTextAnimation != ''){
            var flkty = $testimonialSlider.data('flickity');
            setTimeout(function() {
              $testimonialSlider.find('.gallery-cell:nth-child(1) .caption-content').addClass('animated ' + settings.slideshowTextAnimation);
            }, 400);
  
            $testimonialSlider.on( 'select.flickity', function() {
              if($testimonialSlider.is(':visible')) {
                var currentSlide = flkty.selectedIndex + 1;
                setTimeout(function() {
                  $testimonialSlider.find('.caption-content').removeClass('animated ' + settings.slideshowTextAnimation);
                  $testimonialSlider.find('.gallery-cell:nth-child(' + currentSlide + ') .caption-content').addClass('animated ' + settings.slideshowTextAnimation);
                }, 400);
              }
            });
          }
        }
  
        if ($testimonialSlider.find('.gallery-cell').length > 1) {
          $testimonialSlider.addClass('multi-image');
        } else {
          $testimonialSlider.addClass('single-image');
        }
  
        $testimonialSlider.find('.gallery-cell').each(function(){
          var buttonWidth = 0;
          $(this).find('.action_button').each(function(){
            $button = $(this);
            if($(this).width() > buttonWidth){
                buttonWidth = $(this).width();
            }
          });
          $(this).find('.action_button').width(buttonWidth);
        });
  
      });
    },
    unload: function($target){
      var $slider = $target.find('.js-testimonial');
  
      $slider.flickity('destroy');
  
    }
  }
  
  /*============================================================================
    Gallery
  ==============================================================================*/
  
  var gallery = {
    init: function(){
  
      $('.gallery-horizontal').find('.gallery-image-wrapper').each(function(){
          var wrapper = $(this);
          var images = $(this).find("img");
          var imgWidth,
              imgHeight;
  
          $("<img />").attr("src", $(images).attr("src")).on('load', function() {
            imgWidth = this.width;
            imgHeight = this.height;
  
            $(wrapper).css("flex-basis", imgWidth * 200 / imgHeight);
            $(wrapper).css("flex-grow", imgWidth * 200 / imgHeight);
            $(wrapper).find("i").css("padding-bottom", imgHeight / imgWidth * 100 + '%');
        });
      });
  
    if ($('[rel=gallery]').length) {
      $('[rel=gallery]').fancybox({
        baseClass: "gallery-section__lightbox",
        clickContent: "nextOrClose"
      })
    }
  
    }
  }
  
  /*============================================================================
    Video
  ==============================================================================*/
  var videoSection = {
    init: function() {
  
      // Set up plyr for newly embedded video
      var featuredVideos = $('[data-video-element]').get();
  
      var featuredVideoPlayers = Plyr.setup(featuredVideos, {
        controls: videoControls,
        fullscreen: {
          enabled: true,
          fallback: true,
          iosNative: true
        },
        storage: {
          enabled: false
        }
      });
  
      // Adds plyr video id to video wrapper
      $.each(featuredVideoPlayers, function(index, player) {
        var id = player.id;
        var $video;
  
        if (player.isHTML5) {
          $video = $(player.elements.wrapper).find('video');
          $video.attr('data-plyr-video-id', id);
        }
  
        // When a video is playing, pause any other instances
        player.on('play', function(event) {
          var instance = event.detail.plyr;
          $.each(featuredVideoPlayers, function(index, player) {
            if (instance.id != player.id) {
              player.pause();
            }
          })
        })
  
        // Moves players from video section into global array
        if (globalVideoPlayers) {
          globalVideoPlayers.push(player);
        }
      })
  
      $('[data-video-element]').each(function(index, video) {
  
        // Variables
        var $video = $(video);
        var $section = $video.parents('.shopify-section').attr('id', id);
        var $videoElement = $section.find($video);
        var $videoWrapper = $videoElement.parents('.video-wrapper');
        var $playButton = $videoWrapper.find('[data-play-button]');
        var $secondaryButton = $videoWrapper.find('[data-secondary-button]');
        var $videoText = $videoWrapper.find('[data-video-text]');
        var $videoTextContainer = $videoWrapper.find('[data-video-text-container]');
        var $image = $videoWrapper.find('.video-wrapper__image');
        var $posterImage = $videoWrapper.data('poster-image-uploaded');
        var aspectRatio = $videoWrapper.data('aspect-ratio');
        var id = $videoWrapper.data('video-src');
        var isAutoplay = $videoWrapper.data('autoplay');
        var isLoopingEnabled = $videoWrapper.data('autoloop');
        var isMuted = $videoWrapper.data('mute-video');
  
        $.each(featuredVideoPlayers, function(index, player) {
          var videoID;
          var playerID;
  
          if (player.isYouTube || player.isVimeo) {
            var videoID = $videoWrapper.attr('id');
            var playerID = $(player.elements.original).attr('id');
          } else if (player.isHTML5) {
            var videoID = $videoWrapper.find('[data-plyr-video-id]').data('plyr-video-id');
            var playerID = player.id;
            $videoElement = $section.find('.plyr--video');
          }
  
          if (playerID == videoID) {
  
            // Reset play button icon
            $videoWrapper.removeClass('play-button-icon--visible');
  
            // Autoplay
            if (isAutoplay) {
              // If on desktop or player is YouTube/Vimeo
              if (Shopify.media_queries.large.matches || player.isYouTube || player.isVimeo) {
  
                player.autoplay = true;
  
                // Hide image
                $image.hide();
  
                // Show video
                $videoElement.show();
  
                // If display text over video unchecked
                if ($videoTextContainer.hasClass('display-text-over-video--false')) {
                  $videoText.hide();
                } else {
                  $videoText.show();
                }
  
                // Keep play button hidden
                $playButton.hide();
  
                // HTML5 Mobile Video
              } else if (Shopify.media_queries.medium.matches && player.isHTML5) {
  
                // Hide image
                $image.hide();
  
                // Show video
                $videoElement.show();
  
                // Display button so that video can be played
                $playButton.show();
  
                player.on('play', function() {
                  // Show video
                  $videoElement.show();
  
                  // Hide play button
                  $playButton.hide();
                })
              }
            } else { // If Autoplay disabled
              // If poster image, show image wrapper otherwise hide it
              if ($posterImage) {
                $image.show();
                $videoElement.hide();
              } else {
                $videoElement.show();
              }
            }
  
            // Clicking image will play video
            $image.on('click', function() {
              // Hide image
              $(this).hide();
  
              // Show video
              $videoElement.show();
  
              player.play();
            })
  
            // Muted
            if (isMuted) {
              player.muted = true;
            }
  
            // Aspect Ratio
            if (aspectRatio) {
              player.ratio = aspectRatio;
            }
  
            // Looping
            if (isLoopingEnabled) {
              player.loop = true;
            }
  
            // Show Video Controls
            // - video controls get hidden using a css class: '.video-controls-enabled--false'
  
            // If button exists, hide text and poster
            if ($playButton) {
              $playButton.on('click', function() {
  
                // Play video
                player.play();
              })
            }
  
            player.on('play', function() {
  
              // Hide image
              $image.hide();
  
              // Reset play button icon
              $videoWrapper.removeClass('play-button-icon--visible');
  
              // Show video
              $videoElement.show();
  
              // If display text over video unchecked
              if ($videoTextContainer.hasClass('display-text-over-video--false')) {
                $videoTextContainer.hide();
              } else {
                $videoTextContainer.show();
              }
  
              // Hide play button
              if ($playButton) {
                $playButton.hide();
              }
  
              // Hide secondary button
              if ($secondaryButton) {
                $secondaryButton.hide();
              }
            })
  
            // If video is paused, show play button icon
            player.on('pause', function() {
              if ($playButton.is(':hidden') || $playButton.length == 0) {
                $videoWrapper.addClass('play-button-icon--visible');
              }
            })
  
            // If page loads with video paused and no button showing, show icon
            if (!player.playing && $playButton.is(':hidden') || $playButton.length == 0) {
              $videoWrapper.addClass('play-button-icon--visible');
            }
  
            return false;
          }
        })
      })
    }
  }
  
  /*============================================================================
    Cart
  ==============================================================================*/
  var cart = {
    init: function(){
      if ($('#cart_form .tos_agree').length) {
        //Terms of service on cart page
        $('body').on('click', "#cart_form input[type='submit']", function() {
          if ($(this).parents('form').find('.tos_agree').is(':checked')) {
            $(this).submit();
          } else {
            var warning = '<p class="warning animated bounceIn">' + Shopify.translation.agree_to_terms_warning + '</p>';
            if ($('p.warning').length == 0) {
              $(this).before(warning);
            }
            return false;
          }
        });
      }
    }
  }
  
  /*============================================================================
    Product
  ==============================================================================*/
  
  selectCallback = function(variant, selector) {
  
    var $product = $('.product-' + selector.product.id);
    var $notify_form = $('.notify-form-' + selector.product.id);
    var $productForm = $('.product_form, .shopify-product-form', $product);
    var variantInventory = $productForm.data('variant-inventory');
  
    var $notifyFormInputs = $('.notify_form__inputs');
  
    var notifyEmail = Shopify.translation.notify_email;
    var notifyEmailValue = "{{ contact.fields.email }}";
    var notifySend = Shopify.translation.notify_email_send;
  
    var notifyUrl = $notifyFormInputs.data('url');
  
    if (variant) {
      if (variant.title != null) {
      // Escape variant titles
        var variantTitle = variant.title.replace(/"/g,'\&quot;');
  
        var notifyMessage = Shopify.translation.notify_message_first + variantTitle + Shopify.translation.notify_message_last + notifyUrl;
      }
    } else {
      var notifyMessage = Shopify.translation.notify_message_first + Shopify.translation.notify_message_last + notifyUrl;
    }
  
    if ($notifyFormInputs.hasClass('customer--true')) {
      var notifyCustomerEmail = "{{ customer.email }}";
      var notifyEmailInput = '<input type="hidden" class="notify_email" name="contact[email]" id="contact[email]" value="'+ notifyCustomerEmail +'" />'
    } else {
      var notifyEmailInput = '<input required type="email" class="notify_email" name="contact[email]" id="contact[email]" placeholder="'+ notifyEmail +'" value="'+ notifyEmailValue +'" />';
    }
    var notifyFormHTML = notifyEmailInput+'<input type="hidden" name="challenge" value="false" /><input type="hidden" name="contact[body]" class="notify_form_message" data-body="'+ notifyMessage +'" value="'+ notifyMessage +'" /><input class="action_button" type="submit" value="'+ notifySend + '" style="margin-bottom:0px" />';
  
    //Image Variant feature
    if (variant && variant.featured_image && $product.is(":visible")) {
      var $sliders = $('.js-product-gallery, .js-gallery-modal', $product);
      $sliders.each(function() {
        var $slider = $(this);
        var $sliderInstance = Flickity.data(this);
        if ($slider.is(":visible") && $sliderInstance != undefined ) {
          var index = $('[data-image-id="' + variant.featured_media.id + '"]').data('index');
          $sliderInstance.select( index, false, true );
        }
      });
    }
  
    if (variant) {
      if (variantInventory) {
        variantInventory.forEach(function(v){
          if (v.id === variant.id) {
            variant.inventory_quantity = v.inventory_quantity;
            variant.inventory_management = v.inventory_management;
            variant.inventory_policy = v.inventory_policy;
          }
        });
      }
  
      $('.sku span', $product).text(variant.sku);
  
      if (Shopify.theme_settings.product_form_style == 'swatches'){
        for (var i=0,length=variant.options.length; i<length; i++) {
          var radioButton = $productForm.find('.swatch[data-option-index="' + escape(i) + '"] :radio[value="' + variant.options[i].replace(/\"/g,'\\"') +'"]');
          if (radioButton.length) {
            radioButton.get(0).checked = true;
          }
        }
      } else {
        $(".notify_form_message", $product).attr("value", $(".notify_form_message", $product).data('body') + " - " + variantTitle);
      }
    }
  
    if (variant && variant.available == true) {
      if(variant.price < variant.compare_at_price){
        $('.was_price', $product).html('<span class="money">' + Shopify.formatMoney(variant.compare_at_price, $('body').data('money-format')) + '</span>');
        $('.savings', $product).html(Shopify.translation.savings_text + ' ' + parseInt(((variant.compare_at_price - variant.price) * 100) / variant.compare_at_price) + '% (' + '<span class="money">' + Shopify.formatMoney(variant.compare_at_price - variant.price, $('body').data('money-format')) + '</span>)');
        $('.current_price', $product).parent().addClass('sale');
      } else {
        $('.was_price', $product).html('');
        $('.savings', $product).html('');
        $('.current_price', $product).parent().removeClass('sale');
      }
  
      if (variant.inventory_management && variant.inventory_quantity > 0) {
        if (Shopify.theme_settings.display_inventory_left){
          if (variant.inventory_quantity == 1) {
            items_left_text = Shopify.translation.one_item_left;
          } else {
            items_left_text = Shopify.translation.items_left_text;
          }
  
          var inventoryThreshold = parseInt(Shopify.theme_settings.inventory_threshold);
          if (variant.inventory_quantity <= inventoryThreshold ) {
            $('.items_left', $product).html(variant.inventory_quantity + " " + items_left_text);
          } else {
            $('.items_left', $product).html("");
          }
        }
        if (Shopify.theme_settings.limit_quantity){
          if(variant.inventory_policy == "deny") {
            $('.quantity', $product).attr('max', variant.inventory_quantity);
          }
        }
      } else {
        $('.items_left', $product).text('');
        $('.quantity', $product).removeAttr('max');
      }
  
      $('.sold_out', $product).text('');
      if (variant.price > 0) {
        $('.current_price', $product).removeClass('sold_out').html('<span class="money">' + Shopify.formatMoney(variant.price, $('body').data('money-format')) + '</span>');
      } else {
        $('.current_price', $product).removeClass('sold_out').html(Shopify.theme_settings.free_text);
      }
      $('.add_to_cart', $product).removeClass('disabled').removeAttr('disabled').find('span').text($('.add_to_cart', $product).data('label'));
      $('.shopify-payment-button', $product).removeClass('disabled');
      $('.purchase-details__buttons', $product).removeClass('product-is-unavailable');
      $('.modal_price', $product).removeClass('variant-unavailable');
      $notify_form.hide();
      $notifyFormInputs.empty();
    } else {
      // When product is sold out
      var message = variant ? Shopify.theme_settings.sold_out_text : Shopify.translation.unavailable_text;
  
      if (variant){
        // Adds correct price
        if (variant.price > 0) {
          $('.current_price', $product).html('<span class="money">' + Shopify.formatMoney(variant.price, $('body').data('money-format')) + '</span>');
        } else {
          $('.current_price', $product).html(Shopify.theme_settings.free_text);
        }
        if (Shopify.theme_settings.display_sold_out_price){
          $('.current_price', $product).parents('.price__container--display-price-true').addClass('has-margin-right');
        }
        $('.modal_price', $product).removeClass('variant-unavailable');
      } else {
        // Add class to quickshop so we know variant is unavailable
        $('.modal_price', $product).addClass('variant-unavailable');
        $('.current_price', $product).html('');
        $('.was_price', $product).html('');
        $('.savings', $product).html('');
        $('.current_price', $product).parents('.price__container--display-price-true').removeClass('has-margin-right');
      }
  
      // If show price setting disabled, hide price, compare at price and savings
      if (!Shopify.theme_settings.display_sold_out_price){
        $('.current_price', $product).html('');
        $('.was_price', $product).html('');
        $('.savings', $product).html('');
      }
  
      $('.items_left', $product).text('');
      $('.quantity', $product).removeAttr('max');
      $('.sold_out', $product).text(message);
      $('.purchase-details__buttons', $product).addClass('product-is-unavailable');
      $('.add_to_cart', $product).addClass('disabled').attr('disabled', 'disabled').find('span').text(message);
      $('.shopify-payment-button').addClass('disabled');
      $notify_form.hide();
      $notifyFormInputs.empty();
  
      if (variant && !variant.available) {
        $notify_form.fadeIn();
        $notifyFormInputs.empty();
        $notifyFormInputs.append(notifyFormHTML);
      }
    }
  
    if (Currency.show_multiple_currencies) {
      currencyConverter.convertCurrencies();
    }
  };
  
  var productPage = {
    init: function(){
  
      // function to check if browser is IE
      var isIE11 = !!navigator.userAgent.match(/Trident.*rv\:11\./);
  
      // Ensure product media libraries are present
      if (!isIE11) {
        window.Shopify.loadFeatures([
          {
            name: 'model-viewer',
            version: '0.8'
          },
          {
            name: 'shopify-xr',
            version: '1.0',
          },
          {
            name: 'model-viewer-ui',
            version: '1.0',
          }
        ], productMedia.setupMedia)
      }
  
      if($('.js-full-width-product-images').length){
        imageFunctions.fullWidth('.product-template .product .description img', '.js-full-width-product-images');
      }
  
      // Call enable gallery function for product galleries
      $('[data-product-gallery]').each(function(index, gallery) {
        var $productGallery = $(this);
        productPage.enableGallery($productGallery);
      });
  
      if (window.location.search === '?contact_posted=true') {
        $('.notify_form .contact-form').hide();
        $('.notify_form .contact-form').prev('.message').html(Shopify.translation.notify_success_text);
      }
  
      var $notify_form = $('.notify_form .contact-form');
      $notify_form.each(function() {
        var $nf = $(this);
        $nf.on("submit", function (e) {
          if($('input[name="challenge"]', $nf).val() !== "true") {
            $.ajax({
              type: $nf.attr('method'),
              url: $nf.attr('action'),
              data: $nf.serialize(),
              success: function (data) {
                $nf.fadeOut("slow", function(){
                  $nf.prev('.message').html(Shopify.translation.notify_success_text);
                });
              },
              error: function(data) {
                $('input[name="challenge"]', $nf).val('true');
                $nf.submit();
              }
            });
            e.preventDefault();
          }
        });
      });
  
      // Initialize product slider if it exists on page
      if ($('.js-recommended-products-slider').length) {
        productPage.recommendedProductsSlider();
      }
  
      if (Shopify.theme_settings.product_form_style == 'swatches'){
        $('body').on('change', '.swatch :radio', function() {
          var optionIndex = $(this).closest('.swatch').attr('data-option-index');
          var optionValue = $(this).val();
          var parentForm = $(this).closest('.product_form form');
  
  
          if (parentForm.siblings('.notify_form').length){
            var notifyForm = parentForm.siblings('.notify_form');
          } else {
            var notifyForm = $('.js-notify-form');
          }
  
          var option1 = parentForm.find('.swatch_options input:checked').eq(0).val();
          var option2 = parentForm.find('.swatch_options input:checked').eq(1).val() || '';
          var option3 = parentForm.find('.swatch_options input:checked').eq(2).val() || '';
  
          if (option1 && option2 && option3){
            var notifyMessage = option1 + ' / ' + option2 + ' / ' + option3;
          } else if (option1 && option2){
            var notifyMessage = option1 + ' / ' + option2;
          } else {
            var notifyMessage = option1;
          }
  
  
          notifyForm.find(".notify_form_message").attr("value", notifyForm.find(".notify_form_message").data('body') + " - " + notifyMessage );
  
          $(this)
            .closest('form')
            .find('.single-option-selector')
            .eq(optionIndex)
            .val(optionValue)
            .trigger('change');
        });
      }
  
      $('.js-product-gallery a').fancybox({
        width: 800,
        height: 800,
        baseClass: "product-section__lightbox",
        clickContent: false,
        beforeLoad: function(instance, slide) {
          var $firstImage = instance.current.$ghost;
          if($firstImage) {
            $firstImage.remove();
          }
        },
        afterShow: function(instance, slide) {
          var zoom = instance.$trigger.first().parents('.js-product-gallery').data('zoom');
          if (zoom){
            $('.fancybox-image')
                .wrap('<span class="zoom-wrap" style="display:inline-block"></span>')
                .css('display', 'block')
                .parent()
                .zoom({
                  touch: false,
                  magnify: 1
            });
          }
        },
        afterClose: function(instance, slide) {
          var $instanceGallery = instance.$trigger.first().parents('.js-product-gallery');
          $instanceGallery.hide();
          setTimeout(function(){
            $instanceGallery.fadeIn(100);
            $('.js-product-gallery').find('.is-selected a').focus();
          }, 1);
        }
      })
  
      $('.js-product_section .product_form_options').each(function () {
        // Enable selectCallback if the number of select elements is not equal to the options size data
        if ($(this).find('.selector-wrapper select').length != $(this).data('options-size')) {
          new Shopify.OptionSelectors($(this).data('select-id'), { product: $(this).data('product'), onVariantSelected: selectCallback, enableHistoryState: $(this).data('enable-state') });
        }
      });
  
      /*
      If the product recommendations section exists, run the loadProductRecommendations method
      The selectCallback within this method will only affect the products in the product recommendations section
      */
      if ($('.product-recommendations').length){
        productPage.loadProductRecommendations();
      }
  
      this.initializeQuantityBox();
    },
    enableGallery: function(selector) {
  
      // Variables
      var $productGallery = $(selector);
      var $slides = $productGallery.find('.gallery-cell');
      var $thumbnailProductGallery = $productGallery.closest('.js-product_section').find('.product_gallery_nav');
      var $thumbnails = $thumbnailProductGallery.find('.gallery-cell');
      var draggable = true;
      var prevNextButtons = true;
      var zoom = $productGallery.data('zoom');
      var productLightbox = $productGallery.data('product-lightbox');
      var thumbnailsEnabled = $productGallery.data('thumbnails-enabled');
      var thumbnailsSliderEnabled = $productGallery.data('thumbnails-slider-enabled');
      var thumbnailsPosition = $productGallery.data('thumbnails-position');
      var thumbnailsArrows = $productGallery.data('gallery-arrows-enabled');
      var slideshowAnimation = $productGallery.data('slideshow-animation');
      var slideshowSpeed = $productGallery.data('slideshow-speed');
  
      // If zoom enabled
      if (zoom === true) {
        if(is_touch_device() && Shopify.media_queries.medium.matches) {
          // Lightbox has a built-in zoom feature, so check if lightbox is disabled
          if (productLightbox === 'false') {
            document.addEventListener('lazybeforeunveil', imageFunctions.zoom);
            draggable = false;
          }
        } else {
          document.addEventListener('lazybeforeunveil', imageFunctions.zoom);
        }
      }
  
      $productGallery.on('ready.flickity', function() {
  
        $slides.each(function(index, slide) {
  
          //Determine media type
          var mediaType = $(slide).data('media-type') || $(slide).find('[data-media-type]').data('media-type');
          var videoID;
  
          switch(mediaType) {
            case 'external_video':
  
              videoID = $(slide).find('[data-plyr-video-id]').data('plyr-video-id');
  
              if(videoPlayers) {
                for (var i = 0; i < videoPlayers.length; i++) {
                  if (videoPlayers[i].id == videoID || videoPlayers[i].media.id == videoID) {
  
                    if(!$(slide).hasClass('is-selected')) {
                      videoPlayers[i].keyboard = {
                        focused: false,
                        global: false
                      }
                    }
                  }
                }
              }
              break;
            case 'video':
  
              videoID = $(slide).find('[data-plyr-video-id]').data('plyr-video-id');
  
              if(videoPlayers) {
                for (var i = 0; i < videoPlayers.length; i++) {
                  if (videoPlayers[i].id == videoID || videoPlayers[i].media.id == videoID) {
  
                    if(!$(slide).hasClass('is-selected')) {
                      videoPlayers[i].keyboard = {
                        focused: false,
                        global: false
                      }
                    }
                  }
                }
              }
              break;
            case 'model':
              if($(slide).hasClass('is-selected')) { //When active slide
                if(mediaType == 'model' && isScreenSizeLarge()) {
                  $(slide).on('mouseenter', function() {
                    $productGallery.flickity('unbindDrag');
                  })
                  $(slide).on('mouseleave', function() {
                    $productGallery.flickity('bindDrag');
                  })
                }
              }
              break;
            default:
              break;
          }
        });
  
        // Video looping
        var loopingEnabled = $productGallery.data('video-loop');
  
        $.each(videoPlayers, function(index, player) {
          player.loop = loopingEnabled;
        })
      });
  
      $productGallery.on('change.flickity', function() {
  
        $slides.each(function(index, slide) {
  
          // Determine media type of current slide
          var mediaType = $(slide).data('media-type') || $(slide).find('[data-media-type]').data('media-type');
  
          if($(slide).hasClass('is-selected')) { //When active slide
  
            switch(mediaType) {
              case 'model':
  
                /* On slide change, if active slide contains 3d model
                * If on desktop, on hover, unbind flickity, after hover bind flickity
                * On model play event, unbind flickity to ensure model can be interacted with
                * On model pause event, bind flickity so that slide can be swiped
                * Pause all model slides when hidden
                */
  
                if (isScreenSizeLarge()) {
  
                  // On mouseenter event, unbind flickity
                  $(slide).on('mouseenter', function() {
                    $productGallery.flickity('unbindDrag');
                  });
  
                  // On mouseleave event, bind flickity
                  $(slide).on('mouseleave', function() {
                    $productGallery.flickity('bindDrag');
                  });
                }
  
                // Listen for model pause/play events
                $(slide).find('model-viewer').on('shopify_model_viewer_ui_toggle_play', function(){
                  $productGallery.flickity('unbindDrag');
                })
  
                $(slide).find('model-viewer').on('shopify_model_viewer_ui_toggle_pause', function(){
                  $productGallery.flickity('bindDrag');
                })
                break;
              default:
                $productGallery.flickity('bindDrag');
                break;
            }
          } else { //When inactive slide
  
            switch(mediaType) {
              case 'external_video':
                //Youtube video pausing
                $.each(videoPlayers, function(index, player) {
                  player.pause();
                });
                break;
              case 'video':
                //HTML5 video pausing
                $.each(videoPlayers, function(index, player) {
                  player.pause();
                });
                break;
              case 'model':
                $.each(productMedia.models, function(index, model) {
                  model.pause();
                })
            }
          }
        });
  
        //Restore 3d model icons
        productMedia.showModelIcon($productGallery);
  
      });
  
      $productGallery.flickity({
        wrapAround: true,
        adaptiveHeight: true,
        dragThreshold: 10,
        imagesLoaded: true,
        pageDots: true,
        prevNextButtons: $productGallery.data('media-count') > 1 || $slides.length > 1 ? true : false,
        autoPlay: false,
        fade: slideshowAnimation === 'fade' ? true : false,
        watchCSS: false,
        arrowShape: arrowSize
      });
  
      // Adjust arrows height if controls are hidden/shown
      $.each(videoPlayers, function(index, player) {
        // When controls are hidden, height should be auto
        player.on('controlshidden', function(event) {
          $productGallery.find('.flickity-prev-next-button').css('height', 'auto');
        })
        // When controls are shown, height should account for controls bar
        player.on('controlsshown', function(event) {
          $productGallery.find('.flickity-prev-next-button').css('height', 'calc(100% - 64px)');
        })
      })
  
      // Checks for videos and plays them if they are the featured media
      // Autoplay logic only happens on desktop, autoplay set to off for mobile
      var $sliderArrows = $productGallery.find('.flickity-prev-next-button');
  
      if (($sliderArrows || $thumbnails) && isScreenSizeLarge()) {
        $sliderArrows.on('click', function() {
  
          var pId = $productGallery.data('product-id');
  
          $productGallery.on( 'settle.flickity', function( event, index ) {
            // Find out media type of featured media slide
            var $selectedSlide = $productGallery.find('.gallery-cell.is-selected');
            var mediaType = $selectedSlide.data('media-type') || $selectedSlide.find('[data-media-type]').data('media-type');
  
            // Run video autoplay logic if featured media is a video
            if (mediaType == 'video' || mediaType == 'external_video') {
              checkForVideos();
            }
  
            // Autoplay model if featured media is a model
            if (mediaType == 'model') {
              // If model container has class is-selected then play the model
              var sortedModels = [];
              $.each(productMedia.models, function(index, model) {
                if($(model.container).closest('.gallery-cell').data('product-id') == pId) {
                  sortedModels.push(model)
                }
              })
  
              $.each(sortedModels, function(index, model) {
                var $slide = $(model.container).closest('.gallery-cell');
                if($slide.hasClass('is-selected')) {
                  model.play();
                }
              })
            }
            $productGallery.off('settle.flickity');
          });
  
          return false;
        })
  
        $thumbnails.on('click', function(event) {
          var index = $( event.currentTarget ).index();
          var pId = $productGallery.data('product-id');
          $productGallery.flickity( 'select', index );
  
          $productGallery.on( 'settle.flickity', function( event, index ) {
            // Find out media type of featured media slide
            var $selectedSlide = $productGallery.find('.gallery-cell.is-selected');
            var mediaType = $selectedSlide.data('media-type') || $selectedSlide.find('[data-media-type]').data('media-type');
  
            // Run video autoplay logic if featured media is a video
            if (mediaType == 'video' || mediaType == 'external_video') {
              checkForVideos();
            }
  
            // Autoplay model if featured media is a model
            if (mediaType == 'model') {
              // If model container has class is-selected then play the model
              var sortedModels = [];
              $.each(productMedia.models, function(index, model) {
                if($(model.container).closest('.gallery-cell').data('product-id') == pId) {
                  sortedModels.push(model)
                }
              })
  
              $.each(sortedModels, function(index, model) {
                var $slide = $(model.container).closest('.gallery-cell');
                if($slide.hasClass('is-selected')) {
                  model.play();
                }
              })
            }
            $productGallery.off('settle.flickity');
          });
          return false;
        })
  
        $thumbnails.keypress(function(event) {
          var index = $( event.currentTarget ).index();
          var pId = $productGallery.data('product-id');
          if(event.which == 13) {
  
            $productGallery.flickity( 'select', index );
  
            var $selectedSlide = $productGallery.find('.gallery-cell.is-selected');
  
            $productGallery.on( 'settle.flickity', function( event, index ) {
              $selectedSlide.find('[data-youtube-video]').attr('tabindex', '0');
              $selectedSlide.find('model-viewer, .plyr, a').focus();
  
              $productGallery.off('settle.flickity');
            });
  
            // Find out media type of featured media slide
            var mediaType = $selectedSlide.data('media-type') || $selectedSlide.find('[data-media-type]').data('media-type');
  
            // Run video autoplay logic if featured media is a video
            if (mediaType == 'video' || mediaType == 'external_video') {
              checkForVideos();
            }
  
            // Autoplay model if featured media is a model
            if (mediaType == 'model') {
              // If model container has class is-selected then play the model
              var sortedModels = [];
              $.each(productMedia.models, function(index, model) {
                if($(model.container).closest('.gallery-cell').data('product-id') == pId) {
                  sortedModels.push(model)
                }
              })
  
              $.each(sortedModels, function(index, model) {
                var $slide = $(model.container).closest('.gallery-cell');
                if($slide.hasClass('is-selected')) {
                  model.play();
                }
              })
            }
  
            return false;
          }
        })
      }
  
      function checkForVideos() {
        $slides.each(function(index, slide) {
          // Variables
          var $slide = $(slide);
          var mediaType = $slide.data('media-type') || $slide.find('[data-media-type]').data('media-type');
          var videoID = $slide.find('video').data('plyr-video-id');
          var $iframeVideo = $slide.find('iframe');
          var iframeID = $iframeVideo.attr('id');
  
          if ($slide.hasClass('is-selected')) {
            if (mediaType == 'video') {
              videoID = $slide.find('video').data('plyr-video-id');
              if (videoID) {
                autoplayVideo(videoID, $slide);
              }
            } else if (mediaType == 'external_video' && iframeID) {
              autoplayYoutubeVideo(iframeID, $slide);
            }
          }
        })
      }
  
      function autoplayVideo(videoID, $slide) {
        // Compare id to player object and only play that video
        $.each(videoPlayers, function(index, player){
  
          if (player.media.dataset.plyrVideoId == videoID) {
            player.play();
  
            // On fullscreen toggle, focus back on the slide itself
            player.on('exitfullscreen', function(){
              $slide.closest('.product-gallery').find('.product-gallery__thumbnails').focus();
            })
          }
        })
      }
  
      function autoplayYoutubeVideo(iframeID, $slide) {
        // compare id to player object and only play that video
        $.each(videoPlayers, function(index, player){
  
          if (player.playing) {
            player.pause();
          }
  
          if (player.media.id == iframeID) {
            player.play();
  
            // On fullscreen toggle, focus back on the slide itself
            player.on('exitfullscreen', function(){
              $slide.closest('.product-gallery').find('.product-gallery__thumbnails').focus();
            })
          }
        })
      }
  
      // Thumbnail gallery logic begins
      if (thumbnailsEnabled == true && thumbnailsSliderEnabled == true && $slides.length > 1) {
        // If desktop determine which slider we build
  
        if (Shopify.media_queries.large.matches) {
          // If thumbnail position is left/right then vertical slider gets enabled
          if (thumbnailsPosition == 'left' || thumbnailsPosition == 'right') {
            console.log($productGallery.outerHeight());
            $thumbnailProductGallery.css('max-height', $productGallery.outerHeight());
            $thumbnailProductGallery.addClass('vertical-slider-enabled');
  
            $thumbnails.on('click', function(event) {
              var index = $(event.currentTarget).index();
              $productGallery.flickity('select', index);
            });
  
    
            var navCellHeight = $thumbnails.height();
            var navHeight = $thumbnailProductGallery.height();
  
            $productGallery.on( 'select.flickity', function() {
              // set selected nav cell
              var flkty = $productGallery.data('flickity');
              $thumbnailProductGallery.find('.is-nav-selected').removeClass('is-nav-selected');
              var $selected = $thumbnails.eq( flkty.selectedIndex ).addClass('is-nav-selected');
  
              // scroll nav
              var scrollY = $selected.position().top + $thumbnailProductGallery.scrollTop() - ( navHeight + navCellHeight ) / 2;
              $thumbnailProductGallery.animate({
                scrollTop: scrollY
              });
            });
  
            
          } else {
              $thumbnailProductGallery.flickity({
                cellAlign: 'center',
                contain: true,
                groupCells: '80%',
                imagesLoaded: true,
                pageDots: false,
                prevNextButtons: $thumbnails.length > 5 ? thumbnailsArrows : false,
                asNavFor: $productGallery[0],
                arrowShape: arrowSize,
                autoPlay: false
              });
  
              // Ensures Flickity is not collapsed when loaded
              setTimeout(function() {
                $thumbnailProductGallery.flickity('resize');
              }, 500);
  
              $(window).on('load', function() {
                $thumbnailProductGallery.flickity('resize');
              });
  
              // Once thumbnail is focused, move carousel to that cell
              $.each($thumbnails, function(index, thumbnail) {
                var $thumbnail = $(thumbnail);
                if ($thumbnail.hasClass('is-selected')) {
                  $thumbnail.on('focus', function() {
                    $thumbnailProductGallery.flickity('selectCell', index);
                  })
                }
              })
          }
        } else {
          // If not on desktop, create standard thumbnail slider
          $thumbnailProductGallery.flickity({
            cellAlign: 'center',
            contain: true,
            groupCells: '80%',
            imagesLoaded: true,
            pageDots: false,
            prevNextButtons: $thumbnails.length > 5 ? thumbnailsArrows : false,
            asNavFor: $productGallery[0],
            arrowShape: arrowSize,
            autoPlay: false
          });
        }
      } else if (thumbnailsEnabled == true ) {
        // If thumbnail slider is disabled, ensure thumbnails can still navigate product images
        $thumbnailProductGallery.find('.product-gallery__thumbnail').on('click', function(){
          var index = $(this).index();
          $productGallery.flickity( 'selectCell', index );
        })
      }
  
      $( window ).on( 'load', function() {
        $productGallery.flickity('resize');
      });
  
      setTimeout(function() {
        $productGallery.flickity('resize');
      }, 500);
  
    },
    loadProductRecommendations: function() {
  
      var $productRecommendationsContainer = $('.product-recommendations');
  
      if ($productRecommendationsContainer.length === 0) {
        return false;
      }
  
      var productID = $productRecommendationsContainer.data('product-id');
      var limit = $productRecommendationsContainer.data('limit');
  
      // Build request URL
      var recommendationsURL = $productRecommendationsContainer.data('recommendations-url');
      var requestUrl = recommendationsURL + "?section_id=product-recommendations&limit=" + limit + "&product_id=" + productID;
      var $recommendedProductSlider = $('.js-recommended-products-slider');
  
      // Make ajax call to request information for Shopify's recommended products
      $.ajax({
        type: 'GET',
        url: requestUrl,
        success: function(data) {
  
          var $recommendedProductsElement = $(data).find('.product-recommendations').html();
  
          // Insert product list into the product recommendations container
          $productRecommendationsContainer.html($recommendedProductsElement);
  
          // Initialize product slider if it exists on page
          if ($recommendedProductSlider.length) {
            productPage.recommendedProductsSlider();
          }
  
          // Re-link swatches on inline quick-shop
          $('[data-product-recommendations-container] .js-product_section .product_form_options').each(function () {
            new Shopify.OptionSelectors($(this).data("select-id"), { product: $(this).data("product"), onVariantSelected: selectCallback, enableHistoryState: $(this).data("enable-state") });
          });
  
          // Converting the currencies
          if (Currency.show_multiple_currencies) {
            currencyConverter.convertCurrencies();
          }
  
          // Initialize shopify payment buttons
          if (Shopify.PaymentButton) {
            Shopify.PaymentButton.init();
          }
  
          videoFeature.setupRecommendedVideoPlayer();
  
          if (Shopify.theme_settings.collection_secondary_image){
            imageFunctions.showSecondaryImage();
          }
  
          if ($('.product-details-section').length) {
  
            var recommendedBlocks = [];
  
            $('.product-recommendations--product-details').each(function(index, recommendedBlock) {
              recommendedBlocks.push(recommendedBlock)
            });
  
            // Show recommended block. We dont delete static section as it is needed in the theme editor
            $(recommendedBlocks[0]).show();
          }
  
  
          hideNoScript();
  
        }
      });
    },
    productSwatches: function(){
      //Swatches linked with selected options
      if (Shopify.theme_settings.product_form_style == 'swatches'){
        if ($('.js-product_section').length){
          var $productForms = $('.js-product_section').find('.product_form');
          $productForms.addClass('is-visible');
  
          //Loop through each product and set the initial option value state
  
          $productForms.each(function(){
            var JSONData = $(this).data('product');
            var productID = $(this).data('product-id');
            var productSection = '.product-' + productID + ' .js-product_section';
            var swatchOptions = $(this).find('.swatch_options .swatch');
            if (swatchOptions.length > 1){
              Shopify.linkOptionSelectors(JSONData, productSection);
            }
          });
        }
  
        //Add click event when there is more than one product on the page (eg. Collection in Detail)
        if ($('.js-product_section').length > 1){
          $('body').on('click', '.swatch-element', function(){
            var swatchValue = $(this).data('value').toString();
  
            $(this)
            .siblings('input[value="'+ swatchValue.replace(/\"/g,'\\"') +'"]')
            .prop("checked", true)
            .trigger("change");
  
            var JSONData = $(this).parents('.product_form').data('product');
            var productID = $(this).parents('.product_form').data('product-id');
            var productSection = '.product-' + productID + ' .js-product_section';
            var swatchOptions = $(this).parents('.product_form').find('.swatch_options .swatch');
  
            if (swatchOptions.length > 1){
              Shopify.linkOptionSelectors(JSONData, productSection);
            }
          })
        }
      }
    },
    recommendedProductsSlider: function(){
      var myapprovedvendor = new Swiper ('.js-recommended-products-slider .swiper-container', {
        speed: 400,
        spaceBetween: 10,
        initialSlide: 5,
        //truewrapper adoptsheight of active slide
        autoHeight: false,
        // Optional parameters
        direction: 'horizontal',
        loop: true,
        // delay between transitions in ms
        autoplay: 5000,
        autoplayStopOnLast: false, // loop false also
        // If we need pagination
        pagination: '.swiper-pagination',
        paginationType: "bullets",
        mousewheel: {
          invert: false
        },
        // And if we need scrollbar
        scrollbar: {
          el: '.swiper-scrollbar',
          draggable: true
        },
        // "slide", "fade", "cube", "coverflow" or "flip"
        effect: 'slide',
        // Distance between slides in px.
        //
        slidesPerView: 5,
        //
        //
        slidesOffsetBefore: 0,
        //
        grabCursor: true,
       
        breakpoints: {
          // when window width is <= 320px
          320: {
            slidesPerView: 1,
            spaceBetween: 10,
            centeredSlides: false
          },
          // when window width is <= 480px
          480: {
            slidesPerView: 2,
            spaceBetween: 5,
            centeredSlides: false
          },
          // when window width is <= 640px
          640: {
            slidesPerView: 3,
            spaceBetween: 10,
            centeredSlides: false
          },
          1080: {
            slidesPerView: 6,
            spaceBetween: 30
          }
        
        }
      });
    },
    initializeQuantityBox: function(){
  
      $('body').on('click', '.js-change-quantity', function() {
          var $this = $(this),
              $input = $(this).siblings('input'),
              val = parseInt($input.val()),
              valMax = 100000000000000000000000000000,
              valMin = $input.attr('min') || 0;
  
          if ($input.attr('max') != null){
            valMax = $input.attr('max');
          }
  
          if(isNaN(val) || val < valMin) {
              $input.val(valMin);
              return false;
          } else if (val > valMax) {
              $input.val(valMax);
              return false;
          }
  
          if($this.data('func') == 'plus') {
              if(val < valMax) $input.val(val + 1);
          } else {
              if(val > valMin) $input.val(val - 1);
              if($this.parents(".cart_item").length) {
                if (val - 1 == 0) {
                  $this.closest('.cart_item').addClass('animated fadeOutUp')
                }
              }
          }
          $input.trigger('change');
  
      });
    },
    unload: function($target){
      var $slider = $target.find('.products-slider');
      $slider.flickity('destroy');
      $('body').off('click', '.js-change-quantity');
    }
  }
  
  /*============================================================================
    Header
  ==============================================================================*/
  
  var header = {
    init: function(){
  
      var closeDropdown = function() {
        $('body').removeClass('is-active');
        $('.dropdown_link').removeClass('active_link');
        $('.dropdown_container').hide();
        $('.mobile_nav').find('div').removeClass('open');
      };
  
      var closeMiniCart = function() {
        $('body').removeClass('is-active').removeClass('blocked-scroll');
        $('.dropdown_link').toggleClass('active_link');
        $('.cart-container').removeClass('active_link');
      };
  
      var openMiniCart = function($cart_container) {
        $('body').addClass('blocked-scroll');
        $('.mobile_nav div').removeClass('open');
        $('.dropdown_link').removeClass('active_link');
        $cart_container.addClass('active_link');
      };
  
      var closeAllSubSubmenus = function() {
        $('.vertical-menu_sub-submenu').removeClass('is-visible');
        $('.vertical-menu_sub-submenu').prev('a').attr('data-click-count', 0);
      }
  
      var closeAllSubmenus = function() {
        $('.vertical-menu_submenu').removeClass('is-visible');
        $('.vertical-menu_submenu').prev('a').attr('data-click-count', 0);
        $('.mega-menu-parent').attr('data-click-count', 0);
        closeAllSubSubmenus();
      }
  
      // Store link items with data attribute of 'data-show-dropdown-on-click' in a variable
      var $openDropdownOnClick = $('.main-nav__wrapper').find('[data-show-dropdown-on-click]');
  
      //Vertical menu enabled
      if ($('.dropdown_link--vertical').length){
        $('.dropdown_link--vertical, .mega-menu-parent').attr('data-click-count', 0);
  
        if ($openDropdownOnClick.length == 0) {
          $('.dropdown_link--vertical, .vertical-menu_submenu').on('mouseover', function(e) {
            var $dropdown = $(this).parents('.main-nav').find('[data-dropdown="' + $(this).data('dropdown-rel') + '"]');
  
            $('.dropdown_container').hide();
            $('.active_link').removeClass('active_link');
            if(!$(this).hasClass('active_link')) {
              $('.dropdown_container').hide();
              $(this).children('a').addClass('active_link');
              $('.is-absolute').parent().addClass('feature_image');
            }
          });
        }
  
        //Enable touch on parent link if user is on a touch device and desktop menu is visible, OR if 'open dropdown on click' setting is enabled
        if (is_touch_device() || $openDropdownOnClick.length >= 1){
          $('body').on('touchstart click', '.vertical-menu .sublink a, .vertical-menu_submenu .sublink a', function(e) {
  
            var clicked;
            var verticalMenu = $(this);
            var $dropdownVertical = $(verticalMenu).next('.vertical-menu_submenu');
            var $dropdownVerticalSubMenu = $(verticalMenu).next('.vertical-menu_sub-submenu');
  
            var showMenu = function() {
              $dropdownVertical.removeClass('hidden');
              $dropdownVerticalSubMenu.removeClass('hidden');
              $dropdownVertical.addClass('is-visible');
              $dropdownVerticalSubMenu.addClass('is-visible')
            }
  
            if(e.type == "touchstart") {
              clicked = true;
              if($(this).attr('data-click-count') < 1) {
                openDropdown(verticalMenu, e.target);
                e.preventDefault();
                e.stopPropagation();
              }
            }
            else if(e.type == "click" && !clicked) {
              if($(this).attr('data-click-count') < 1) {
                openDropdown(verticalMenu, e.target);
                e.preventDefault();
                e.stopPropagation();
              }
            }
            else {
              clicked = false;
            }
  
            function openDropdown(verticalMenu, target) {
  
              var $dropdownMegaMenu = $(verticalMenu).parents('.main-nav').find('[data-dropdown="' + $(this).data('dropdown-rel') + '"]');
  
              var clickCount = $(verticalMenu).attr('data-click-count');
  
              $('.dropdown_link--vertical').not(verticalMenu).attr('data-click-count', 0);
              $('.mega-menu-parent').attr('data-click-count', 0);
              $('.dropdown_link--vertical').attr('data-no-instant', true);
              $('.dropdown_container').hide();
  
              $dropdownMegaMenu.show();
              // Conditional to not close the parent dropdown when selecting various sub menus in the same parent
              if ($(target).parents('.vertical-menu_submenu').hasClass('is-visible')) {
                closeAllSubSubmenus();
                $('.is-absolute').parent().addClass('feature_image');
              } else {
                closeAllSubmenus();
                $('.is-absolute').parent().addClass('feature_image');
              }
  
              showMenu();
  
              //capture touch event or click event
              clickCount++;
              $(verticalMenu).attr('data-click-count', clickCount);
  
              if (clickCount < 2){
                e.preventDefault();
                e.stopPropagation();
                return false;
              }
  
            }
            // Close dropdown if click anywhere outside dropdown menu
            $('html').on('click', function(event) {
              if (!$(event.target).closest('.dropdown_container').length && !$(event.target).hasClass('url-deadlink')) {
                closeAllSubmenus();
                $('.is-absolute').parent().addClass('feature_image');
              }
            });
          });
        }
      }
  
      if ($('.promo-banner').length){
        var promo_banner = Cookies.get('promo-banner');
  
        if (promo_banner != 'dismiss') {
          //$('body').addClass('promo-banner--show');
          $('.promo-banner').on('click', '.promo-banner__close', function(){
            $('body').removeClass('promo-banner--show');
            Cookies.set('promo-banner', 'dismiss', { expires: 30 });
          });
        }
      }
  
      //offscreen check for menu
      $('.vertical-menu_submenu, .vertical-menu_sub-submenu').each(function() {
        if($(this).is(':off-right')) {
          $(this).addClass('vertical-menu--align-right');
        }
      });
  
      //Click anywhere outside of dropdown to close
      $('html').on('click', function(event) {
        if (!$(event.target).closest('.cart-container').length && $('.cart_content').is(':visible')) {
  
          closeMiniCart();
        }
  
        if (!$(event.target).closest('.dropdown_container').length && $('.dropdown').is(':visible') && !$(event.target).hasClass('url-deadlink') && !$(event.target).hasClass('mega-menu-parent')) {
          $('.is-absolute').parent().addClass('feature_image');
          $('body').removeClass('is-active');
          closeDropdown();
          if ($openDropdownOnClick.length) {
            $('.dropdown_link').attr('data-click-count', 0);
          }
        }
  
      });
  
      //Only apply on larger screen sizes
      if (Shopify.media_queries.large.matches) {
        if ($('.header').hasClass('header-fixed--true')){
  
          //offset scroll position
          $('body').on('click', '.banner a[href^="#"]', function(e) {
              e.preventDefault();
              var anchorLink = $(this).attr('href');
              var headerHeight = $('.main-nav__wrapper.sticky_nav').outerHeight();
              $('html, body').animate({
                scrollTop: $(anchorLink).offset().top - headerHeight
              }, 2000);
          });
  
          if (!$('.main-nav__wrapper').hasClass('sticky_nav')) {
            var sticky_nav = new Headhesive('.main-nav__wrapper', {
              offset: 700,
              throttle: 300,
              classes: {
                clone: 'sticky_nav',
                stick: 'sticky_nav--stick',
                unstick: 'sticky_nav--unstick'
              },
              onInit: function() {
                $('.sticky_nav .secondary_logo').css('display', 'none');
                $('.sticky_nav .primary_logo').css('display', 'block');
                $('.sticky_nav .icon-search').css('display', 'block');
                $('.sticky_nav .search_form').css('display', 'none');
                $('.sticky_nav .search-link').css('display', 'block');
                $('.sticky_nav .main-nav').append($(".header .cart-container").clone());
              },
              onStick: function() {
                var maxHeight = 0;
                var $targetHeightElement = $('.sticky_nav .main-nav');
  
                $targetHeightElement.each(function() {
                  maxHeight = maxHeight > $(this).outerHeight() ? maxHeight : $(this).outerHeight();
                });
  
                $('.sticky_nav .mini_cart').css('height', maxHeight);
                $('.sticky_nav .cart_content').css('top', maxHeight);
              },
              onUnstick: function() {
                $('.cart-container').removeClass('active_link');
              }
            });
          }
        } else {
          $('.header-fixed--true').removeClass('header-fixed--true');
          if ($('.main-nav__wrapper').length > 1) {
            $('.main-nav__wrapper').first().remove();
          }
        }
  
        if ($('img.primary_logo:visible')){
          $('.logo img', $(".feature_image .header")).attr('src', $('.logo img').data('src-home'));
        } else {
          $('.logo img').attr('src', $('.logo img').data('src'));
        }
      //Mobile menu
      } else {
        if ($('#header').hasClass('mobile_nav-fixed--true')){
          $('body').addClass('mobile_nav-fixed--true');
  
          //offset scroll position
          $('body').on('click', '.banner a[href^="#"]', function(e) {
              e.preventDefault();
              var anchorLink = $(this).attr('href');
              var headerHeight = $('#header').outerHeight();
              $('html, body').animate({
                scrollTop: $(anchorLink).offset().top - headerHeight
              }, 2000);
          });
        } else {
          $('body').addClass('mobile_nav-fixed--false');
        }
      }
  
      //avoid cart_content duplicating for mobile screen sizes
      
      if($('#header .cart_content').length < 1 & $(window).width() < 768) {
        $('#header .cart-container').append($('.header .cart_content').clone());
      }
      if ($(window).width() < 1024) {
  
        $('.dropdown_link').attr('data-no-instant', true);
  
        $('body').on('click', '.dropdown_link, .vertical--dropdown', function(e) {
          $('.nav a').removeClass('active_link');
  
          if ($('#header').is(':visible')) {
            var $dropdown = $(this).parents("#header").find('[data-dropdown="' + $(this).data("dropdown-rel") + '"]')
  
              if(!$(this).hasClass('mini_cart')) {
                $('.cart-container').removeClass('active_link');
              }
  
          } else {
  
            if($(this).hasClass("icon-search")) {
              window.location = $(this).attr("href");
              return false;
            }
  
            var $dropdown = $(this).parents('.main-nav').find('[data-dropdown="' + $(this).data('dropdown-rel') + '"]')
          }
  
          if ($dropdown.is(':visible') || $dropdown.attr('class') === undefined) {
            $dropdown.hide();
            $('body').removeClass('is-active');
          } else {
            $('.dropdown_container').hide();
            if(!$(this).hasClass('cart-container')) {
              $('.is-absolute').parent().removeClass('feature_image');
            }
            $dropdown.show();
            $('body').addClass('is-active');
            $('.mobile_nav').find('div').removeClass('open');
          }
  
          if ($dropdown.is(':visible')) {
            e.stopPropagation();
            return false;
          }
        });
  
        $('body').on("click", '.mobile_nav', function() {
          $(this).find('div').toggleClass('open');
          if ($(this).find('.menu_title').text() == 'Menu') {
            $(this).find('.menu_title').text('Close');
          } else {
            $(this).find('.menu_title').text('Menu');
          }
          
        });
  
        //Toggle mini-cart with menu icon
        if(Shopify.theme_settings.cart_action != 'redirect_cart' && !Shopify.theme_settings.redirect_cart) {
          $(".mini_cart").on("click", function(e) {
            var $cart_container = $(this).parent();
            if($cart_container.hasClass('active_link')) {
              closeMiniCart();
              $('body').removeClass('blocked-scroll');
            } else {
              openMiniCart($cart_container);
              $('body').addClass('blocked-scroll');
            }
            if (is_touch_device() || Shopify.media_queries.medium.matches) {
              e.preventDefault();
            }
          });
        }
  
  
        $('.cart_content__continue-shopping').on('click', function(e){
          closeMiniCart();
        })
  
      } else {
        var $openDropdownOnClick = $('.main-nav__wrapper').find('[data-show-dropdown-on-click]');
        //Enable touch on parent link if on touch device and desktop menu is visible
        if($openDropdownOnClick.length || is_touch_device()){
          $('.dropdown_link').attr('data-click-count', 0);
  
          $('.dropdown_link').on('click', function(e) {
  
            var $dropdown = $(this).parents('.main-nav').find('[data-dropdown="' + $(this).data('dropdown-rel') + '"]');
  
            var clickCount = $(this).attr('data-click-count');
            closeAllSubmenus();
            closeDropdown();
  
            $('.dropdown_link').not(this).attr('data-click-count', 0);
            $('.dropdown_link').attr('data-no-instant', true);
  
            $('.active_link').removeClass('active_link');
  
            if(!$(this).hasClass('active_link')) {
              $dropdown.show();
  
              if($(this).hasClass('mini_cart')) {
                if(!$('body').hasClass('cart')) {
                  $(this).parent('.cart-container').addClass('active_link');
                }
              } else {
                $(this).addClass('active_link');
                $('.is-absolute').parent().removeClass('feature_image');
              }
            }
  
            //capture touch event
            if (e.type == 'click'){
              clickCount++;
              $(this).attr('data-click-count', clickCount);
  
              if (clickCount < 2){
                e.preventDefault();
                e.stopPropagation();
                return false;
              }
            }
          });
        }
  
        if ($openDropdownOnClick.length == 0) {
          $(".nav a, .logo a").not(".cart_content a").on("mouseenter", function() {
            if(!$(this).hasClass("active_link")) {
              $('.dropdown_container').hide();
              $('.active_link').removeClass('active_link');
              $('.is-absolute').parent().addClass('feature_image');
            }
          });
  
          $('.main-nav, .top-bar, .cart-container').on("mouseleave", function() {
            $('.dropdown_container').hide();
            $('.active_link').removeClass('active_link');
            $('.is-absolute').parent().addClass('feature_image');
            $('body').removeClass('is-active');
          });
  
  
          $('.dropdown_link').on('mouseover', function(e) {
            $('.dropdown_container').hide();
  
            var $dropdown = $(this).parents('.main-nav').find('[data-dropdown="' + $(this).data('dropdown-rel') + '"]');
  
            $('.active_link').removeClass('active_link');
  
            if(!$(this).hasClass('active_link')) {
              $dropdown.show();
  
              if($(this).hasClass('mini_cart')) {
                if(!$('body').hasClass('cart')) {
                  $(this).parent('.cart-container').addClass('active_link');
                }
              } else {
                $(this).addClass('active_link');
                $('.is-absolute').parent().removeClass('feature_image');
              }
            }
  
          });
        }
  
  
      }
  
    },
    removeDataAttributes: function(target){
      if($(target).length){
        var i,
            $target = $(target),
            attrName,
            dataAttrsToDelete = [],
            dataAttrs = $target.get(0).attributes,
            dataAttrsLen = dataAttrs.length;
  
        for (i=0; i<dataAttrsLen; i++) {
          if ( 'data-' === dataAttrs[i].name.substring(0,5) ) {
            dataAttrsToDelete.push(dataAttrs[i].name);
          }
        }
        $.each( dataAttrsToDelete, function( index, attrName ) {
          $target.removeAttr( attrName );
        })
      }
    },
    loadMobileMegaMenu: function() {
  
      //Loop through mega menus and add to mobile menu
      $('.mega-menu-container .mobile-mega-menu').each(function(index){
        $('[data-mobile-dropdown-rel="' + $(this).data("mobile-dropdown") + '"]').find('span').remove();
        $('[data-mobile-dropdown-rel="' + $(this).data("mobile-dropdown") + '"] > a').append(' <span class="left icon-down-arrow"></span>').attr('data-no-instant', 'true');
        $('[data-mobile-dropdown-rel="' + $(this).data("mobile-dropdown") + '"]').addClass('mobile-mega-menu-parent sublink');
        $('[data-mobile-dropdown-rel="' + $(this).data("mobile-dropdown") + '"]').append(this);
        $('[data-mobile-dropdown-rel="' + $(this).data("mobile-dropdown") + '"] > ul').each(function(index){
          if (!$(this).hasClass('mobile-mega-menu')) {
            $(this).remove();
          }
        });
      });
    },
    unload: function() {
      $('body').off('click', '.mobile_nav');
      $('body').off('click', '.dropdown_link');
      $('html').off('click');
      $('.mini_cart').off('click');
      $('.cart_content__continue-shopping').off('click');
      $('body').off('click', '.banner a[href^="#"]');
      $('.main-nav__wrapper.sticky_nav').remove();
    }
  }
  
  /*============================================================================
    Map
  ==============================================================================*/
  var mapFunction = {
    init: function() {
  
      if($('.lazymap').length > 0){
        lazyframe('.lazymap');
      }
  
      if ($('.maps').hasClass('js-api-map')) {
        var mapsToLoad = [];
        //Create map settings array
        $('.map').each(function(i, obj) {
          mapsToLoad.push(this);
          mapsToLoad[i].sectionid = $(this).data('id');
          mapsToLoad[i].address = $(this).data('address');
          mapsToLoad[i].directions = $(this).data('directions-address');
          mapsToLoad[i].zoom = $(this).data('zoom');
          mapsToLoad[i].mapstyle = $(this).data('style');
          mapsToLoad[i].showpin = $(this).data('pin');
          mapsToLoad[i].apikey = $(this).data('api-key');
        });
        $.each(mapsToLoad, function(i, instance) {
          //Enable caching to avoid duplicate google maps files
          $.ajaxSetup({ cache: true });
          //Load maps script and find location coordinates
          $.getScript(
            'https://maps.googleapis.com/maps/api/js?key=' + mapsToLoad[i].apikey
          ).then(function() {
            mapFunction.findLocation(mapsToLoad[i]);
            $.ajaxSetup({ cache: false });
          });
        });
      }
    },
    findLocation: function(mapArray) {
      var geoLat;
      var geoLng;
      var geocoder = new google.maps.Geocoder();
      //Find and set coordinates
      geocoder.geocode({ address: mapArray.address }, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          geoLat = results[0].geometry.location.lat();
          geoLng = results[0].geometry.location.lng();
          //Create map
          mapFunction.initMap(geoLat, geoLng, mapArray);
        } else {
          console.log('Error:' + status);
        }
      });
    },
    initMap: function(lat, lng, mapArray) {
      var location = { lat: lat, lng: lng };
      var styleJson = [];
      //Set style JSON
      if(mapArray.mapstyle=='aubergine'){
        styleJson=[{elementType:'geometry',stylers:[{color:'#1d2c4d'}]},{elementType:'labels.text.fill',stylers:[{color:'#8ec3b9'}]},{elementType:'labels.text.stroke',stylers:[{color:'#1a3646'}]},{featureType:'administrative.country',elementType:'geometry.stroke',stylers:[{color:'#4b6878'}]},{featureType:'administrative.land_parcel',elementType:'labels.text.fill',stylers:[{color:'#64779e'}]},{featureType:'administrative.province',elementType:'geometry.stroke',stylers:[{color:'#4b6878'}]},{featureType:'landscape.man_made',elementType:'geometry.stroke',stylers:[{color:'#334e87'}]},{featureType:'landscape.natural',elementType:'geometry',stylers:[{color:'#023e58'}]},{featureType:'poi',elementType:'geometry',stylers:[{color:'#283d6a'}]},{featureType:'poi',elementType:'labels.text.fill',stylers:[{color:'#6f9ba5'}]},{featureType:'poi',elementType:'labels.text.stroke',stylers:[{color:'#1d2c4d'}]},{featureType:'poi.park',elementType:'geometry.fill',stylers:[{color:'#023e58'}]},{featureType:'poi.park',elementType:'labels.text.fill',stylers:[{color:'#3C7680'}]},{featureType:'road',elementType:'geometry',stylers:[{color:'#304a7d'}]},{featureType:'road',elementType:'labels.text.fill',stylers:[{color:'#98a5be'}]},{featureType:'road',elementType:'labels.text.stroke',stylers:[{color:'#1d2c4d'}]},{featureType:'road.highway',elementType:'geometry',stylers:[{color:'#2c6675'}]},{featureType:'road.highway',elementType:'geometry.stroke',stylers:[{color:'#255763'}]},{featureType:'road.highway',elementType:'labels.text.fill',stylers:[{color:'#b0d5ce'}]},{featureType:'road.highway',elementType:'labels.text.stroke',stylers:[{color:'#023e58'}]},{featureType:'transit',elementType:'labels.text.fill',stylers:[{color:'#98a5be'}]},{featureType:'transit',elementType:'labels.text.stroke',stylers:[{color:'#1d2c4d'}]},{featureType:'transit.line',elementType:'geometry.fill',stylers:[{color:'#283d6a'}]},{featureType:'transit.station',elementType:'geometry',stylers:[{color:'#3a4762'}]},{featureType:'water',elementType:'geometry',stylers:[{color:'#0e1626'}]},{featureType:'water',elementType:'labels.text.fill',stylers:[{color:'#4e6d70'}]}]
      }else if(mapArray.mapstyle=='retro'){
        styleJson=[{elementType:'geometry',stylers:[{color:'#ebe3cd'}]},{elementType:'labels.text.fill',stylers:[{color:'#523735'}]},{elementType:'labels.text.stroke',stylers:[{color:'#f5f1e6'}]},{featureType:'administrative',elementType:'geometry.stroke',stylers:[{color:'#c9b2a6'}]},{featureType:'administrative.land_parcel',elementType:'geometry.stroke',stylers:[{color:'#dcd2be'}]},{featureType:'administrative.land_parcel',elementType:'labels.text.fill',stylers:[{color:'#ae9e90'}]},{featureType:'landscape.natural',elementType:'geometry',stylers:[{color:'#dfd2ae'}]},{featureType:'poi',elementType:'geometry',stylers:[{color:'#dfd2ae'}]},{featureType:'poi',elementType:'labels.text.fill',stylers:[{color:'#93817c'}]},{featureType:'poi.park',elementType:'geometry.fill',stylers:[{color:'#a5b076'}]},{featureType:'poi.park',elementType:'labels.text.fill',stylers:[{color:'#447530'}]},{featureType:'road',elementType:'geometry',stylers:[{color:'#f5f1e6'}]},{featureType:'road.arterial',elementType:'geometry',stylers:[{color:'#fdfcf8'}]},{featureType:'road.highway',elementType:'geometry',stylers:[{color:'#f8c967'}]},{featureType:'road.highway',elementType:'geometry.stroke',stylers:[{color:'#e9bc62'}]},{featureType:'road.highway.controlled_access',elementType:'geometry',stylers:[{color:'#e98d58'}]},{featureType:'road.highway.controlled_access',elementType:'geometry.stroke',stylers:[{color:'#db8555'}]},{featureType:'road.local',elementType:'labels.text.fill',stylers:[{color:'#806b63'}]},{featureType:'transit.line',elementType:'geometry',stylers:[{color:'#dfd2ae'}]},{featureType:'transit.line',elementType:'labels.text.fill',stylers:[{color:'#8f7d77'}]},{featureType:'transit.line',elementType:'labels.text.stroke',stylers:[{color:'#ebe3cd'}]},{featureType:'transit.station',elementType:'geometry',stylers:[{color:'#dfd2ae'}]},{featureType:'water',elementType:'geometry.fill',stylers:[{color:'#b9d3c2'}]},{featureType:'water',elementType:'labels.text.fill',stylers:[{color:'#92998d'}]}]
      }else if(mapArray.mapstyle=='silver'){
        styleJson=[{elementType:'geometry',stylers:[{color:'#f5f5f5'}]},{elementType:'labels.icon',stylers:[{visibility:'off'}]},{elementType:'labels.text.fill',stylers:[{color:'#616161'}]},{elementType:'labels.text.stroke',stylers:[{color:'#f5f5f5'}]},{featureType:'administrative.land_parcel',elementType:'labels.text.fill',stylers:[{color:'#bdbdbd'}]},{featureType:'poi',elementType:'geometry',stylers:[{color:'#eeeeee'}]},{featureType:'poi',elementType:'labels.text.fill',stylers:[{color:'#757575'}]},{featureType:'poi.park',elementType:'geometry',stylers:[{color:'#e5e5e5'}]},{featureType:'poi.park',elementType:'labels.text.fill',stylers:[{color:'#9e9e9e'}]},{featureType:'road',elementType:'geometry',stylers:[{color:'#ffffff'}]},{featureType:'road.arterial',elementType:'labels.text.fill',stylers:[{color:'#757575'}]},{featureType:'road.highway',elementType:'geometry',stylers:[{color:'#dadada'}]},{featureType:'road.highway',elementType:'labels.text.fill',stylers:[{color:'#616161'}]},{featureType:'road.local',elementType:'labels.text.fill',stylers:[{color:'#9e9e9e'}]},{featureType:'transit.line',elementType:'geometry',stylers:[{color:'#e5e5e5'}]},{featureType:'transit.station',elementType:'geometry',stylers:[{color:'#eeeeee'}]},{featureType:'water',elementType:'geometry',stylers:[{color:'#c9c9c9'}]},{featureType:'water',elementType:'labels.text.fill',stylers:[{color:'#9e9e9e'}]}]
      }else if(mapArray.mapstyle=='night'){
        styleJson=[{elementType:'geometry',stylers:[{color:'#242f3e'}]},{elementType:'labels.text.fill',stylers:[{color:'#746855'}]},{elementType:'labels.text.stroke',stylers:[{color:'#242f3e'}]},{featureType:'administrative.locality',elementType:'labels.text.fill',stylers:[{color:'#d59563'}]},{featureType:'poi',elementType:'labels.text.fill',stylers:[{color:'#d59563'}]},{featureType:'poi.park',elementType:'geometry',stylers:[{color:'#263c3f'}]},{featureType:'poi.park',elementType:'labels.text.fill',stylers:[{color:'#6b9a76'}]},{featureType:'road',elementType:'geometry',stylers:[{color:'#38414e'}]},{featureType:'road',elementType:'geometry.stroke',stylers:[{color:'#212a37'}]},{featureType:'road',elementType:'labels.text.fill',stylers:[{color:'#9ca5b3'}]},{featureType:'road.highway',elementType:'geometry',stylers:[{color:'#746855'}]},{featureType:'road.highway',elementType:'geometry.stroke',stylers:[{color:'#1f2835'}]},{featureType:'road.highway',elementType:'labels.text.fill',stylers:[{color:'#f3d19c'}]},{featureType:'transit',elementType:'geometry',stylers:[{color:'#2f3948'}]},{featureType:'transit.station',elementType:'labels.text.fill',stylers:[{color:'#d59563'}]},{featureType:'water',elementType:'geometry',stylers:[{color:'#17263c'}]},{featureType:'water',elementType:'labels.text.fill',stylers:[{color:'#515c6d'}]},{featureType:'water',elementType:'labels.text.stroke',stylers:[{color:'#17263c'}]}]}else{styleJson=[]}
      //Create google maps link
      $('.js-map-link').attr(
        'href',
        'https://www.google.com/maps/place/' +
          mapArray.directions +
          '/@' +
          lat +
          ',' +
          lng
      );
      //Set map options
      var mapOptions = {
        zoom: mapArray.zoom,
        center: location,
        styles: styleJson,
        disableDefaultUI: false
      };
      //Create map
      var map = new google.maps.Map(
        document.getElementById(mapArray.sectionid),
        mapOptions
      );
      //Show pin
      if (mapArray.showpin == true) {
        var marker = new google.maps.Marker({
          position: location,
          map: map
        });
      }
    }
  };
  
  /*============================================================================
    Global accordions
  ==============================================================================*/
  var globalAccordions = {
    init: function(){
      var flg = 0;
      var $faqHeading = $('.faqAccordion > dt > button, .accordion > dt > a');
      $('.faqAccordion > dd, .accordion > dd').attr('aria-hidden',true);
      $faqHeading.attr('aria-expanded',false);
      $faqHeading.on('click activate',function(){
        if( flg ) return false;
        flg = 1;
        var state = $(this).attr('aria-expanded') === 'false' ? true : false;
        $(this).attr('aria-expanded',state);
        $(this).parent().next().slideToggle(function(){
          flg = 0;
        });
          $(this).parent().next().attr('aria-hidden',!state);
        return false;
      });
      $faqHeading.on('keydown',function(event){
        var keyCode = event.keyCode || e.which;
        if (keyCode === 13){
          $(this).trigger('activate');
        }
      });
    }
  }
  
  /* ==================================================
#Image functions
#Recently viewed
#Load more / infinite load
#Filter products with AJAX
#Search autocomplete
#Sidebar filter on collection pages
#Misc
#Quick shop
#Newsletter popup
#Currency converter
#Product Media Controls
#Plyr setup

/*============================================================================
  Image functions
==============================================================================*/

var usePageDots = Shopify.theme_settings.page_dots_enabled;

var imageFunctions = {
  zoom: function(){
    var $image = $(event.target);
    var zoomSrc = $image.data('zoom-src');

    if (zoomSrc) {
      $image.wrap('<span class="zoom-container"></span>').css('display', 'block').parent().zoom({
        url: zoomSrc,
        touch: false,
        magnify: 1
      });
    }
  },
  linkGalleryAndCarousel: function($gallery, $carousel){

    $carousel.find('.gallery-cell:nth-child(1)').addClass('is-nav-selected');

    //EVENT - click on carousel item to slide gallery
    $carousel.on( 'click', '.gallery-cell', function() {
        var index = $(this).index();
        $carousel.find('.is-nav-selected').removeClass('is-nav-selected');
        $(this).addClass('is-nav-selected');
        $gallery.flickity( 'select', index );
    });

    //EVENT - update carousel based on gallery index
    $gallery.on( 'select.flickity', function() {
      var galleryData = $(this).data('flickity');
      if (galleryData){
        $carousel.find('.is-nav-selected').removeClass('is-nav-selected');
        $carousel.find('.gallery-cell:nth-child(' + (galleryData.selectedIndex + 1) + ')').addClass('is-nav-selected');
      }
    });
  },
  fullWidth: function(images, imageContainer){
    $(images).each(function(){
      var $image = $(this),
          alt = $image.attr('alt'),
          src = $image.attr('src');

      if (alt.indexOf("[") >= 0){

        //remove from description
        $image.remove();

        //find shortcode values and remove from alt
        var shortcodes = alt.match(/\[(.*?)\]/ig);
        alt = alt.replace(/\[(.*?)\]/ig, '');

        //remove brackets from shortcode to be used as classes
        var captionClass = $.map( shortcodes, function( value, index ) {
            value = value.replace(/[\[\]']+/g,'');
            return value;
        });

        //markup for caption

        var caption = [
            '<div class="position-' + (captionClass.length ? captionClass : 'center') + ' caption js-caption">',
              '<div class="caption-content caption-background-false align-' + (captionClass.length ? captionClass : 'center') + '">',
                '<p class="headline">' + alt + '</p>',
              '</div>',
            '</div>'
        ].join('');

        //image attributes added
        $image.attr({
          alt: alt,
          class: 'lazyload {{ settings.image_loading_style }}',
          src: src,
          dataSizes: 'auto'
        });

        var image = $image.prop('outerHTML')
        var banner =  '<div class="banner">' + image + caption + '</div>'

        $(imageContainer).append(banner);
      }
    })
  },
  showSecondaryImage: function(){
    if (Shopify.media_queries.large.matches) {
      $('.has-secondary-media-swap').off().on('mouseenter', function() {
        $(this).find('.image-element__wrap img').toggleClass('secondary-media-hidden');
        $(this).find('[data-html5-video]').toggleClass('secondary-media-hidden');
        $(this).find('.external-video__container').toggleClass('secondary-media-hidden');
        videoFeature.enableVideoOnHover($(this));
      });

      $('.has-secondary-media-swap').on('mouseleave', function() {
        $(this).find('.image-element__wrap img').toggleClass('secondary-media-hidden');
        $(this).find('[data-html5-video]').toggleClass('secondary-media-hidden');
        $(this).find('.external-video__container').toggleClass('secondary-media-hidden');
        videoFeature.enableVideoOnHover($(this));
      });
    }
  },
  //Fix for flickity issue on IOS, where you can't swipe through the slider
  flickityIosFix: function()  {
    var touchingCarousel = false,
      touchStartCoords;

    document.body.addEventListener('touchstart', function(e) {
      if (e.target.closest('.flickity-slider')) {
        touchingCarousel = true;
      } else {
        touchingCarousel = false;
        return;
      }

      touchStartCoords = {
        x: e.touches[0].pageX,
        y: e.touches[0].pageY
      }
    });

    document.body.addEventListener('touchmove', function(e) {
      if (!(touchingCarousel && e.cancelable)) {
        return;
      }

      var moveVector = {
        x: e.touches[0].pageX - touchStartCoords.x,
        y: e.touches[0].pageY - touchStartCoords.y
      };

      if (Math.abs(moveVector.x) > 7)
        e.preventDefault()

    }, {passive: false});
  }
}

/*============================================================================
  Recently viewed
==============================================================================*/

var recentlyViewed = {
  init: function(){

    var productHandle,
        rvCookie,
        rvProducts,
        displayProducts,
        rvProductArray;

    if ($('.js-product_section[data-rv-handle]').length){
      productHandle = $('.js-product_section').data('rv-handle').toString();
      rvCookie = Cookies.get('recentlyViewed');
      rvProducts = recentlyViewed.getCookieProducts(rvCookie, productHandle);
    } else if ($('.recently-viewed__section').length){
      rvCookie = Cookies.get('recentlyViewed');
      rvProducts = recentlyViewed.getCookieProducts(rvCookie, productHandle);
    } else if ($('.js-sidebar-recently-viewed').length){
      rvCookie = Cookies.get('recentlyViewed');
      rvProducts = recentlyViewed.getCookieProducts(rvCookie, productHandle);
    }

    if (rvProducts){
      rvProductArray = unescape(rvProducts).split(',');
    }

    if (productHandle){

      if(!$.inArray(productHandle, rvProductArray) !== -1){
        displayProducts = [];
        rvProductArray.unshift(productHandle);
        $.each(rvProductArray, function(i, el){
            if($.inArray(el, displayProducts) === -1) displayProducts.push(el);
        });
      }

      recentlyViewed.setCookieProducts(displayProducts);
    } else {
      displayProducts = rvProductArray;
    }

    if ($('.recently-viewed__section').length){
      var parent = '.recently-viewed__section';
      var recentlyViewedProductsLoaded = $(parent).data('recently-viewed-items-loaded');

      if (recentlyViewedProductsLoaded) {
        return false;
      }

      recentlyViewed.getProductInformation(parent, displayProducts, productHandle);
    } else if ($('.js-recently-viewed .rv-main').length){
      var parent = '.js-recently-viewed';
      var recentlyViewedProductsLoaded = $(parent).data('recently-viewed-items-loaded');

      if (recentlyViewedProductsLoaded) {
        return false;
      }

      recentlyViewed.getProductInformation(parent, displayProducts, productHandle);
    }

    if ($('.sidebar .js-sidebar-recently-viewed').length){
      var parent = '.sidebar .js-sidebar-recently-viewed';
      var recentlyViewedProductsLoaded = $(parent).data('recently-viewed-items-loaded');
      if (recentlyViewedProductsLoaded) {
        return false;
      }

      if (productHandle){
        recentlyViewed.getProductInformation(parent, displayProducts, productHandle);
      } else {
        recentlyViewed.getProductInformation(parent, displayProducts);
      }
    }

  },
  getCookieProducts: function(rvCookie, productHandle){

    if (!rvCookie && productHandle) {
      Cookies.set('recentlyViewed', productHandle, { expires: 30, path: '/' });
      rvCookie = Cookies.get('recentlyViewed');
    } else {
      rvCookie = Cookies.get('recentlyViewed');
    }

    return rvCookie;

  },
  setCookieProducts: function(rvProductArray){
    Cookies.set('recentlyViewed', escape(rvProductArray.join(',')), { expires: 30, path: '/' });
  },
  getProductInformation: function(parent, displayProducts, productHandle){

    // Add data-attribute 'recently-viewed-items-loaded="true" to parent container
    $(parent).attr('data-recently-viewed-items-loaded', 'true');

    if (productHandle){
      displayProducts.splice( $.inArray(productHandle, displayProducts), 1 );
    }

    var productLimit = $(parent).data('visible-products');

    if (productLimit && displayProducts){
      displayProducts = displayProducts.slice(0, productLimit);
    }

    $.each(displayProducts, function (index, value) {

      if (value){
        $(parent).removeClass('hidden');

        $(parent).parents('.sidebar-block').show();

        $.ajax({
          type: 'GET',
          url: '/products/' + value  + '?view=rv',
          success: function(data) {

            var rvProduct = $(data).find('.js-recently-viewed-product');

            $(parent).find(' .rv-box-' + index ).append(rvProduct);

            if (Currency.show_multiple_currencies) {
              currencyConverter.convertCurrencies();
            }

            // Initialize show secondary media on hover feature
            if (Shopify.theme_settings.collection_secondary_image) {
              imageFunctions.showSecondaryImage();
            }

            var $video = rvProduct.find('[data-html5-video] video, [data-youtube-video]');
            if ($video.length > 0) {
              videoFeature.setupPlayerForRecentlyViewedProducts(rvProduct.find('[data-html5-video] video, [data-youtube-video]'))
            }

           },
           error: function(x, t, m) {
            console.log(x);
            console.log(t);
            console.log(m);
           },
           dataType: "html"
        });
      }

      if ($(parent).find('.rv-main').hasClass('js-rv-slider')){
        if (displayProducts.length <= productLimit) {
          $('.js-rv-slider .gallery-cell').eq(displayProducts.length).nextAll().addBack().remove();
        } else {
          $('.js-rv-slider .gallery-cell').eq(productLimit).nextAll().addBack().remove();
        }
        if ($(window).width() < 768) {
          recentlyViewed.createSlider(parent, productLimit);
        }
        
      } else if ($(parent).find('.rv-main').hasClass('js-rv-grid')){
        if (displayProducts.length <= productLimit) {
          $('.js-rv-grid .thumbnail').eq(displayProducts.length).nextAll().addBack().remove();
        } else {
          $('.js-rv-grid .thumbnail').eq(productLimit).nextAll().addBack().remove();
        }
      }
    });
  },

  createSlider: function(el, productsAvailable){

    var products_per_slide = $('.js-rv-slider').data('products-per-slide');
    var products_generated = $('.js-rv-slider').find('.gallery-cell').length;
    var products_available = $('.js-rv-slider').data('products-available');
    var cellAlign = 'left'
    var wrapAround = true;
    var prevNextButtons = true;
    var initialIndex;

    if(products_per_slide >= products_generated) {
      cellAlign = 'center';
      wrapAround = false;
      prevNextButtons = false;
    }

    if (products_per_slide == "2" && products_available > products_per_slide || products_per_slide == "4" && products_available > products_per_slide || products_per_slide == "6" && products_available > products_per_slide){
      initialIndex = 0;
    } else if (products_per_slide == "3" && products_available) {
      initialIndex = 1;
    } else if (products_per_slide == "5" && products_available) {
      initialIndex = 2;
    } else if (products_per_slide == "7" && products_available) {
      initialIndex = 3;
    }

    new Swiper ('.recently-viewed__section', {
      speed: 400,
      spaceBetween: 10,
      initialSlide: 4,
      //truewrapper adoptsheight of active slide
      autoHeight: false,
      // Optional parameters
      direction: 'horizontal',
      loop: true,
      // delay between transitions in ms
      autoplay: 5000,
      autoplayStopOnLast: false, // loop false also
      // If we need pagination
      pagination: '.swiper-pagination',
      paginationType: "bullets",
      mousewheel: {
        invert: false
      },
      // And if we need scrollbar
      scrollbar: {
        el: '.swiper-scrollbar',
        draggable: true
      },
      // "slide", "fade", "cube", "coverflow" or "flip"
      effect: 'slide',
      // Distance between slides in px.
      //
      slidesPerView: 4,
      //
      centeredSlides: true,
      //
      slidesOffsetBefore: 0,
      //
      grabCursor: true,
      
      breakpoints: {
        // when window width is <= 320px
        320: {
          slidesPerView: 1,
          spaceBetween: 10,
          centeredSlides: false
        },
        // when window width is <= 480px
        480: {
          slidesPerView: 2,
          spaceBetween: 5,
          centeredSlides: false
        },
        // when window width is <= 640px
        640: {
          slidesPerView: 3,
          spaceBetween: 10,
          centeredSlides: false
        }
      }
    });


    $('.js-rv-slider').addClass('slider-initialized');
  }
}

/* ===============================================
  #Load more / infinite load
================================================== */

//Collection template

var enableLoadMoreProducts = function(){
  $('body').on('click', '.js-load-more a', function(e){
    enableInfiniteScroll();
    e.stopPropagation();
    return false;
  });
}

var enableInfiniteScroll = function(){
  if ($('.collection-matrix').length) {
    var infiniteScroll = new Waypoint.Infinite({
      element: $('.collection-matrix')[0],
      items: '.collection-matrix',
      more: '.load-more__btn',
      loadingClass: 'loading-in-progress',
      onBeforePageLoad: function(){
        $('.js-load-more').hide();
      },
      onAfterPageLoad: function(data){
        $('.collection-matrix > .collection-matrix .thumbnail').unwrap('.collection-matrix');
        if (Shopify.theme_settings.enable_shopify_review_comments && Shopify.theme_settings.enable_shopify_collection_badges){
          SPR.$(document).ready(function() {
            return SPR.registerCallbacks(),
            SPR.initRatingHandler(),
            SPR.initDomEls(),
            SPR.loadProducts(),
            SPR.loadBadges()
          })
        }
        if (Currency.show_multiple_currencies) {
          currencyConverter.convertCurrencies();
        }
        // Initialize shopify payment buttons
        if (Shopify.PaymentButton) {
          Shopify.PaymentButton.init();
        }
        productPage.init();
        if (Shopify.theme_settings.quick_shop_enabled){
          quickShop.init();
        }
        hideNoScript();

        videoFeature.init();

        // Initialize show secondary media on hover feature
        if (Shopify.theme_settings.collection_secondary_image){
          imageFunctions.showSecondaryImage();
        }

        // Refresh waypoints
        Waypoint.refreshAll()
      }
    })
  }
}

//Search template

var enableLoadMoreSearch = function(){
  $('body').on('click', '.js-load-more a', function(e){
    enableInfiniteSearchScroll();
    e.stopPropagation();
    return false;
  });
}

var enableInfiniteSearchScroll = function(){
  if ($('.search-matrix').length) {
    var infiniteSearchScroll = new Waypoint.Infinite({
      element: $('.search-matrix')[0],
      items: '.search-matrix',
      more: '.load-more__btn',
      loadingClass: 'loading-in-progress',
      onBeforePageLoad: function(){
        $('.js-load-more').hide();
      },
      onAfterPageLoad: function(data){
        $('.search-matrix > .search-matrix .thumbnail').unwrap('.search-matrix');
        if (Shopify.theme_settings.enable_shopify_review_comments && Shopify.theme_settings.enable_shopify_collection_badges){
          SPR.$(document).ready(function() {
            return SPR.registerCallbacks(),
            SPR.initRatingHandler(),
            SPR.initDomEls(),
            SPR.loadProducts(),
            SPR.loadBadges()
          })
        }
        if (Currency.show_multiple_currencies) {
          currencyConverter.convertCurrencies();
        }
        // Initialize shopify payment buttons
        if (Shopify.PaymentButton) {
          Shopify.PaymentButton.init();
        }
        productPage.init();
        if (Shopify.theme_settings.quick_shop_enabled) {
          quickShop.init();
        }
        hideNoScript();

        videoFeature.init();

        // Initialize show secondary media on hover feature
        if (Shopify.theme_settings.collection_secondary_image){
          imageFunctions.showSecondaryImage();
        }
      }
    })
  }
}

var hideNoScript = function(){
  // Used to ensure noscript elements are hidden when JS is present.
  $('.image__container .noscript').addClass('hidden');
}

/*============================================================================
  Filter Products with AJAX
==============================================================================*/

Shopify.queryParams = {};
if (location.search.length) {
 for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
    aKeyValue = aCouples[i].split('=');
    if (aKeyValue.length > 1) {
     Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
    }
  }
}

var quickFilter = {
  init: function(){
    var selectedOptions = [],
        query = '',
        currentTags = '',
        url1 = $.url('1') ? '/' + $.url('1') + '/' : ''

        // Check the length of url1 to see if there is a translation added to the end of the host URL, if there is, use a different path
        if ( url1.length <= 4) {
          url2 = $.url('2') ? $.url('2') + '/' : '',
          url3 = $.url('3') ? $.url('3') + '/' : '',
          path = url1 + url2 + url3;
        } else {
          url2 = $.url('2') ? $.url('2') + '/' : '',
          path = url1 + url2;
        }

    //Handle dropdowns if they exist
    if ($('#sort-by').length){
      query = $('#sort-by').val();
    } else {
      query = url('?sort_by');
    }

    if ($('#tag_filter').length){
      var $tagFilterValue = $('#tag_filter').val();

      if ($('#tag_filter').data('default-collection') != $tagFilterValue){
        urlTag = $tagFilterValue.substr($tagFilterValue.lastIndexOf('/') + 1);
        var tagFilterUrl = $tagFilterValue.substr($tagFilterValue)

        // apply the selected attribute to the proper option value in tag filter dropdown
        $('#tag_filter option').removeAttr('selected');
        $('#tag_filter option[value="' + tagFilterUrl + '"]').attr('selected', 'selected')

        if (urlTag != 'all'){
          if ($.inArray( urlTag, selectedOptions ) > -1){
            //Do nothing
          } else {
            selectedOptions.unshift(urlTag);
          }
        }
      }
    }

    //Add all checkbox values to array
    $('[data-option-filter] input:checked').each(function (){
      selectedOptions.push($(this).val());
    });
    selectedOptions = $.makeArray(selectedOptions);

    //Loop through tags to create string to update page url
    $.each(selectedOptions, function(i, value){

      if (i != selectedOptions.length - 1) {
        currentTags += selectedOptions[i] + '+';
      } else {
        currentTags += selectedOptions[i];
      }

    });

    Shopify.queryParams.sort_by = query;
    query = '?' + $.param(Shopify.queryParams);

    quickFilter.processUrl(path, currentTags, query);
  },
  updateView: function(filterURL) {

    $.ajax({
      type: 'GET',
      url: filterURL,
      beforeSend: function() {
        $(".collection-matrix").addClass('fadeOut animated loading-in-progress filter-loading');
        Waypoint.destroyAll();
      },
      success: function(data) {
          $(".collection-matrix").removeClass('loading-in-progress');
          $(".collection-matrix").removeClass('filter-loading');
          var filteredBreadcrumb = $(data).find('.breadcrumb_text').html();
          $('.breadcrumb_text').html(filteredBreadcrumb);

          var filteredPagination = $(data).find('.paginate').html();
          $('.paginate').html(filteredPagination);

          var filteredSidebar = $(data).find('.sidebar').html();
          $('.sidebar').html(filteredSidebar);

          var filteredPageLinks = $(data).find('.paginate').html();
          $('.paginate').empty();
          $('.paginate').html(filteredPageLinks);

          var filteredData = $(data).find('.collection-matrix');
          $('.collection-matrix').remove();
          filteredData.insertBefore( $('.load-more__icon') );

          window.history && window.history.pushState && window.history.pushState("", "", filterURL);

          if ($('.sidebar__collection-filter').length){
            collectionSidebarFilter.init();
          }

          if (Shopify.theme_settings.pagination_type == 'infinite_scroll'){
            enableInfiniteScroll();
          }

          if (Currency.show_multiple_currencies) {
            currencyConverter.convertCurrencies();
          }

          if (Shopify.theme_settings.enable_shopify_review_comments && Shopify.theme_settings.enable_shopify_collection_badges) {
            SPR.$(document).ready(function() {
              return SPR.registerCallbacks(),
              SPR.initRatingHandler(),
              SPR.initDomEls(),
              SPR.loadProducts(),
              SPR.loadBadges()
            })
          }

        //Will reload recently viewed if present
        recentlyViewed.init();

        // Re-link swatches on inline quick-shop
        $('.js-product_section .product_form_options').each(function () {
          new Shopify.OptionSelectors($(this).data("select-id"), { product: $(this).data("product"), onVariantSelected: selectCallback, enableHistoryState: $(this).data("enable-state") });
        });

        // Prevent event bubbling
        $('body').off('click', '.swatch-element');

        // Reload product swatches
        productPage.productSwatches();

        //Swatch toggler
        $('.swatch_options input').each(function(){
          if($(this).is(':checked')) {
            quickShop.toggleSwatchImages($(this));
          }
        });

        $('.swatch_options label').on('click', function(){
          quickShop.toggleSwatchImages($(this));
        });

        // Initialize shopify payment buttons
        if (Shopify.PaymentButton) {
          Shopify.PaymentButton.init();
        }
      },
      error: function(x, t, m) {
        console.log(x);
        console.log(t);
        console.log(m);
        location.replace(location.protocol + '//' + location.host + filterURL);

      },
      dataType: "html"
    });
  },
  processUrl: function(path, tags, query){

    var query = query.replace(/\page=(\w+)&/, ''),
        urlString = '';

    urlString = path + tags + query;

    quickFilter.updateView(urlString);

  }
}

/*============================================================================
  Search autocomplete
==============================================================================*/

var searchAutocomplete = {
  init: function(){

    var currentAjaxRequest = null;
    var url1 = $.url('1') ? '/' + $.url('1') + '/' : '';

    if ( url1.length <= 4) {
      var shopURL = $('body').data('shop-url') + url1;
    } else {
      var shopURL = $('body').data('shop-url');
    }

    if (Shopify.theme_settings.search_option == 'products'){
      var searchPath = shopURL + '/search?type=product&q=';
    } else {
      var searchPath = shopURL + '/search?q=';
    }

    //Submit wildcard searches
    $(".search_form, .search__form, .header_search_form").on("submit", function(e){
      var formValue = $(this).find('input[name="q"]').val();
      var cleanFormValue = encodeURI(formValue);

      e.preventDefault();

      if(cleanFormValue == null) {
        window.location.href = '/search';
      } else {
        window.location.href = searchPath + cleanFormValue + '*';
      }
    });

    var searchForms = $('form.search_form, form.search, form.header_search_form').each(function() {

      var input = $(this).find('input[name="q"]');

      // Adding a list for showing search results.
      $('<div class="search__results-wrapper"><ul class="search__results"></ul></div>').appendTo($(this));
      // Listening to keyup and change on the text field within these search forms.
      input.attr('autocomplete', 'off').bind('keyup change', function() {

        if(input.val() == '') {
          $('.search__results').hide();
          $('.search__results').empty();
        }

        var term = $(this).val();
        var cleanTerm = encodeURI(term);

        var form = $(this).closest('form');
        var searchURL =  searchPath + cleanTerm;

        var resultsList = form.find('.search__results');

        if (term.length >= 3) {

          if (currentAjaxRequest != null) currentAjaxRequest.abort();

          currentAjaxRequest = $.getJSON(searchURL +'*&view=json', function(data) {
            resultsList.empty();

            // If we have no results.
            if(data.results_count == 0) {
              resultsList.hide();
            } else {
              // If we have results.
              $.each(data.results, function(index, item) {
                if(index >= Shopify.theme_settings.search_items_to_display) {
                  return false;
                }

                var link = $('<a></a>').attr('href', item.url);

                //Collect collection handles if product
                if(item.object_type == 'product') {

                  var collectionHandles = [];
                  for(i=0; i < item.collections.length; i++) {
                    collectionHandles.push(item.collections[i].handle);
                  }

                  if($.inArray('coming-soon', collectionHandles) != -1) {
                    var itemPrice = Shopify.translation.coming_soon_text;
                  } else {
                    if(item.available == true) {

                      if(item.raw_compare > item.raw_price ) {
                        var itemPrice = '<span class="was_price">' + item.compare + '</span> ' + item.price;
                      } else {
                        if(item.price_varies && item.price_min > 0) {
                          var itemPrice = Shopify.translation.from_text + ' ' + item.price;
                        } else if(item.price > 0 || item.raw_price > 0) {
                          var itemPrice = item.price;
                        } else {
                          var itemPrice = Shopify.theme_settings.free_text;
                        }
                      }
                    } else {
                      var itemPrice = Shopify.theme_settings.display_sold_out_price ? item.price + ' ' + '<span class="sold-out-text">' + Shopify.theme_settings.sold_out_text + '</span>' : '<span class="sold-out-text">' + Shopify.theme_settings.sold_out_text + '</span>';
                    }
                  }

                  if(item.thumbnail != 'NULL') {
                    link.append('<div class="thumbnail"><img class="lazyload {{ settings.image_loading_style }}" src="' + item.thumbnail + '" /></div>');
                  }
                  link.append('<div class="title">' + item.title + '<br><span class="item-pricing">'+ itemPrice +'</span></div>');


                } else if(item.object_type == 'article') {
                  if(item.thumbnail != 'NULL') {
                    link.append('<div class="thumbnail"><img class="lazyload {{ settings.image_loading_style }}" src="' + item.thumbnail + '" /></div>');
                  }
                  link.append('<div class="title">' + item.title + '<br><span class="item-pricing">'+ item.text_content +'</span></div>');

                } else if(item.object_type == 'page') {
                  link.append('<div class="title">' + item.title + '<br><span class="item-pricing">'+ item.text_content +'</span></div>');
                }

                link.wrap('<li class="item-result result--' + item.object_type + '"></li>');
                resultsList.append(link.parent());
              });
              // The Ajax request will return at the most 5 results.
              // If there are more than 5, let's link to the search results page.
              if(data.results_count >= Shopify.theme_settings.search_items_to_display) {
                resultsList.append('<li class="all-results"><span class="title see-all"><a href="' + searchURL + '*">' + Shopify.translation.all_results + ' (' + data.results_count + ')</a></span></li>');
              }
              resultsList.fadeIn(200);
            }
          })
        }
      });
    });

    // Clicking outside makes the results disappear.
    $(document).on('click', function(e){
      var container = $('[data-autocomplete-true]');
      if (!container.is(e.target) && container.has(e.target).length === 0) {
        $('[data-autocomplete-true]').find('.search__results-wrapper').hide();
      }
    });

    $('[data-autocomplete-true] input').on('focus', function(){
      $(this).parents('[data-autocomplete-true]').find('.search__results-wrapper').show();
    });
  },
  unload: function() {
    $('body').off('focus', '[data-autocomplete-true] input');
  }
}

/*============================================================================
  Sidebar filter on collection pages
==============================================================================*/

var collectionSidebarFilter = {
  init: function(){

    $('.filter-active-tag input:checked').parents('.filter-active-tag').siblings('.filter-all-tags').hide();
    $('.toggle-all--true .toggle_list .filter-active-tag input:checked').parents('ul.toggle_list').prev().click();

    //checks if there is an active filter, and if so, to keep the tag filter dropdown open
    var queryString = window.location.search;
    if (queryString.indexOf("sort_by") > 0 && $('.toggle-all--true .toggle_list .filter-active-tag input').attr('checked')) {
      $('.sidebar__collection-filter > h4').addClass('active')
    }

    //Hide filters if types or vendors is in URL (can't be combined)
    if ($.url(2) === 'types' || $.url(2) === 'vendors'){
      $('.sidebar__collection-filter').remove();
    }

    $('.sidebar-block:empty').prev().css('border-bottom', 'none');

    //Will reload recently viewed if present
    recentlyViewed.init();
  },
  clearAllFilters: function(){
    $('[data-option-filter] input').prop('checked', false);
    $('[data-option-filter] input').trigger('change');

    //Will reload recently viewed if present
    recentlyViewed.init();
  },
  clearSelectedFilter: function(optionFilter){
    // if the sidebar tag that is being cleared matched the tag inside of the tag filter dropdown, reset the dropdown value to it's default value
    if ($('#tag_filter').length) {
      if (optionFilter.find('[data-option-filter] input').val() === $('#tag_filter option:selected ').val().substr($('#tag_filter option:selected ').val().lastIndexOf('/') + 1)) {
        $('#tag_filter').val($('#tag_filter option:first').val())
      }
    }

    optionFilter.find('[data-option-filter] input').prop('checked', false);
    optionFilter.find('[data-option-filter] input').trigger('change');

    //Will reload recently viewed if present
    recentlyViewed.init();
  }
}




/*============================================================================
  Misc
==============================================================================*/
if (Shopify.theme_settings.slideshow_arrow_size == 'bold'){
  var arrowSize = {
    x0: 10,
    x1: 40, y1: 50,
    x2: 80, y2: 50,
    x3: 50
  }
  var svgArrowSizeLeft = '<svg viewBox="0 0 100 100"><path d="M 10,50 L 40,100 L 80,100 L 50,50  L 80,0 L 40,0 Z" class="arrow"></path></svg>'
  var svgArrowSizeRight = '<svg viewBox="0 0 100 100"><path d="M 10,50 L 40,100 L 80,100 L 50,50  L 80,0 L 40,0 Z" class="arrow" transform="translate(100, 100) rotate(180) "></path></svg>'
} else if (Shopify.theme_settings.slideshow_arrow_size == 'light'){
  var arrowSize = {
    x0: 10,
    x1: 60, y1: 50,
    x2: 62, y2: 40,
    x3: 22
  }
  var svgArrowSizeLeft = '<svg viewBox="0 0 100 100"><path d="M 10,50 L 60,100 L 62,90 L 22,50  L 62,10 L 60,0 Z" class="arrow"></path></svg>'
  var svgArrowSizeRight = '<svg viewBox="0 0 100 100"><path d="M 10,50 L 60,100 L 62,90 L 22,50  L 62,10 L 60,0 Z" class="arrow" transform="translate(100, 100) rotate(180) "></path></svg>'
} else if (Shopify.theme_settings.slideshow_arrow_size == 'regular'){
  var arrowSize = {
    x0: 10,
    x1: 60, y1: 50,
    x2: 70, y2: 40,
    x3: 30
  }
  var svgArrowSizeLeft = '<svg viewBox="0 0 100 100"><path d="M 10,50 L 60,100 L 70,90 L 30,50  L 70,10 L 60,0 Z" class="arrow"></path></svg>'
  var svgArrowSizeRight = '<svg viewBox="0 0 100 100"><path d="M 10,50 L 60,100 L 70,90 L 30,50  L 70,10 L 60,0 Z" class="arrow" transform="translate(100, 100) rotate(180) "></path></svg>'
}

function isScreenSizeLarge() {
  if (window.matchMedia( "(min-width: 1024px)" ).matches) {
    return true
  }
}

var utils = {
  createAccordion: function(container, tab, content){
    var $container = $(container);
    var $tab = $(container).find(tab);
    var $content = $(container).find(content);
    var specificTab = container + ' ' + tab;

    //Check to see if need to rearrange product tabs to create accordion (backwards compatible)
    if (container.indexOf(".accordion-tabs") >= 0){
      var rearrangedTabs = $.map($tab, function(v, i) { return [v, $content[i]]; });
      $container.empty();

      $.each(rearrangedTabs, function (index, value) {
        $container.append(this);
      });

      $content.removeClass('active');
      $container.find('.active').next().slideToggle();

      tab = container + '> a';
    }

    $(container).children('a').each(function(i, tab) {
      var tab = $(this);
      var tabValue = tab.attr('href'); //get tab id
      tab.attr('data-tab-value', tabValue); //set tab id in data attribute
      tab.removeAttr("href"); //remove href (to prevent url hash update)
    });

    $(container).find(tab + '.active').next().slideToggle();
    $('body').on('click', specificTab, function(e){
      e.preventDefault();
      $(this).toggleClass('active');
      $(this).next().slideToggle();
    });
  },
  mobileAccordion: function(container, tab, content){
    $container = $(container);
    $tab = $(container).find(tab);
    $content = $(container).find(content);

    $(tab + '.active').next().slideToggle();

    $('body').on('click', tab, function(e){
      e.preventDefault();
      $(this).toggleClass('active');
      $(this).next().slideToggle();
    });
  },
  mobileParentActiveAccordion: function(container, tab, content){
    $container = $(container);
    $tab = $(container).find(tab);
    $content = $(container).find(content);

    $(tab + '.active').parent().next().slideToggle();

    $('body').on('click', tab, function(e){
      e.preventDefault();
      $(this).toggleClass('active');
      $(this).parent().next().slideToggle();
    });
  },
  initializeTabs: function(){
    $('ul.tabs > li > a').attr('data-no-instant', true);
    $('body').on('click', 'ul.tabs > li > a', function(e) {
      e.preventDefault();
      var contentLocation = $(this).attr('href');
      if(contentLocation.charAt(0)=="#") {
        $('ul.tabs > li > a.active').removeClass('active');
        $(this).addClass('active');
        if ($(this).parents('ul.tabs').next().hasClass('tab-content')) {
          $(this).parents('ul.tabs').next().find(contentLocation).show().css({'display': 'block'}).addClass('active').siblings().hide().removeClass('active');
        } else {
          var position = $(contentLocation).offset();
          $(document).scrollTop(position.top);
        }
        
      }
    });
  },
  pageBannerCheck: function(){
    //check for header banner
    if (!$('.page-banner').length > 0 || $('.header').hasClass('header-background--solid')) {
      $('.feature_image').removeClass('feature_image');
      $('.header.is-absolute').removeClass('is-absolute');
      //hide secondary logo
      $('.secondary_logo--true').find('.secondary_logo').css('display', 'none');
      $('.secondary_logo--true').find('.primary_logo').css('display', 'block');
    } else {
      if ($('.page-banner').hasClass('full-width--true')) {
        $('.header').parent().addClass('feature_image');
        $('.header').addClass('is-absolute');
        //check for secondary logo
        if ($('header.feature_image').hasClass('secondary_logo--true')){
          $('.secondary_logo--true').find('.secondary_logo').css('display', 'block');
          $('.secondary_logo--true').find('.primary_logo').css('display', 'none');
        }
      } else {
        $('.header').parent().removeClass('feature_image');
        $('.header').removeClass('is-absolute');
      }
    }

    //check for section that uses header banner on home page
    if ($('.index-sections').children().first('.under-menu').find('.full-width--true').length) {
      if (!$('.header').hasClass('header-background--solid')) {
        $('.index .header').parent().addClass('feature_image');
        $('.index .header').addClass('is-absolute');
      }
      //check for secondary logo
      if ($('header.feature_image').hasClass('secondary_logo--true')){
        $('.secondary_logo--true').find('.secondary_logo').show();
        $('.secondary_logo--true').find('.primary_logo').hide();
      }
    } else {
      $('.index .feature_image').removeClass('feature_image');
      $('.index .header.is-absolute').removeClass('is-absolute');
      //hide secondary logo
      if (!$('header.feature_image').hasClass('secondary_logo--true')){
        $('.secondary_logo--true').find('.secondary_logo').hide();
        $('.secondary_logo--true').find('.primary_logo').show();
      }
    }

    //check for section that uses header banner on the page details template
    if ($('.detail-sections').children().first().hasClass('under-menu')) {
      if (!$('.header').hasClass('header-background--solid')) {
        $('[class^="page-details"] .header').parent().addClass('feature_image');
        $('[class^="page-details"] .header').addClass('is-absolute');
      }

      //check for secondary logo
      if ($('header.feature_image').hasClass('secondary_logo--true')){
        $('.secondary_logo--true').find('.secondary_logo').show();
        $('.secondary_logo--true').find('.primary_logo').hide();
      }
    } else {
      $('[class^="page-details"] .feature_image').removeClass('feature_image');
      $('[class^="page-details"] .header.is-absolute').removeClass('is-absolute');

      //hide secondary logo
      if (!$('header.feature_image').hasClass('secondary_logo--true')){
        $('.secondary_logo--true').find('.secondary_logo').hide();
        $('.secondary_logo--true').find('.primary_logo').show();
      }
    }
  },
  resizeActionButtons: function(){
    $('.js-caption:visible').each(function(){
      var buttonWidth = 0;
      $(this).find('.action_button').each(function(){
        $button = $(this);
        if($(this).width() > buttonWidth){
            buttonWidth = $(this).width();
        }
      });
      $(this).find('.action_button').width(buttonWidth);
    });
  },
  enableDisclosure: function() {

    var $disclosure = $('[data-disclosure]');
    var $toggle = $('[data-disclosure-toggle]');
    var $disclosureWrap = $('.disclosure__list-wrap');

    //Check if current opened menu is offscreen
    function checkOffScreen($openedToggle) {
      if($openedToggle.siblings('.disclosure__list-wrap').is(':off-right')) {
        $openedToggle.siblings('.disclosure__list-wrap').addClass('disclosure--left');
      }
    }

    function closeDisclosures(ignoreTarget, currentTarget) {
      if(ignoreTarget === true) {
        $toggle.not(currentTarget).removeClass('is-clicked');
        $toggle.not(currentTarget).attr('aria-expanded', 'false');
      } else {
        $toggle.removeClass('is-clicked');
        $toggle.attr('aria-expanded', 'false');
      }

      $disclosureWrap.removeClass('disclosure--left');
    }

    //Close menus on ESC
    $('body').on('keyup', function(e) {
      if(e.which == '27') {
        closeDisclosures();
      }
    });

    //Close menus on hoverout
    $disclosure.on('mouseleave', function(e) {
      closeDisclosures();
    });

    //On click/focus event for toggling options
    $toggle.on('mouseenter focus', function(e) {
      //Close all other menus
      closeDisclosures(true, this);

      var $target = $(e.currentTarget);
      $target.attr('aria-expanded', 'true').addClass('is-clicked');
      checkOffScreen($target);
    });

    //When tabbing through, close dropdown when tabbing out of dropdown
    $('.disclosure__button').on('focusout', function(e) {
      //Close all other menus
      if(!$(e.relatedTarget).hasClass('disclosure__button') || $(e.relatedTarget).hasClass('disclosure__toggle')) {
        closeDisclosures();
      }
    });

    //Mobile toggle logic
    $toggle.on('touchstart', function(e) {
      if (Shopify.media_queries.medium.matches || !/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        var $target = $(e.currentTarget);

        closeDisclosures(true, this);

        if(!$target.hasClass('is-clicked')) {
          $target.attr('aria-expanded', 'true').addClass('is-clicked');
          checkOffScreen($target);
        } else {
          $target.attr('aria-expanded', 'false').removeClass('is-clicked');
          $disclosureWrap.removeClass('disclosure--left');
        }
      }
    })

  },
  unload: function($target){
    $('[data-disclosure]').off();
    $('[data-disclosure-toggle]').off();
  }
}

var sliderBlock = {
  select: function(blockId, $parentSection){
    var $blocks = $parentSection.find('.gallery-cell');
    var blockIdsArray = $blocks.map(function() {
      return String($(this).data('block-id'));
    });

    var $slider = $parentSection.find('[data-slider-id]');
    var settings = {
      slideshowTextAnimation: $slider.data('slideshow-text-animation')
    }
    var flkty = $slider.data('flickity');

    $slider.flickity('pausePlayer');

    for(var i = 0; i < blockIdsArray.length; i++){
      if(blockIdsArray[i] === blockId){
        var currentSlide = i;
        if (currentSlide !== flkty.selectedIndex){
          $slider.flickity( 'select', parseInt(currentSlide), false, true);
        }
      }
    }
  },
  deselect: function($parentSection){
    var $slider = $parentSection.find('.flexslider').data('flexslider');
    if($slider) {
      $slider.flickity('unpausePlayer');
    }
  }
}

/*============================================================================
  Quick shop
==============================================================================*/

var globalQuickShopProduct;

var quickShop = {
  init: function(){

    //EVENT - click on quick-shop
    $('body').on('click', '.js-quick-shop-link', function(e){
      e.stopImmediatePropagation();
      e.preventDefault();

      //Set productData object based on data attributes
      var productData = {
        handle: $(this).data('handle'),
        product_id: $(this).data('id'),
        single_variant: $(this).attr('data-single-variant'),
        product_in_collection_url: $(this).data('url'),
        escaped_title: $(this).data('title').replace('"',""),
        escaped_vendor: $(this).data('vendor').replace(/\&/g,'%26'),
        details_text: $(this).data('details-text'),
        full_description: $(this).data('full-description'),
        regular_description: $(this).data('regular-description'),
        feat_img: $(this).data('feat-img'),
        image_array: quickShop.createImageObjects($(this).data('images')),
        thumbnail_array: quickShop.createImageObjects($(this).data('thumbnail-images')),
        collection_handles: $(this).data('collection-handles').trim(',').split(','),
        money_format: $('body').data('money-format')
      }

      //Find current product and notify forms
      var $notifyForm = $(this).next('.js-quickshop-forms__container').find('.notify_form');
      var $productForm = $(this).next('.js-quickshop-forms__container').find('.product_form');

      $.fancybox.open($('.js-quick-shop'), {
        baseClass: 'quick-shop__lightbox product-' + productData.product_id,
        hash: false,
        infobar : false,
        toolbar: false,
        loop: false,
        smallBtn : true,
        video: {
          autoStart: false
        },
        touch: false,
        mobile: {
          preventCaptionOverlap: false,
          toolbar: true,
          buttons: [
            "close"
          ]
        },
        beforeLoad: function(){
          quickShop.beforeOpen(productData);
        },
        afterLoad: function(){
          quickShop.afterContent($productForm, $notifyForm, productData);
          videoFeature.setupRecommendedVideoPlayer();
          productMedia.setupMedia();
        },
        afterShow: function(){

        },
        beforeClose: function(){
          quickShop.beforeClose(productData);
        }
      })

    });

    //Swatch toggler
    $('.swatch_options input').each(function(){
      if($(this).is(':checked')) {
        quickShop.toggleSwatchImages($(this));
      }
    });

    $('.swatch_options label').on('click', function(){
      quickShop.toggleSwatchImages($(this));
    });

  },
  toggleSwatchImages: function(swatchInput){
    var swatchImageID = $(swatchInput).data('image');
    var $quickShopElement = $(swatchInput).parents('.thumbnail').find('.image__container img');

    $quickShopElement.attr('src', swatchImageID);
    $quickShopElement.attr('srcset', swatchImageID);
  },
  createImageObjects: function($images){
    //split image info
    var image_paths_alts = $images.split('~');

    //Create new array with image objects
    var imageArray = image_paths_alts.map(function(image){
      var imageInfo = image.split('^');
      return {
        path: imageInfo[0],
        alt: imageInfo[1],
        id: imageInfo[2],
        mediaType: imageInfo[4]
      }
    });

    return imageArray;
  },
  beforeOpen: function(productData) {

    //Add image elements before gallery is opened
    quickShop.populateGallery(productData);

    $('.js-sale-banner, .js-sold-out, .js-current-price, .js-was-price, .js-savings, .js-new-banner, .js-pre-order-banner').empty();
    $('.modal_price, .js-notify-form').show();

    if (productData.image_array.length > 1) {
      $('.js-gallery-modal').addClass('multi-image');
      $('.js-gallery-modal').removeClass('single-image');
      $('.js-gallery-modal').addClass('is-draggable');
    } else {
      $('.js-gallery-modal').addClass('single-image');
      $('.js-gallery-modal').removeClass('multi-image');
    }

  },
  afterContent: function($productForm, $notifyForm, productData) {

    quickShop.retrieveProductInfo(productData);

    videoFeature.setupVideoPlayer();

    var $productGallery =  $('.js-gallery-modal');

    productPage.enableGallery($productGallery);

    //Copy latest form data to modal
    $('.quick-shop__lightbox .js-notify-form').append($notifyForm.last());
    $('.quick-shop__lightbox .js-product-form').append($productForm.last());

    //Initiate selectCallback
    if($productForm.hasClass("product_form_options") && $productForm.hasClass("viewed") == false) {
      //If form hasn't been viewed previously, run OptionSelectors function
      new Shopify.OptionSelectors($productForm.data("select-id"),
      {
        product: $productForm.data("product"),
        onVariantSelected: selectCallback,
        enableHistoryState: $productForm.data("enable-state")
      });
    } else {
      //If form has been previously viewed, just convert currencies
      if (Currency.show_multiple_currencies) {
        currencyConverter.convertCurrencies();
      }
    }

    //Link sold out options when there is more than one option available (eg. S is selected and Yellow option appears as sold out)
    if (Shopify.theme_settings.product_form_style == 'swatches'){
      var JSONData = $productForm.data('product');
      var productID = productData.section_id;
      var productSection = '.product-' + productID + ' .js-product_section';
      var swatchOptions = $productForm.find('.swatch_options .swatch');
      if (swatchOptions.length > 1){
        Shopify.linkOptionSelectors(JSONData, productSection);
      }
    }

    $('.js-quick-shop select[name="id"]').trigger('change');

    utils.initializeTabs();

    productPage.productSwatches();

  },
  beforeClose: function(productData) {

    var $insertedNotifyForm = $('.quick-shop__lightbox .notify_form');
    var $insertedProductForm = $('.quick-shop__lightbox .product_form');

    //Copy form data back to product loop and add .viewed
    $('.js-quickshop-forms--'+ productData.product_id).append($insertedProductForm);
    $('.js-quickshop-forms--'+ productData.product_id).append($insertedNotifyForm);
    $('.js-quickshop-forms--'+ productData.product_id +' .product_form').addClass('viewed');
    $('.js-quickshop-forms--'+ productData.product_id +' .notify_form').addClass('viewed');

    //Find gallery and carousel
    var $gallery = $('.js-gallery-modal');
    var $carousel = $('.js-gallery-carousel');

    $('.js-gallery-carousel .gallery-cell').off('click');

    //Remove image slides from gallery
    $gallery.flickity( 'remove', $('.gallery-cell', $gallery));

    //Destroy sliders when modal closes
    $gallery.flickity('destroy');
    if ($carousel.hasClass('flickity-enabled')){
      $carousel.flickity( 'remove', $('.gallery-cell', $carousel) );
      $carousel.flickity('destroy');
    } else {
      $carousel.find('.gallery-cell').remove();
    }

    var variantPrice = $('.js-current-price .money').text();
    $('.js-quick-shop-link[data-id=' + productData.product_id + ']').attr('data-initial-modal-price', variantPrice);
    $('.js-current-price, .js-was-price, .js-savings').empty();

  },
  retrieveProductInfo: function(productData){
    $.ajax({
      dataType: "json",
      async: false,
      cache: false,
      url: "/products/" + productData.handle + ".js",
      success: function(product) {
        //Create new object combining info
        product = $.extend({}, product, productData);

        globalQuickShopProduct = product;
        quickShop.updateVariant(product.variants[0].id.toString(), product);

      }
    });

  },
  updateVariant: function(variant){

  if (globalQuickShopProduct != 'undefined'){

    var product = globalQuickShopProduct;

    $('.js-current-price').html('');
    $('.js-was-price').html('');
    $('.js-savings').html('');

      //Title and Vendor
      $('.js-product-title').html('<a href="'+ product.product_in_collection_url +'" title="'+ product.escaped_title +'">'+ product.title +'</a>');
      $('.js-product-vendor')
      .html('<a href="/collections/vendors?q=' + product.escaped_vendor +'">' + product.vendor + '</a>');

      //Product Description
      $('.js-full-description').html(product.full_description);
      $('.js-regular-description').html(product.regular_description);
      var productDetails = '<a href="'+ product.product_in_collection_url +'" class="secondary_button" title="'+ product.escaped_title +' Details">'+ product.details_text +'</a>';
      $('.js-product-details').html(productDetails);

      //Collection banners
      $.each( product.collection_handles, function( value, index ) {
        if (this.toString() == 'new'){
          $('.js-new-banner').html(Shopify.translation.new_text);
        }
        if (this.toString() == 'pre-order'){
          $('.js-pre-order-banner').html(Shopify.translation.pre_order_text);
        }
        if (this.toString() == 'coming-soon'){
          product.price = Shopify.translation.coming_soon_text;
        }

      });

      if (product.single_variant == 'true'){

        //No variants
        //Sale Banner
        if (Shopify.theme_settings.sale_banner_enabled){
          if (product.compare_at_price > product.price){
            $('.js-sale-banner').html(Shopify.translation.sale_text);
          }
        }

        //Sale
        if (product.compare_at_price > product.price) {
          $('.js-current-price').addClass('sale');
        } else {
          $('.js-current-price').removeClass('sale');
        }

        //Availability
        if (product.available == false){
          if (product.price == Shopify.translation.coming_soon_text) {
            $('.js-sold-out').html(Shopify.translation.coming_soon_text)
          } else {
            $('.js-sold-out').html(Shopify.theme_settings.sold_out_text);
          }
        } else {
          $('.js-sold-out').html('');
        }

        //Price
        if (product.available == true || product.available == false && Shopify.theme_settings.display_sold_out_price) {
          if (product.compare_at_price > product.price) {
            $('.js-was-price').html('<span class="money">' + Shopify.formatMoney(product.variants[0].compare_at_price, product.money_format)  + '</span>');
            $('.js-savings').html(Shopify.translation.savings_text + ' ' + parseInt(((product.variants[0].compare_at_price - product.variants[0].price) * 100) / product.variants[0].compare_at_price) + '% (' + '<span class="money">' + Shopify.formatMoney(product.variants[0].compare_at_price - product.variants[0].price, product.money_format) + '</span>)');
          }

          if (product.price == Shopify.translation.coming_soon_text){
            $('.js-current-price').html(Shopify.translation.coming_soon_text);
          } else if (product.price) {
            $('.js-current-price').html('<span class="money">' + Shopify.formatMoney(product.variants[0].price, product.money_format) + '</span>');
          } else {
            $('.js-current-price').html(Shopify.theme_settings.free_text);
          }
        }

        //Notify Form
        if (product.available == true) {
          $('.js-notify-form').hide();
        } else {
          $('.js-notify-form').show();
        }

      } else {

        //Variant loop
        for (var i = 0; i < product.variants.length; i++) {

          if (variant == product.variants[i].id.toString()){
            //Sale Banner
            if (Shopify.theme_settings.sale_banner_enabled){
              if (product.variants[i].compare_at_price > product.variants[i].price){
                $('.js-sale-banner').html(Shopify.translation.sale_text);
              }
            }

            //Sale
            if (product.variants[i].compare_at_price > product.variants[i].price) {
              $('.js-current-price').addClass('sale');
            } else {
              $('.js-current-price').removeClass('sale');
            }

            //Availability
            if (product.variants[i].available == false){
              if (product.price == Shopify.translation.coming_soon_text) {
                $('.js-sold-out').html(Shopify.translation.coming_soon_text)
              } else if ($('.js-current-price').parents('.modal_price').hasClass('variant-unavailable')){
                $('.js-sold-out').html(Shopify.translation.unavailable_text);
              } else {
                $('.js-sold-out').html(Shopify.theme_settings.sold_out_text);
              }
            } else {
              $('.js-sold-out').html('');
            }

            //Extra check to ensure the product is not unavailable
            if ($('.js-current-price').parents('.modal_price').hasClass('variant-unavailable')){
              $('.js-sold-out').html(Shopify.translation.unavailable_text);
            }

            //Notify Form
            if (product.variants[i].available == true) {
              $('.js-notify-form').hide();
            } else {
              $('.js-notify-form').show();
            }

            //Price
            if (product.variants[i].available == true || product.variants[i].available == false && Shopify.theme_settings.display_sold_out_price){

              if (product.variants[i].compare_at_price > product.variants[i].price) {
                $('.js-was-price').html('<span class="money">' + Shopify.formatMoney(product.variants[i].compare_at_price, product.money_format) + '</span>');
                $('.js-savings').html(Shopify.translation.savings_text + ' ' + parseInt(((product.variants[i].compare_at_price - product.variants[i].price) * 100) / product.variants[i].compare_at_price) + '% (' + '<span class="money">' + Shopify.formatMoney(product.variants[i].compare_at_price - product.variants[i].price, product.money_format) + '</span>)');
              }

              if (product.price == Shopify.translation.coming_soon_text){
                $('.js-current-price').html(Shopify.translation.coming_soon_text);
              } else if (product.variants[i].price) {
                $('.js-current-price').html('<span class="money">' + Shopify.formatMoney(product.variants[i].price, product.money_format) + '</span>');
              } else {
                $('.js-current-price').html(Shopify.theme_settings.free_text);
              }
            }
          }
        }
      }
    }
    if (Currency.show_multiple_currencies) {
      currencyConverter.convertCurrencies();
    }
  },
  populateGallery: function(productData){

    //Find gallery and carousel
    var $gallery = $('.js-gallery-modal');
    var $carousel = $('.js-gallery-carousel');

    //Add gallery images based on product info from API
    function addMainGalleryImages(){

      $.each( productData.image_array, function( i, image ){

        if (image.path == '' || image.id == undefined) {
          var imgPath = productData.feat_img;
        } else {
          var imgPath = image.path;
        }

        if (image.alt == undefined || image.alt == '') {
          var alt = "";
        } else {
          var alt = image.alt;
        }

        var img2048x2048 = imgPath.replace(/(\.[^.]*)$/, "_2048x2048$1").replace('http:', '');
        var cellContent;

        if (image.mediaType.indexOf("image") >= 0) {
          cellContent = '<div class="image__container" style="max-width:' + image.width + 'px"><img class="lazyload '+ Shopify.theme_settings.image_loading_style +'" src="' + imgPath + '" alt="${alt}" data-zoom-src="' + imgPath +'" data-image-id="' + image.id + '" data-index="' + i + '" /></div>';
        } else {
          cellContent = unescape(imgPath);
        }

        var $cellElems = $('<div class="gallery-cell">'+ cellContent +'</div>');
        $('.js-gallery-modal').append($cellElems);
      });

    }

    //Add carousel images based on product info from API
    function addCarouselGalleryImages(){

      $.each( productData.thumbnail_array, function( i, image ){
        if (image.path != '') {
          var imgPath = image.path;
          var carouselSizedImg = imgPath.replace(/(\.[^.]*)$/, "_grande$1").replace('http:', '');

          var mediaBadge = '';

          if (image.alt.indexOf("model") >= 0) {
            mediaBadge = '<span class="icon media-badge"><svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 25H25V1H1V25Z" fill=""/><path class="media-badge__outline" d="M0.5 25V25.5H1H25H25.5V25V1V0.5H25H1H0.5V1V25Z" stroke="" stroke-opacity="0.05"/><g opacity="0.6"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 6L19.0622 9.5V16.5L13 20L6.93782 16.5V9.5L13 6Z" stroke="" stroke-width="1.5"/><path fill-rule="evenodd" clip-rule="evenodd" d="M13 20V12.6024C13.6225 12.2002 13.6225 12.2002 13.6225 12.2002L19 9V16.4082L13 20Z" fill=""/></g></svg></span>';
          } else if(image.alt.indexOf('external_video') >= 0 || image.alt.indexOf('video') >= 0 ) {
            mediaBadge = '<span class="icon media-badge"><svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 25H25V1H1V25Z" fill=""/><path class="media-badge__outline" d="M0.5 25V25.5H1H25H25.5V25V1V0.5H25H1H0.5V1V25Z" stroke="" stroke-opacity="0.05"/><path fill-rule="evenodd" clip-rule="evenodd" d="M8.19995 5.8V20.2L19.3999 12.5858L8.19995 5.8Z" fill="" fill-opacity="0.6"/></svg></span>';
          }

          var img = '<img src="'+ carouselSizedImg + '" alt="' + escape(image.alt) + '" />';
          var $carouselCellElems = $('<div class="gallery-cell product-gallery__thumbnail">'+ img + mediaBadge +'</div>');
          $carousel.append($carouselCellElems);
        }
      });

      imageFunctions.linkGalleryAndCarousel($gallery, $carousel);

    }

    addMainGalleryImages();

    // Adds carousel images to thumbnail slider if there is more than one slide in main gallery
    if ($gallery.find('.gallery-cell').length > 1) {
      addCarouselGalleryImages();
    }

  }
}

/*============================================================================
  Newsletter Popup
==============================================================================*/

var newsletter_popup = {
  init: function(){
    var popup = Cookies.get('popup');
    var newsletter_popup_days = parseInt(Shopify.theme_settings.newsletter_popup_days);
    var cookie_enabled = newsletter_popup_days != 0 ? true : false;
    if (cookie_enabled && popup == 'open') {
      return false;
    } else {
      newsletter_popup.open();
    }
    if (cookie_enabled) {
      Cookies.set('popup', 'open', { expires: newsletter_popup_days });
    }
  },
  open: function(){
    var newsletter_popup_seconds = parseInt(Shopify.theme_settings.newsletter_popup_seconds);

    if (Shopify.theme_settings.newsletter_popup_mobile || Shopify.media_queries.large.matches) {
      setTimeout( function() {
        $.fancybox.open($('.js-newsletter-popup'), {
          baseClass: 'newsletter__lightbox',
          hash: false,
          infobar : false,
          toolbar: false,
          loop: true,
          smallBtn : true,
          mobile: {
            preventCaptionOverlap: false,
            toolbar: true,
            buttons: [
              "close"
            ]
          }
        });
      },
      newsletter_popup_seconds * 1000);
    }
  }
}

/*============================================================================
Product media controls
==============================================================================*/

var productMedia = {
  models: [],
  setupMedia: function() {
    var config = {
      // Default control list
      controls: [
        'zoom-in',
        'zoom-out',
        'fullscreen'
      ],
      focusOnPlay: false
    }

    $($('model-viewer', $('.js-product-gallery, .js-gallery-modal'))).each(function(index, model) {
      model = new Shopify.ModelViewerUI(model, config);
      productMedia.models.push(model)
    })

    $('.product-gallery__model model-viewer').on('mousedown',function(){
      productMedia.hideModelIcon(this);
    })
  },
  showModelIcon: function(slide) {
    $(slide).find('.button--poster, .model-icon-button-control').show();
  },
  hideModelIcon: function(slide) {
    $(slide).find('.button--poster, .model-icon-button-control').hide();
  }
}

/*============================================================================
Plyr setup
==============================================================================*/

var videoEl = {
  playButtonIcon:'<button type="button" class="plyr__control plyr__control--overlaid" aria-label="Play, {title}" data-plyr="play"><svg class="play-icon-button-control" width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="60" height="60" fill="white"/><path fill-rule="evenodd" clip-rule="evenodd" d="M23 20V40L39 29.4248L23 20Z" fill="#323232"/></svg><span class="plyr__sr-only">Play</span></button>',
  playButton: '<button type="button" class="plyr__controls__item plyr__control" aria-label="Play, {title}" data-plyr="play"><svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-pause"></use></svg><svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-play"></use></svg><span class="label--pressed plyr__tooltip" role="tooltip">Pause</span><span class="label--not-pressed plyr__tooltip" role="tooltip">Play</span></button>',
  muteButton: '<button type="button" class="plyr__controls__item plyr__control" aria-label="Mute" data-plyr="mute"><svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-muted"></use></svg><svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-volume"></use></svg><span class="label--pressed plyr__tooltip" role="tooltip">Unmute</span><span class="label--not-pressed plyr__tooltip" role="tooltip">Mute</span></button>',
  progressInput: '<div class="plyr__controls__item plyr__progress__container"><div class="plyr__progress"><input data-plyr="seek" type="range" min="0" max="100" step="0.01" value="0" aria-label="Seek"><progress class="plyr__progress__buffer" min="0" max="100" value="0">% buffered</progress><span role="tooltip" class="plyr__tooltip">00:00</span></div></div>',
  volume: '<div class="plyr__controls__item plyr__volume"><input data-plyr="volume" type="range" min="0" max="1" step="0.05" value="1" autocomplete="off" aria-label="Volume"></div>',
  fullscreen: '<button type="button" class="plyr__controls__item plyr__control" data-plyr="fullscreen"><svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-exit-fullscreen"></use></svg><svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-enter-fullscreen"></use></svg><span class="label--pressed plyr__tooltip" role="tooltip">Exit fullscreen</span><span class="label--not-pressed plyr__tooltip" role="tooltip">Enter fullscreen</span></button>'
}

var videoControls = videoEl.playButtonIcon + '<div class="plyr__controls">' + videoEl.playButton + videoEl.progressInput + videoEl.muteButton + videoEl.volume + videoEl.fullscreen + '</div>';
var globalVideoPlayers = [];
var videoPlayers = [];
var videosInRecommendedProductsPlayer;

videoFeature = {
  init: function() {

    this.setupVideoPlayer();
    this.setupRecommendedVideoPlayer();

  },
  setupVideoPlayer: function() {
    var productVideos = document.querySelectorAll('[data-html5-video] video, [data-youtube-video]');

    var setupVideoPlayers = Plyr.setup(productVideos, {
      controls: videoControls,
      ratio: this.aspect_ratio,
      fullscreen: {
        enabled: true,
        fallback: true,
        iosNative: true
      },
      storage: {
        enabled: false
      }
    });

    // Moves players into global array so that we can target them for play/pause on global level
    if (globalVideoPlayers) {
      $.each(setupVideoPlayers, function(index, player) {
        globalVideoPlayers.push(player);
      })
    }

    var videoLooping = $('[data-video-loop]').data('video-loop') || false;
    $.each(setupVideoPlayers, function(index, player) {
      player.loop = videoLooping;
      videoPlayers.push(player);
    });

    this.setupListeners();
  },
  setupPlayerForRecentlyViewedProducts: function(video) {

    if (video) {
      var recentlyViewedProductPlayer = new Plyr(video, {
        controls: videoControls,
        ratio: this.aspect_ratio,
        fullscreen: {
          enabled: true,
          fallback: true,
          iosNative: true
        },
        storage: {
          enabled: false
        }
      });

      if (videoPlayers !== null) {
        videoPlayers.push(recentlyViewedProductPlayer);
        this.setupListeners();
      }

    }
  },
  setupRecommendedVideoPlayer: function() {
    var videosInRecommendedProducts = document.querySelectorAll('.product-recommendations [data-html5-video] video, .product-recommendations [data-youtube-video]');

    // Only run Plyr.setup if videosInRecommendedProducts exists
    if (videosInRecommendedProducts.length > 0) {
      videosInRecommendedProductsPlayer = Plyr.setup(videosInRecommendedProducts, {
        controls: videoControls,
        fullscreen: {
          enabled: true,
          fallback: true,
          iosNative: true
        },
        storage: {
          enabled: false
        }
      });
      if (videoPlayers !== null) {
        var combinedArray = videoPlayers.concat(videosInRecommendedProductsPlayer);
        videoPlayers = combinedArray;
      } else {
        videoPlayers = videosInRecommendedProductsPlayer;
      }
    }

    this.setupListeners();
  },
  setupListeners: function() {
    // Adds plyr video id to video wrapper
    $.each(videoPlayers, function(index, player) {
      var id = player.id || player.media.dataset.plyrVideoId;
      var $video;

      if (player.isHTML5) {
        $video = $(player.elements.wrapper).find('video');
        $video.attr('data-plyr-video-id', id);
      }
    })

    // When a video is playing, pause any other instances
    $.each(globalVideoPlayers, function(index, player) {
      player.on('play', function(event) {
        var instance = event.detail.plyr;
        $.each(globalVideoPlayers, function(index, player) {
          if (instance.id != player.id ) {
            player.pause();
          }
        })
      })
    })
  },
  enableVideoOnHover: function($thumbnail) {

    var $html5Video = $thumbnail.find('[data-html5-video]');
    var $youtubeVideo = $thumbnail.find('[data-youtube-video]');
    var videoID;

    if ($html5Video.length > 0) {
      videoID = $html5Video.find('[data-plyr-video-id]').data('plyr-video-id');
    } else if ($youtubeVideo.length > 0) {
      videoID = $youtubeVideo.find('iframe').attr('id');
    }

    if (videoID) {
      $.each(videoPlayers, function(index, player) {

        if (player.id == videoID || player.media.id == videoID) {
          player.toggleControls(false);
          player.muted = true;
          player.play();
        }
      })
    }
  },
  disableVideoOnHover: function($thumbnail) {
    var $html5Video = $thumbnail.find('[data-html5-video]');
    var $youtubeVideo = $thumbnail.find('[data-youtube-video]');
    var videoID;

    if ($html5Video.length > 0) {
      videoID = $html5Video.find('[data-plyr-video-id]').data('plyr-video-id');
    } else if ($youtubeVideo.length > 0) {
      videoID = $youtubeVideo.find('iframe').attr('id');
    }

    if (videoID) {
      $.each(videoPlayers, function(index, player) {
        if (player.id == videoID || player.media.id == videoID) {
          if (player.playing) {
            player.pause();
          }
        }
      })
    }
  }
}

/* ------------ app.js ------------------*/
//document ready
$(function() {
    utils.enableDisclosure();
    var oldFlickityCreate = window.Flickity.prototype._create;
  
    window.Flickity.prototype._create = function(){
      var that = this;
      if(this.element.addEventListener){
        this.element.addEventListener('load', function(){
          that.onresize();
        }, true);
      }
      this._create = oldFlickityCreate;
      return oldFlickityCreate.apply(this, arguments);
    };
  
    // Call to flickity fix for sliders on IOS
    imageFunctions.flickityIosFix();
  
    objectFitImages();
    //header.loadMegaMenu();
    header.init();
    if (Shopify.theme_settings.enable_autocomplete){
      searchAutocomplete.init();
    }
    utils.pageBannerCheck();
    slideshow.init();
    testimonial.init();
    videoSection.init();
    gallery.init();
    videoFeature.setupVideoPlayer();
    featuredPromotions.init();
    featuredCollectionSection.init();
    CollectionListSection.init();
    collectionSidebarFilter.init();
    cart.init();
    mapFunction.init();
    productPage.init();
    recentlyViewed.init();
  
    if (Currency.show_multiple_currencies || Currency.native_multi_currency) {
      currencyConverter.init();
    }
  
    // Challenge page scroll
  
    // Return the pathname of the current URL
    var pathname = location.pathname;
  
    // If the pathname starts with '/challenge', animate scroll
    if(pathname.startsWith('/challenge')) {
      $('html, body').animate({
        scrollTop: 0
      }, 'slow' );
    }
  
    // Setup a timer
    var resizeTimeout;
    // Grab screen width before screen is resized
    var beforeResizeWidth = $(window).width();
  
    // Listen for resize events
    window.addEventListener('resize', function ( event ) {
  
      // If timer is null, reset it to 66ms and run your functions.
      // Otherwise, wait until timer is cleared
      if ( !resizeTimeout ) {
        resizeTimeout = setTimeout(function() {
  
          // Reset timeout
          resizeTimeout = null;
          // Grab screen width after screen is resized
          var currentScreenWidth = $(window).width();
          // Run our resize functions
          if(Shopify.media_queries.medium.matches && currentScreenWidth !== beforeResizeWidth) {
            cart.init();
            header.unload();
            header.init();
          }
  
        }, 66);
      }
    }, false);
  
    //Lightbox default options
    //https://fancyapps.com/fancybox/3/docs/#options
    $.fancybox.defaults.animationEffect = 'fade';
    $.fancybox.defaults.transitionEffect = 'fade';
    $.fancybox.defaults.hash = false;
    $.fancybox.defaults.infobar = false;
    $.fancybox.defaults.toolbar = false;
    $.fancybox.defaults.arrows = false;
    $.fancybox.defaults.loop = true;
    $.fancybox.defaults.smallBtn = true;
    $.fancybox.defaults.live = false;
    $.fancybox.defaults.zoom = false;
    $.fancybox.defaults.mobile.preventCaptionOverlap = false;
    $.fancybox.defaults.mobile.toolbar = true;
    $.fancybox.defaults.mobile.buttons = ['close'];
    $.fancybox.defaults.mobile.clickSlide = 'close';
    $.fancybox.defaults.mobile.clickContent = 'zoom';
    $.fancybox.defaults.afterLoad = function(instance, slide) {
      if (instance.current.type == 'image'){
        slide.$content.wrapInner( "<div class='fancybox-image-wrap'></div>" )
      }
      if (instance.group.length > 1){
        slide.$content.find('.fancybox-image-wrap').append('<a title="Previous" class="fancybox-item fancybox-nav fancybox-prev" href="javascript:;" data-fancybox-prev><span>'+ svgArrowSizeLeft +'</span></a><a title="Next" class="fancybox-item fancybox-nav fancybox-next" href="javascript:;" data-fancybox-next><span>'+ svgArrowSizeRight +'</span></a>')
      }
    }
  
    //backwards compatibility with custom lightboxes
    $('.lightbox[rel="gallery"]').fancybox();
  
    // Find youtube and vimeo iframes
    var $videoIframes = $('iframe[src*="youtube.com"], iframe[src*="vimeo.com"], iframe[src*="facebook.com/plugins/video"]');
  
    // For each iframe, if parent is a responsive video wrapper do nothing
    // If no parent responsive video wrapper, then wrap iframe in responsive video wrapper
  
    function getAspectRatio(width, height) {
      var ratio = width / height;
  
      //Determine ratio to be used
      if(Math.abs( ratio - 1 / 1 ) == 0) {
        return '1:1';
      } else {
        return ( Math.abs( ratio - 4 / 3 ) < Math.abs( ratio - 16 / 9 ) ) ? '4:3' : '16:9';
      }
    }
  
    $videoIframes.each(function(index, iframe) {
  
      // Update selector
      var $iframe = $(iframe);
  
      // Grab src
      var source = $iframe.attr('src');
  
      if (!$iframe.parents('.plyr__video-wrapper').length && !$iframe.parents('.lazyframe').length) {
        $iframe.wrap('<div class="lazyframe" data-ratio="'+ getAspectRatio($iframe.attr('width'), $iframe.attr('height'))  +'" data-src="' + source + '"></div>');
      }
    })
  
    // Initiate lazyframe
    lazyframe('.lazyframe');
  
    // Prevent header overlap on dynamically generated policy pages. Add pagecontent tag to match current page structure.
    $('.shopify-policy__container').parent().prepend('<a name="pagecontent" id="pagecontent"></a>');
  
    //Add classes to determine column size
    $('.shopify-policy__container').addClass('ten offset-by-three columns');
  
    //Add featured divider beneath page title
    $('.shopify-policy__title').append('<div class="feature_divider"></div>');
  
   
  
    //Search input hiding
    //get current input
    var currentValue = $(".search_form input[name='q']").val()
    //return amount without *
    if ($(".search_form input[name='q']").length > 0){
      $(".search_form input[name='q']").val( currentValue.replace('*', '') );
    }
  
    $('#sort-by').val($('#sort-by').data('default-sort'));
  
    $('body')
      .on('change', '#sort-by', function() {
        quickFilter.init();
    });
  
    $('body')
      .on('change', '#tag_filter', function() {
        $('[data-option-filter] input').prop('checked', false);
        quickFilter.init();
    });
  
    $('body')
      .on('change', '#blog_filter', function() {
        var url = $(this).val();
        window.location = url;
    });
  
    $('input, select, textarea').on('focus blur', function(event) {
      $('meta[name=viewport]').attr('content', 'width=device-width,initial-scale=1,maximum-scale=' + (event.type == 'blur' ? 10 : 1));
    });
  
    //Collection sidebar filter
    //Check the checkbox values
    $('body').on('change', '[data-option-filter] input', function(){
      quickFilter.init();
      $("html, body").animate({
        scrollTop: ($('#pagecontent').offset().top)
      }, 500);
    })
  
    $('body').on('click', '[data-reset-filters]', function(){
      collectionSidebarFilter.clearAllFilters();
    });
  
    $('.scroll-button').on('click', function (e) {
      e.preventDefault();
      id = $(this).attr('href');
      $("html, body").animate({
        scrollTop: ($(id).offset().top)
      }, 500);
    })
  
    $('body').on('click', '[data-clear-filter]', function(){
      var selectedOption = $(this).parents('.filter-active-tag');
      collectionSidebarFilter.clearSelectedFilter(selectedOption);
    });
  
    $('body').on('change', '.currencies', function(e) {
        $('[data-initial-modal-price]').attr('data-initial-modal-price', '');
    });
  
    $('body').on('change', '.js-quick-shop select', function(e) {
        var currentVariant = $('.js-quick-shop select[name="id"]').val();
        if (currentVariant && globalQuickShopProduct){
          quickShop.updateVariant(currentVariant);
        }
    });
  
    if (Shopify.theme_settings.quick_shop_enabled){
      quickShop.init();
    }
  
    var touchStartPos = 0;
  
    //Detecting swipe vs tap
    $(document).bind("touchstart", function (e) {
      touchStartPos = $(window).scrollTop();
    }).bind("touchend", function (e) {
        var distance = touchStartPos - $(window).scrollTop();
        if (distance > 20 || distance < -20) {
            e.preventDefault;
        }
    });
  
    $('body').on('click', '.sidebar .parent-link--false', function(e) {
      e.preventDefault();
      $menu = $(this).parent('li');
      $menu.find('.menu-toggle').toggleClass('active');
      $menu.find('ul').slideToggle();
    });
  
    if (Shopify.theme_settings.newsletter_popup){
      newsletter_popup.init();
    }
  
    if(window.location.pathname.indexOf('/comments') != -1) {
      $('html,body').animate({scrollTop: $("#new-comment").offset().top-140},'slow');
    }
  
    $('body').on('mouseenter', '.icon-search', function() {
      $('.search-terms').focus();
    });
  
    $('body').on('click', '.icon-search', function() {
      $('input.search-terms').focus();
    });
  
    $('body').on('click', '.search-submit', function() {
      $(this).parent().submit();
    });
  
    if (Shopify.media_queries.large.matches) {
      $(".animate_right").waypoint(function() {
        $(this.element).addClass("animated fadeInRight");
      }, { offset: '70%' });
      $(".animate_left").waypoint(function() {
        $(this.element).addClass("animated fadeInLeft");
      }, { offset: '70%' });
      $(".animate_up").waypoint(function() {
        $(this.element).addClass("animated fadeInUp");
      }, { offset: '70%' });
      $(".animate_down").waypoint(function() {
        $(this.element).addClass("animated fadeInDown");
      }, { offset: '70%' });
    }
  
    //backwards compatibility with flexslider
    $('.slider, .flexslider').find('li').unwrap();
    $('.slider, .flexslider').flickity({
      pageDots: usePageDots,
      imagesLoaded: true,
      arrowShape: arrowSize,
      lazyLoad: 2
    });
  
    utils.createAccordion('.toggle-all--true', 'h4.toggle', 'ul.toggle_list');
    utils.createAccordion('.footer_menu', 'h6', 'ul');
    utils.createAccordion('.footer_content', 'h6', 'div.toggle_content');
    utils.createAccordion('.product_section .accordion-tabs', '.tabs li > a', '.tabs-content li');
  
    utils.mobileParentActiveAccordion('#mobile_menu', 'li.sublink > a.parent-link--true span', 'li.sublink ul');
    utils.mobileAccordion('#mobile_menu', 'li.sublink > a.parent-link--false', 'li.sublink ul');
  
    utils.initializeTabs();
    utils.resizeActionButtons();
    globalAccordions.init();
  
    $(window).on('resize', function() {
      utils.resizeActionButtons();
    });
  
    //Sidebar toggle check
    if (Shopify.media_queries.medium.matches) {
      utils.createAccordion('.toggle-all--false', 'h4.toggle', 'ul.toggle_list');
    }
  
    $('body').on('click', '.menu-toggle', function(e) {
      var $content = $(this).next('ul');
      $content.slideToggle();
      $(this).toggleClass('active');
      $(this).attr('aria-expanded', $(this).attr('aria-expanded') == 'true' ? 'false' : 'true');
    });
  
    if (Shopify.theme_settings.collection_swatches){
      if (Shopify.media_queries.large.matches) {
        $('body').on('mouseenter', '.collection_swatches', function() {
          $('.swatch span', $(this)).each(function() {
            if($(this).data("image").indexOf("no-image") == -1) {
              $('<img/>')[0].src = $(this).data("image");
            }
          });
        });
        $('body').on('mouseenter', '.swatch span', function() {
          if($(this).data("image").indexOf("no-image") == -1) {
            $(this).parents('.thumbnail').find('.image__container img:not(.secondary)').attr('src', $(this).data("image"));
            $(this).parents('.thumbnail').find('.image__container img:not(.secondary)').attr('srcset', $(this).data("image"));
          }
        });
      }
    }
  
    //Terms of service settings for minicart
    if (Shopify.theme_settings.display_tos_checkbox){
      $('body').on('click touchstart', '.cart_content .tos_label', function() {
        $(this).prev('input').prop('checked', true);
      });
    }
  
    if (Shopify.theme_settings.display_tos_checkbox && Shopify.theme_settings.go_to_checkout){
      //Terms of service on mini-cart && cart page
      $('body').on('click', ".tos_warning .action_button", function(e) {
        if ($(this).parents('form').find('.tos_agree').is(':checked')) {
          // Check if we are on the cart page or mini cart
          if (Shopify.theme_settings.go_to_checkout || $('body').hasClass('cart')){
            $(this).submit();
          } else {
            // Redirect to cart page
            e.preventDefault();
            document.location.href = "/cart";
          }
        } else {
          var warning = '<p class="warning animated bounceIn">' + Shopify.translation.agree_to_terms_warning + '</p>';
          if ($('p.warning').length == 0) {
            $(this).before(warning);
          }
          return false;
        }
      });
    } else if (!Shopify.theme_settings.go_to_checkout){
      $('body').on('click', ".cart_content .action_button", function(e) {
        // Redirect to cart page
        e.preventDefault();
        document.location.href = Shopify.routes.cart_url;
      });
    }
  
  
    if (Shopify.theme_settings.collection_secondary_image){
      imageFunctions.showSecondaryImage();
    }
  
    // Contact form checkbox validation
    if ($('[data-is-required]').length){
      var $checkboxGroup = $('.contact-block--checkbox input');
      $checkboxGroup.prop('required', true);
  
      $('.contact-block--checkbox [data-is-required] input').on('change', function(){
        $checkboxGroup.prop('required', true);
        if ($checkboxGroup.is(":checked")) {
          $checkboxGroup.prop('required', false);
        }
      })
    }
  
    $('.maps').click(function () {
      $('.maps iframe').css("pointer-events", "auto");
    });
  
    if (Shopify.theme_settings.pagination_type == 'load_more' ){
      enableLoadMoreProducts();
    }
  
    if (Shopify.theme_settings.pagination_type == 'infinite_scroll'){
      enableInfiniteScroll();
    }
  
    if (Shopify.theme_settings.search_pagination_type == 'load_more' ){
      enableLoadMoreSearch();
    }
  
    if (Shopify.theme_settings.search_pagination_type == 'infinite_scroll' ){
      enableInfiniteSearchScroll();
    }
  
    /*============================================================================
      Start of cart-related functionality
    ==============================================================================*/
  
    function ajaxSubmitCart(cart) {
      $cart = cart;
      $.ajax({
        url: '/cart/update.js',
        dataType: 'json',
        cache: false,
        type: 'post',
        data: $cart.serialize(),
        success: function (data) {
          refreshCart(data);
        }
      });
    }
  
    function updateCartItemQuantity(cartItem) {
      $.ajax({
        url: '/cart/change.js',
        dataType: 'json',
        cache: false,
        type: 'post',
        data: {
          quantity: cartItem.quantity,
          line: cartItem.lineID
        },
        success: function (data) {
  
          var cartItemsArray = data.items;
          var lineIDIndex = cartItem.lineID - 1;
          var totalCartItems = cartItem.parentCartForm.find('[data-variant-id]').length;
          var $quantityInputs = cartItem.parentCartForm.find('[data-variant-id="' + cartItem.variantID + '"] input');
          var initialQuantityTotal = 0;
          var apiQuantityTotal = 0;
          var apiLineItemQuantity = typeof data.items[lineIDIndex] !== 'undefined' ? data.items[lineIDIndex].quantity : 0;
  
          // Check if item has a "Buy X get Y" deal
          if ($quantityInputs.length > 1) {
            // Multiple inputs
  
            // Get all the quantities of same variants in the cart (including BOGO) in HTML
            $.each($quantityInputs, function (i, input) {
              initialQuantityTotal += parseInt($(input).val());
            });
  
            // Get quantities from cart object returned from API
            cartItemsArray.forEach(function (item) {
              if (item.variant_id === cartItem.variantID) {
                apiQuantityTotal += item.quantity;
              }
            })
          } else {
            // Single input
            initialQuantityTotal = parseInt($quantityInputs.val());
            apiQuantityTotal = typeof data.items[lineIDIndex] !== 'undefined' ? data.items[lineIDIndex].quantity : 0;
          }
  
          //Checks to see if there is enough inventory to update to an increased amount
          if (initialQuantityTotal > 0 && initialQuantityTotal > apiQuantityTotal) {
            if (apiQuantityTotal == 1) {
              items_left_text = Shopify.translation.one_item_left;
            } else {
              items_left_text = Shopify.translation.items_left_text;
            }
  
            $('.warning--quantity').remove();
  
            //Check if Buy one get one product
            if (totalCartItems < cartItemsArray.length) {
  
              if (cartItem.parentCartForm.data('cart-form') === 'cart-template') {
                // Refreshes cart if inventory is available
                cartItem.parentCartForm.submit();
              } else {
                refreshCart(data);
              }
            } else {
              var warning = '<p class="warning warning--quantity animated bounceIn">' + apiQuantityTotal + ' ' + items_left_text + '</p>';
              cartItem.parentCartForm.find("[data-line-id='" + cartItem.lineID + "'] input").parent().after(warning);
              cartItem.parentCartForm.find("[data-line-id='" + cartItem.lineID + "'] input").val(apiLineItemQuantity);
            }
  
          } else if (cartItem.parentCartForm.data('cart-form') === 'cart-template') {
            // Refreshes cart if inventory is available
            cartItem.parentCartForm.submit();
          } else {
            refreshCart(data);
          }
        }
      });
    }
  
    function refreshCartID() {
      var cartItem = document.querySelectorAll('.cart__item');
  
      for(var i = 0; i < cartItem.length; i++) {
        var lineIndex = i + 1;
        var dataLineId = cartItem[i].querySelectorAll('[data-line-id]');
  
        for(var c = 0; c < dataLineId.length; c++) {
          dataLineId[c].dataset.lineId = lineIndex;
        }
      }
    }
  
    function refreshCart(cart) {
      $(".cart_count").empty();
      $cartBtn = $(".cart_count");
      var value = $cartBtn.text() || '0';
      var cart_items_html = "";
      var cart_discounts_html = "";
      var cart_action_html = "";
      var cart_savings_html = "";
      var $cart_form = $('[data-cart-form]');
      var productHasSale = false;
      var productCompareAtPrice = 0;
      var productFinalPrice = 0;
  
      $cart_form.data('total-discount', cart.total_discount);
  
      $cartBtn.text(value.replace(/[0-9]+/,cart.item_count));
  
      if (cart.item_count == 0) {
        $('.js-empty-cart__message').removeClass('hidden');
        $cart_form.addClass('hidden');
      } else {
        $('.js-empty-cart__message').addClass('hidden');
        $cart_form.removeClass('hidden');
  
        var total_saving = 0; // adding counter variables for total cart savings
        var saving = 0;
  
        $.each(cart.items, function(index, item) {
          var itemDiscounts = item.discounts;
          var discountMessage = "";
  
          for (i=0; i < itemDiscounts.length; i++) {
            var amount = Shopify.formatMoney(itemDiscounts[i].amount, $('body').data('money-format'));
            var title = itemDiscounts[i].title;
            discountMessage = '<p class="notification-discount meta">' + title + '</p>';
          }
          var line_id = index + 1;
  
          cart_items_html += '<li class="mini-cart__item clearfix" data-cart-item data-line-id="' + line_id + '" data-variant-id="' + item.id + '">' +
            '<a class="image_link" href="' + item.url +'">';
          if (item.image) {
            cart_items_html += '<div class="cart_image mini-cart__item-image">' +
                '<img src="' + item.image.replace(/(\.[^.]*)$/, "_compact$1").replace('http:', '') + '" alt="' + htmlEncode(item.title) + '" />' +
              '</div></a>';
          }
  
          cart_items_html += '<div class="mini-cart__item--content"><div class="mini-cart__item__title"><div class="item_title"><a href="' + item.url + '">' + item.title + '</a></div></div>';
          cart_items_html += '<div class="sub-title"><div class="property">';
          cart_items_html += '<p class="sku">SKU: '+item.sku+'</p></div>';
          cart_items_html += '<a href="/cart/change?line=' + line_id + '&amp;quantity=0" class="js-cart-remove-btn cart__remove-btn" data-line-id="' + line_id + '" data-remove-item="mini-cart">Remove</a></div>';
          cart_items_html += '<strong class="left price">';
  
          $.ajax({
            dataType: "json",
            async: false,
            cache: false,
            url: "/products/" + item.handle + ".js",
            success: function(data) {
              // If item has more than one variant, need to make sure we are pulling data from the correct variant
              if (data.variants) {
                var itemVariants = data.variants;
                if (itemVariants.length > 1) {
                  for (v = 0; v < itemVariants.length; v++) {
                    if (itemVariants[v].id == item.id) {
                      var data = itemVariants[v];
                    }
                  }
                }
              }
  
              // If compare at price exists then item is on sale
              if (data.compare_at_price) {
                if(data.compare_at_price > data.price) {
                  productHasSale = true;
                  productCompareAtPrice = data.compare_at_price;
                  productFinalPrice = data.price;
                }
              } else {
                // Check required for non-sale items
                productHasSale = false;
              }
            }
          });
  
          if(productHasSale == true) {
            //puts the slash through the old item price
            var itemPrice = Shopify.formatMoney(productFinalPrice, $('body').data('money-format')) + ' </span>';
            cart_items_html += '<span class="money sale">' + itemPrice + '</strong>';
  
            // Total savings
            saving = (productCompareAtPrice - productFinalPrice) * item.quantity;
            total_saving = saving + total_saving;
          } else {
            if (item.price > item.final_price) {
              //puts the slash through the old item price
              var itemPrice = Shopify.formatMoney(item.final_price, $('body').data('money-format')) + ' </span>';
              cart_items_html += '<span class="money sale">' + itemPrice + '</strong>';
            } else {
              var itemPrice = Shopify.formatMoney(item.price, $('body').data('money-format'));
              cart_items_html += '<span class="money">' + itemPrice + '</span></strong>';
            }
          }
          
          if (item.price > item.final_price) {
            cart_items_html += discountMessage;
          }
  
          cart_items_html += '<div class="left product-quantity-box">';
          cart_items_html += '<span class="ss-icon product-minus js-change-quantity" data-func="minus"><span class="icon-minus"></span></span>';
          cart_items_html += '<input type="number" min="0" class="quantity" name="updates[]" id="updates_' + item.id + '" value="' + item.quantity + '" data-cart-quantity-input="mini-cart" />';
          cart_items_html += '<span class="ss-icon product-plus js-change-quantity" data-func="plus"><span class="icon-plus"></span></span>';
          cart_items_html += '</div><ul class="product-flags">';
          if(item.properties) {
            $.each(item.properties, function(title, values) {
              if (title == 'product_flag') {
                for (let i = 0; i < values.length; i++) {
                  let value = values[i];
                  var value_array = value.split(',');
                  var title = value_array[0];
                  var color = value_array[1];
                  cart_items_html += '<li class="flag" style="background-color: '+color+';">' + title + ' </li>';
                }
                
              }
            });
          }
          cart_items_html += '</ul></div>';
        });
  
        var cartDiscounts = cart.cart_level_discount_applications;
        var cartDiscountMessage = "";
  
        for (i=0; i < cartDiscounts.length; i++) {
          var amount = Shopify.formatMoney(cartDiscounts[i].total_allocated_amount, $('body').data('money-format'));
          var title = cartDiscounts[i].title;
  
          cart_discounts_html += '<span class="cart_discounts--title">' + title + '</span>';
          cart_discounts_html += '<span class="cart_discounts--price">';
          cart_discounts_html += '-<span class="money">' + amount + '</span></span>';
        }
  
        cart_action_html += '<span class="right"><span class="money">' + Shopify.formatMoney(cart.total_price, $('body').data('money-format')) + '</span></span>' + '<span>' + Shopify.translation.cart_subtotal_text + '</span>';
        total_saving = total_saving + cart.total_discount;
        if(Shopify.theme_settings.display_savings && total_saving > 0) {
          cart_savings_html = '<span class="right"><span class="money">' + Shopify.formatMoney(total_saving, $('body').data('money-format')) + '</span></span>' +
              '<span>' + Shopify.translation.cart_savings_text + '</span>';
        } else {
          cart_savings_html = "";
        }
      }
  
      $('.js-cart_items').html(cart_items_html);
      $('.js-cart_discounts').html(cart_discounts_html);
      $('.js-cart_subtotal').html(cart_action_html);
      $('.js-cart_savings').html(cart_savings_html);
  
      // Converting the currencies
      if (Currency.show_multiple_currencies) {
        currencyConverter.convertCurrencies();
      }
      if (cart.items.length > 0) {
        var freeShippingLimit = $('.cart-message').data('limit')*100;
        var total_price = cart.total_price;
        if (freeShippingLimit > total_price) {
          const leftMoney = freeShippingLimit - total_price
          console.log(leftMoney);
          $('.cart-message h5 span').text(`Only ${Shopify.formatMoney(leftMoney, $('body').data('money-format'))} away from FREE shipping!`);
        } else {
          $('.cart-message h5 span').text("This item qualifies for free shipping");
        }
        $('.cart-message').removeClass('hidden');
      } else {
        $('.cart-message').addClass('hidden');
      }
      
  
    }
    
    $('body').on('mwGroupedProducts', function (event, action) {
      if (action === 'end-add-to-cart') {
        $.ajax({
          url: '/cart.js',
          dataType: "json",
          cache: false,
          success: function(cart) {
            setTimeout(function() {
              refreshCart(cart);
              if($('body').hasClass('fancybox-active')) {
                $.fancybox.close();
              }
  
              $('#mini-cart').addClass('active')
  
              //block scrolling on mobile
              if (Shopify.media_queries.medium.matches) {
                var $cart_container = $(this).parent();
                $('body').addClass('blocked-scroll');
              }
            }, 500)
          }
        });
      }
    })
  
    $('body').on('change', '[data-cart-quantity-input]', function() {
      var cartItem = {
        lineID: $(this).parents('[data-cart-item]').data('line-id'),
        variantID: $(this).parents('[data-cart-item]').data('variant-id'),
        quantity: $(this).val(),
        parentCartForm: $(this).parents('[data-cart-form]'),
        totalDiscount: $(this).parents('[data-cart-form]').data('total-discount'),
        $element : $(this).parents('[data-cart-item]')
      }
      // Disable button after click to prevent multiple clicks
      $(this).parents('.product-quantity-box').find('.js-change-quantity').addClass('is-disabled');
      updateCartItemQuantity(cartItem);
    });
  
  
    $('body').on('click', '[data-remove-item]', function(e) {
      e.preventDefault();
      var cartItem = {
        lineID: $(this).parents('[data-cart-item]').data('line-id'),
        variantID: $(this).parents('[data-cart-item]').data('variant-id'),
        quantity: 0,
        parentCartForm: $(this).parents('[data-cart-form]'),
        totalDiscount: $(this).parents('[data-cart-form]').data('total-discount'),
        $element : $(this).parents('[data-cart-item]')
      }
      cartItem.$element.addClass('animated fadeOutLeft');
  
      updateCartItemQuantity(cartItem);
  
      if (cartItem.parentCartForm.data('cart-form') === 'cart-template') {
        cartItem.$element.find('input').val('0');
        cartItem.parentCartForm.submit();
      }
  
      if (cartItem.parentCartForm.data('cart-form') === 'mini-cart') {
        cartItem.$element.find('input').val('0');
      }
    });
  
    if (Shopify.theme_settings.cart_action == 'ajax'){
      $(document).on('click', '.ajax-submit', function(e) {
        e.preventDefault();
        var $addToCartForm = $(this).closest('form');
        var $addToCartBtn = $addToCartForm.find('.add_to_cart');
  
        //Refresh page on quick shop add to cart if on cart page
        if($('body').hasClass('cart')) {
          $addToCartForm.submit();
        }
  
        $.ajax({
          url: '/cart/add.js',
          dataType: 'json',
          cache: false,
          type: 'post',
          data: $addToCartForm.serialize(),
          beforeSend: function() {
            $addToCartBtn.attr('disabled', 'disabled').addClass('disabled');
            $addToCartBtn.find('span').removeClass("fadeInDown").addClass('animated zoomOut');
          },
          success: function(itemData) {
  
            $addToCartBtn.find('.checkmark').addClass('checkmark-active');
  
            window.setTimeout(function(){
              $addToCartBtn.removeAttr('disabled').removeClass('disabled');
              $addToCartBtn.find('.checkmark').removeClass('checkmark-active');
              $addToCartBtn.find('span').removeClass('zoomOut').addClass('fadeInDown');
            }, 1000);
  
            $.ajax({
              url: '/cart.js',
              dataType: "json",
              cache: false,
              success: function(cart) {
                setTimeout(function() {
                  refreshCart(cart);
                  if($('body').hasClass('fancybox-active')) {
                    $.fancybox.close();
                  }
  
                  $('#mini-cart').addClass('active')
  
                  //block scrolling on mobile
                  if (Shopify.media_queries.medium.matches) {
                    var $cart_container = $(this).parent();
                    $('body').addClass('blocked-scroll');
                  }
                }, 500)
              }
            });
          },
          error: function(XMLHttpRequest) {
            var response = eval('(' + XMLHttpRequest.responseText + ')');
            response = response.description;
            $('.warning').remove();
  
            var warning = '<p class="warning animated bounceIn">' + response.replace('All 1 ', 'All ') + '</p>';
            $addToCartForm.after(warning);
            $addToCartBtn.removeAttr('disabled').removeClass('disabled');
            $addToCartBtn.find('span').text(Shopify.translation.add_to_cart).removeClass('zoomOut').addClass('zoomIn');
          }
        });
  
        return false;
      });
    }
  
    productPage.productSwatches();
  
  });
  
  /*============================================================================
    Swatch options - second and third swatch 'sold-out' will update based on availability of previous options selected
  ==============================================================================*/
  Shopify.updateOptionsInSelector = function(selectorIndex, parent) {
  
    switch (selectorIndex) {
      case 0:
        var key = 'root';
        var selector = $(parent + ' .single-option-selector:eq(0)');
        break;
      case 1:
        var key = $(parent + ' .single-option-selector:eq(0)').val();
        var selector = $(parent + ' .single-option-selector:eq(1)');
        break;
      case 2:
        var key = $(parent + ' .single-option-selector:eq(0)').val();
        key += ' / ' + $(parent + ' .single-option-selector:eq(1)').val();
        var selector = $(parent + ' .single-option-selector:eq(2)');
    }
  
    var availableOptions = Shopify.optionsMap[key];
    $(parent + ' .swatch[data-option-index="' + selectorIndex + '"] .swatch-element').each(function() {
      if ($.inArray($(this).attr('data-value'), availableOptions) !== -1) {
        $(this).removeClass('soldout').find(':radio').removeAttr('disabled','disabled').removeAttr('checked');
      }
      else {
        $(this).addClass('soldout').find(':radio').removeAttr('checked').attr('disabled','disabled');
      }
    });
  
  };
  
  Shopify.linkOptionSelectors = function(product, parent) {
      // Building our mapping object.
      Shopify.optionsMap = {};
      for (var i=0; i<product.variants.length; i++) {
        var variant = product.variants[i];
        if (variant.available) {
          // Gathering values for the 1st drop-down.
          Shopify.optionsMap['root'] = Shopify.optionsMap['root'] || [];
          Shopify.optionsMap['root'].push(variant.option1);
          Shopify.optionsMap['root'] = Shopify.uniq(Shopify.optionsMap['root']);
          // Gathering values for the 2nd drop-down.
          if (product.options.length > 1) {
            var key = variant.option1;
            Shopify.optionsMap[key] = Shopify.optionsMap[key] || [];
            Shopify.optionsMap[key].push(variant.option2);
            Shopify.optionsMap[key] = Shopify.uniq(Shopify.optionsMap[key]);
          }
          // Gathering values for the 3rd drop-down.
          if (product.options.length === 3) {
            var key = variant.option1 + ' / ' + variant.option2;
            Shopify.optionsMap[key] = Shopify.optionsMap[key] || [];
            Shopify.optionsMap[key].push(variant.option3);
            Shopify.optionsMap[key] = Shopify.uniq(Shopify.optionsMap[key]);
          }
        }
      }
      // Update options right away.
      Shopify.updateOptionsInSelector(0, parent);
      if (product.options.length > 1) Shopify.updateOptionsInSelector(1, parent);
      if (product.options.length === 3) Shopify.updateOptionsInSelector(2, parent);
      // When there is an update in the first dropdown.
      $(parent + " .single-option-selector:eq(0)").change(function() {
        Shopify.updateOptionsInSelector(1, parent);
        if (product.options.length === 3) Shopify.updateOptionsInSelector(2, parent);
        return true;
      });
      // When there is an update in the second dropdown.
      $(parent + " .single-option-selector:eq(1)").change(function() {
        if (product.options.length === 3) Shopify.updateOptionsInSelector(2, parent);
        return true;
      });
  };
  
  //Used for cart functionality
  function htmlEncode(value){
      if (value) {
          return $('<div/>').text(value).html();
      } else {
          return '';
      }
  }
  
  //Check if device is touch-enabled
  function is_touch_device() {
    return 'ontouchstart' in window || navigator.maxTouchPoints;
  };
  
  //Differentiate between mobile and touch screen laptops
  var touch_device = /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);
  
  /* option_selection.js */
  function floatToString(t,e){var o=t.toFixed(e).toString();return o.match(/^\.\d+/)?"0"+o:o}if("undefined"==typeof Shopify)var Shopify={};Shopify.each=function(t,e){for(var o=0;o<t.length;o++)e(t[o],o)},Shopify.map=function(t,e){for(var o=[],i=0;i<t.length;i++)o.push(e(t[i],i));return o},Shopify.arrayIncludes=function(t,e){for(var o=0;o<t.length;o++)if(t[o]==e)return!0;return!1},Shopify.uniq=function(t){for(var e=[],o=0;o<t.length;o++)Shopify.arrayIncludes(e,t[o])||e.push(t[o]);return e},Shopify.isDefined=function(t){return"undefined"==typeof t?!1:!0},Shopify.getClass=function(t){return Object.prototype.toString.call(t).slice(8,-1)},Shopify.extend=function(t,e){function o(){}o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t,t.baseConstructor=e,t.superClass=e.prototype},Shopify.locationSearch=function(){return window.location.search},Shopify.locationHash=function(){return window.location.hash},Shopify.replaceState=function(t){window.history.replaceState({},document.title,t)},Shopify.urlParam=function(t){var e=RegExp("[?&]"+t+"=([^&#]*)").exec(Shopify.locationSearch());return e&&decodeURIComponent(e[1].replace(/\+/g," "))},Shopify.newState=function(t,e){var o;return o=Shopify.urlParam(t)?Shopify.locationSearch().replace(RegExp("("+t+"=)[^&#]+"),"$1"+e):""===Shopify.locationSearch()?"?"+t+"="+e:Shopify.locationSearch()+"&"+t+"="+e,o+Shopify.locationHash()},Shopify.setParam=function(t,e){Shopify.replaceState(Shopify.newState(t,e))},Shopify.Product=function(t){Shopify.isDefined(t)&&this.update(t)},Shopify.Product.prototype.update=function(t){for(property in t)this[property]=t[property]},Shopify.Product.prototype.optionNames=function(){return"Array"==Shopify.getClass(this.options)?this.options:[]},Shopify.Product.prototype.optionValues=function(t){if(!Shopify.isDefined(this.variants))return null;var e=Shopify.map(this.variants,function(e){var o="option"+(t+1);return void 0==e[o]?null:e[o]});return null==e[0]?null:Shopify.uniq(e)},Shopify.Product.prototype.getVariant=function(t){var e=null;return t.length!=this.options.length?e:(Shopify.each(this.variants,function(o){for(var i=!0,r=0;r<t.length;r++){var n="option"+(r+1);o[n]!=t[r]&&(i=!1)}return 1==i?void(e=o):void 0}),e)},Shopify.Product.prototype.getVariantById=function(t){for(var e=0;e<this.variants.length;e++){var o=this.variants[e];if(t==o.id)return o}return null},Shopify.money_format="${{amount}}",Shopify.formatMoney=function(t,e){function o(t,e){return"undefined"==typeof t?e:t}function i(t,e,i,r){if(e=o(e,2),i=o(i,","),r=o(r,"."),isNaN(t)||null==t)return 0;t=(t/100).toFixed(e);var n=t.split("."),a=n[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+i),s=n[1]?r+n[1]:"";return a+s}"string"==typeof t&&(t=t.replace(".",""));var r="",n=/\{\{\s*(\w+)\s*\}\}/,a=e||this.money_format;switch(a.match(n)[1]){case"amount":r=i(t,2);break;case"amount_no_decimals":r=i(t,0);break;case"amount_with_comma_separator":r=i(t,2,".",",");break;case"amount_with_apostrophe_separator":r=i(t,2,"'",".");break;case"amount_no_decimals_with_comma_separator":r=i(t,0,".",",")}return a.replace(n,r)},Shopify.OptionSelectors=function(t,e){return this.selectorDivClass="selector-wrapper",this.selectorClass="single-option-selector",this.variantIdFieldIdSuffix="-variant-id",this.variantIdField=null,this.historyState=null,this.selectors=[],this.domIdPrefix=t,this.product=new Shopify.Product(e.product),this.onVariantSelected=Shopify.isDefined(e.onVariantSelected)?e.onVariantSelected:function(){},this.replaceSelector(t),this.initDropdown(),e.enableHistoryState&&(this.historyState=new Shopify.OptionSelectors.HistoryState(this)),!0},Shopify.OptionSelectors.prototype.initDropdown=function(){var t={initialLoad:!0},e=this.selectVariantFromDropdown(t);if(!e){var o=this;setTimeout(function(){o.selectVariantFromParams(t)||o.fireOnChangeForFirstDropdown.call(o,t)})}},Shopify.OptionSelectors.prototype.fireOnChangeForFirstDropdown=function(t){this.selectors[0].element.onchange(t)},Shopify.OptionSelectors.prototype.selectVariantFromParamsOrDropdown=function(t){var e=this.selectVariantFromParams(t);e||this.selectVariantFromDropdown(t)},Shopify.OptionSelectors.prototype.replaceSelector=function(t){var e=document.getElementById(t),o=e.parentNode;Shopify.each(this.buildSelectors(),function(t){o.insertBefore(t,e)}),e.style.display="none",this.variantIdField=e},Shopify.OptionSelectors.prototype.selectVariantFromDropdown=function(t){var e=document.getElementById(this.domIdPrefix).querySelector("[selected]");if(e||(e=document.getElementById(this.domIdPrefix).querySelector('[selected="selected"]')),!e)return!1;var o=e.value;return this.selectVariant(o,t)},Shopify.OptionSelectors.prototype.selectVariantFromParams=function(t){var e=Shopify.urlParam("variant");return this.selectVariant(e,t)},Shopify.OptionSelectors.prototype.selectVariant=function(t,e){var o=this.product.getVariantById(t);if(null==o)return!1;for(var i=0;i<this.selectors.length;i++){var r=this.selectors[i].element,n=r.getAttribute("data-option"),a=o[n];null!=a&&this.optionExistInSelect(r,a)&&(r.value=a)}return"undefined"!=typeof jQuery?jQuery(this.selectors[0].element).trigger("change",e):this.selectors[0].element.onchange(e),!0},Shopify.OptionSelectors.prototype.optionExistInSelect=function(t,e){for(var o=0;o<t.options.length;o++)if(t.options[o].value==e)return!0},Shopify.OptionSelectors.prototype.insertSelectors=function(t,e){Shopify.isDefined(e)&&this.setMessageElement(e),this.domIdPrefix="product-"+this.product.id+"-variant-selector";var o=document.getElementById(t);Shopify.each(this.buildSelectors(),function(t){o.appendChild(t)})},Shopify.OptionSelectors.prototype.buildSelectors=function(){for(var t=0;t<this.product.optionNames().length;t++){var e=new Shopify.SingleOptionSelector(this,t,this.product.optionNames()[t],this.product.optionValues(t));e.element.disabled=!1,this.selectors.push(e)}var o=this.selectorDivClass,i=this.product.optionNames(),r=Shopify.map(this.selectors,function(t){var e=document.createElement("div");if(e.setAttribute("class",o),i.length>1){var r=document.createElement("label");r.htmlFor=t.element.id,r.innerHTML=t.name,e.appendChild(r)}return e.appendChild(t.element),e});return r},Shopify.OptionSelectors.prototype.selectedValues=function(){for(var t=[],e=0;e<this.selectors.length;e++){var o=this.selectors[e].element.value;t.push(o)}return t},Shopify.OptionSelectors.prototype.updateSelectors=function(t,e){var o=this.selectedValues(),i=this.product.getVariant(o);i?(this.variantIdField.disabled=!1,this.variantIdField.value=i.id):this.variantIdField.disabled=!0,this.onVariantSelected(i,this,e),null!=this.historyState&&this.historyState.onVariantChange(i,this,e)},Shopify.OptionSelectorsFromDOM=function(t,e){var o=e.optionNames||[],i=e.priceFieldExists||!0,r=e.delimiter||"/",n=this.createProductFromSelector(t,o,i,r);e.product=n,Shopify.OptionSelectorsFromDOM.baseConstructor.call(this,t,e)},Shopify.extend(Shopify.OptionSelectorsFromDOM,Shopify.OptionSelectors),Shopify.OptionSelectorsFromDOM.prototype.createProductFromSelector=function(t,e,o,i){if(!Shopify.isDefined(o))var o=!0;if(!Shopify.isDefined(i))var i="/";var r=document.getElementById(t),n=r.childNodes,a=(r.parentNode,e.length),s=[];Shopify.each(n,function(t,r){if(1==t.nodeType&&"option"==t.tagName.toLowerCase()){var n=t.innerHTML.split(new RegExp("\\s*\\"+i+"\\s*"));0==e.length&&(a=n.length-(o?1:0));var p=n.slice(0,a),l=o?n[a]:"",c=(t.getAttribute("value"),{available:t.disabled?!1:!0,id:parseFloat(t.value),price:l,option1:p[0],option2:p[1],option3:p[2]});s.push(c)}});var p={variants:s};if(0==e.length){p.options=[];for(var l=0;a>l;l++)p.options[l]="option "+(l+1)}else p.options=e;return p},Shopify.SingleOptionSelector=function(t,e,o,i){this.multiSelector=t,this.values=i,this.index=e,this.name=o,this.element=document.createElement("select");for(var r=0;r<i.length;r++){var n=document.createElement("option");n.value=i[r],n.innerHTML=i[r],this.element.appendChild(n)}return this.element.setAttribute("class",this.multiSelector.selectorClass),this.element.setAttribute("data-option","option"+(e+1)),this.element.id=t.domIdPrefix+"-option-"+e,this.element.onchange=function(o,i){i=i||{},t.updateSelectors(e,i)},!0},Shopify.Image={preload:function(t,e){for(var o=0;o<t.length;o++){var i=t[o];this.loadImage(this.getSizedImageUrl(i,e))}},loadImage:function(t){(new Image).src=t},switchImage:function(t,e,o){if(t&&e){var i=this.imageSize(e.src),r=this.getSizedImageUrl(t.src,i);o?o(r,t,e):e.src=r}},imageSize:function(t){var e=t.match(/_(1024x1024|2048x2048|pico|icon|thumb|small|compact|medium|large|grande)\./);return null!=e?e[1]:null},getSizedImageUrl:function(t,e){if(null==e)return t;if("master"==e)return this.removeProtocol(t);var o=t.match(/\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i);if(null!=o){var i=t.split(o[0]),r=o[0];return this.removeProtocol(i[0]+"_"+e+r)}return null},removeProtocol:function(t){return t.replace(/http(s)?:/,"")}},Shopify.OptionSelectors.HistoryState=function(t){this.browserSupports()&&this.register(t)},Shopify.OptionSelectors.HistoryState.prototype.register=function(t){window.addEventListener("popstate",function(e){t.selectVariantFromParamsOrDropdown({popStateCall:!0})})},Shopify.OptionSelectors.HistoryState.prototype.onVariantChange=function(t,e,o){this.browserSupports()&&(!t||o.initialLoad||o.popStateCall||Shopify.setParam("variant",t.id))},Shopify.OptionSelectors.HistoryState.prototype.browserSupports=function(){return window.history&&window.history.replaceState};
  
  $(document)
    .on('shopify:block:select', function(e){
  
      var blockId = e.detail.blockId;
      var $parentSection = $('#shopify-section-' + e.detail.sectionId);
  
      if ($parentSection.hasClass('slideshow-section') || $parentSection.hasClass('testimonial-section')){
        sliderBlock.select(blockId, $parentSection);
      }
  
      if ($parentSection.hasClass('recommended-products-section')){
        if ($('.block__recommended_products').length){
          productPage.unload($parentSection);
          productPage.init();
        }
      }
  
      if($parentSection.hasClass('page-details-section')){
        if($('.map-section').length) {
          mapFunction.init();
        }
  
        if($('.recently-viewed__section').length && Shopify.theme_settings.collection_secondary_image) {
          imageFunctions.showSecondaryImage();
        }
      }
  
      if ($parentSection.hasClass('cart-section')){
        if ($('.block__featured_collection').length){
          featuredCollectionSection.init();
        }
      }
  
      if ($parentSection.hasClass('product-template')){
        if (Shopify.theme_settings.enable_shopify_review_comments){
          if($('#shopify-product-reviews').length >= 1) {
            SPR.$(document).ready(function() {
              return SPR.registerCallbacks(),
              SPR.initRatingHandler(),
              SPR.initDomEls(),
              SPR.loadProducts(),
              SPR.loadBadges()
            })
          }
        }
      }
  
      utils.resizeActionButtons();
  
  });
  
  $(document)
    .on('shopify:block:deselect', function(e){
  
      var $parentSection = $('#shopify-section-' + e.detail.sectionId);
  
      if ($parentSection.hasClass('slideshow-section') || $parentSection.hasClass('testimonial-section')){
        sliderBlock.deselect($parentSection);
      }
  });
  
  $(document)
    .on('shopify:section:reorder', function(e){
  
      utils.pageBannerCheck();
  
  });
  
  $(document)
    .on('shopify:section:load', function(e){
  
      var $parentSection = $('#shopify-section-' + e.detail.sectionId);
  
      utils.pageBannerCheck();
      utils.enableDisclosure();
  
      if (Shopify.theme_settings.newsletter_popup){
        newsletter_popup.init();
      }
  
      if ($parentSection.hasClass('image-gallery-section')){
        gallery.init($parentSection);
      }
  
      if ($parentSection.hasClass('faq-section')){
        globalAccordions.init();
      }
  
      if ($parentSection.hasClass('cart-section')){
        cart.init();
        if ($('.block__featured_collection').length){
          featuredCollectionSection.init();
        }
      }
  
      if ($parentSection.hasClass('featured-promotions-section')){
        featuredPromotions.init();
      }
  
      if ($parentSection.hasClass('slideshow-section')){
        slideshow.init();
      }
  
      if (Shopify.theme_settings.enable_autocomplete){
        if ($parentSection.hasClass('search-section')){
          searchAutocomplete.init();
        }
      }
  
      if ($parentSection.hasClass('testimonial-section')){
        testimonial.init();
      }
  
      if ($parentSection.hasClass('featured-products-section')){
        productPage.init();
        videoFeature.init();
        productPage.productSwatches();
        if (Shopify.theme_settings.enable_shopify_review_comments){
          if($('.shopify-product-reviews-badge').length) {
            SPR.$(document).ready(function() {
              return SPR.registerCallbacks(),
              SPR.initRatingHandler(),
              SPR.initDomEls(),
              SPR.loadProducts(),
              SPR.loadBadges()
            })
          }
        }
      }
  
      if($parentSection.hasClass('map-section')){
        mapFunction.init();
      }
  
      if ($parentSection.hasClass('featured-collection-section')){
        featuredCollectionSection.init();
        videoFeature.init();
      }
  
      if ($parentSection.hasClass('video-section')){
        videoSection.init();
      }
  
      if ($parentSection.hasClass('product-template')){
        productPage.init();
        videoFeature.init();
        productPage.productSwatches();
        recentlyViewed.init();
        if (Shopify.theme_settings.enable_shopify_review_comments){
          if($('#shopify-product-reviews').length || $('.shopify-product-reviews-badge').length) {
            SPR.$(document).ready(function() {
              return SPR.registerCallbacks(),
              SPR.initRatingHandler(),
              SPR.initDomEls(),
              SPR.loadProducts(),
              SPR.loadBadges()
            })
          }
        }
      }
  
      if ($parentSection.hasClass('recommended-products-section')){
        productPage.init();
      }
  
      if ($parentSection.hasClass('recently-viewed-section')){
        recentlyViewed.init();
      }
  
      if ($parentSection.hasClass('article-template-section')){
        if(window.location.pathname.indexOf('/comments') != -1) {
          $('html,body').animate({scrollTop: $("#new-comment").offset().top-140},'slow');
        }
      }
  
      if ($parentSection.hasClass('collection-template-section')){
        collectionSidebarFilter.init();
        recentlyViewed.init();
      }
  
      if($parentSection.hasClass('contact-section')){
        mapFunction.init();
      }
  
      if ($parentSection.hasClass('search-template-section')){
        if (Shopify.theme_settings.enable_autocomplete){
          searchAutocomplete.init();
        }
        collectionSidebarFilter.init();
      }
  
      if ($parentSection.hasClass('header-section')){
        header.init();
        //header.loadMegaMenu();
      }
  
      if ($parentSection.hasClass('mega-menu-section')){
        //header.loadMegaMenu();
      }
  
      if ($parentSection.hasClass('page-details-section')) {
        featuredCollectionSection.init();
        videoSection.init();
        recentlyViewed.init();
  
        if($('.block__image_gallery').length) {
          gallery.init();
        };
      }
  
      if ($parentSection.hasClass('product-details-section')) {
        featuredCollectionSection.init();
        videoSection.init();
        mapFunction.init();
        if($('.block__image_gallery').length) {
          gallery.init();
        };
        recentlyViewed.init();
        productPage.init();
      }
  });
  
  
  $(document)
    .on('shopify:section:unload', function(e){
      var $target = $(e.target);
      var $parentSection = $('#shopify-section-' + e.detail.sectionId);
  
      if ($parentSection.hasClass('header-section')){
        header.unload($target);
        //header.unloadMegaMenu();
      }
  
      if ($parentSection.hasClass('slideshow-section')){
        slideshow.unload($target);
      }
  
      if ($parentSection.hasClass('testimonial-section')){
        testimonial.unload($target);
      }
  
      if ($parentSection.hasClass('search-section')){
        searchAutocomplete.unload($target);
      }
  
      if ($parentSection.hasClass('product-template')){
        productPage.unload($parentSection);
      }
  
      if ($parentSection.hasClass('featured-products-section')){
        productPage.unload($parentSection);
      }
  
      if ($parentSection.hasClass('mega-menu-section')){
        //header.unloadMegaMenu();
      }
  
  });
  
  $(document)
    .on('shopify:section:select', function(e){
  
      var $parentSection = $('#shopify-section-' + e.detail.sectionId);
  
      if ($parentSection.hasClass('mega-menu-section')){
        var megaMenuParent = $('.header .' + e.detail.sectionId).data('dropdown');
        setTimeout(function() {
          $('a.mega-menu-parent[data-dropdown-rel="' + megaMenuParent + '"]').trigger('mouseenter');
          $('a.mega-menu-parent[data-dropdown-rel="' + megaMenuParent + '"]').parents('header').addClass('editor-hover--true');
          header.removeDataAttributes('.header .mega-menu.dropdown_container .dropdown_column');
        }, 10);
      }
  
      if ($parentSection.hasClass('featured-collection-section')){
        featuredCollectionSection.unload($parentSection);
        featuredCollectionSection.init();
      }
  
      utils.pageBannerCheck();
      var evt = document.createEvent('UIEvents');
      evt.initUIEvent('resize', true, false, window, 0);
      window.dispatchEvent(evt);
  });
  
  $(document)
    .on('shopify:section:deselect', function(e){
  
      var $parentSection = $('#shopify-section-' + e.detail.sectionId);
  
      if ($parentSection.hasClass('mega-menu-section')){
        var megaMenuParent = $('.header .' + e.detail.sectionId).data('dropdown');
        $('a.mega-menu-parent[data-dropdown-rel="' + megaMenuParent + '"]').trigger('mouseout');
        $('a.mega-menu-parent[data-dropdown-rel="' + megaMenuParent + '"]').parents('header').removeClass('editor-hover--true');
      }
  });
  
  $(window).on('load', function () {
    $('.newleaf-warranty-heading .heading').click(function () {
      if ($(window).width() < 768) {
        $(this).toggleClass('active');
        $(this).parent().parent().find('.ws_button').toggleClass('active');
      }
    });
  });
  
  $(document).ready(function () {
    $('.tab-box .tabs li').on('click', function (e) {
      e.preventDefault();
      var $tab_section = $(this).parent();
      $tab_section.find('li').removeClass('active');
      $(this).addClass('active');
      var id = $(this).data('target');
      $('.tab-box .tab-content').removeClass('active');
      $(id).addClass('active');
    });
    $(document).on( 'change', function () {
      var header_height = $('#header.mobile_nav-fixed--true').height();
      $('#pagecontent').css('padding-bottom', header_height);
    })
    
    if($("#instafeed").length){
      var feed = new Instafeed({
        accessToken: code,
        templateBoundaries: ['<','>'],
        template: '<a href="<link>" target="_blank"><img title="<caption>" src="<image>" /></a>',
        limit: limit
      });
      feed.run();
    }
    $('.blog-post-section .article_content .more').on('click', function(e){
      e.preventDefault();
      $(this).parent().addClass('active');
    })
    $('.blog-post-section .block__image_gallery .gallerys .more').on('click', function(e){
      e.preventDefault();
      $(this).parent().parent().addClass('active');
      $(this).hide();
    });
    $('.blog-section .blog-links .show_all').on('click', function (e) {
      e.preventDefault();
      $('.blog-section .articles').addClass('all_articles');
    })
    $('.checkbox').click(function () {
      var checkBoxes = $(this).find('input');
      checkBoxes.prop("checked", !checkBoxes.prop("checked"));
    });
    $('.toggle_btn').click(function (e) {
      e.preventDefault();
      $(this).find('.toggle_content').toggleClass('hide');
    });
    $('.sidebar-block .toggle').click(function (e) {
      e.preventDefault();
      $(this).toggleClass('active');
      $('.sidebar-block .toggle_list').slideToggle();
    })
    $('.article_content .border-box').each(function () {
      var url = $(this).find('h3').find('a').attr('href');
      if (url != '') {
        var html = `<a href="${url}" class="button border-button">Shop Now</a>`;
        $(this).append(html);
      }
    });
  
    // Add smooth scrolling to all links
    $(".brand-azlist a , .brand-btn a").on('click', function(event) {
  
      // Make sure this.hash has a value before overriding default behavior
      if (this.hash !== "") {
        // Prevent default anchor click behavior
        event.preventDefault();
  
        // Store hash
        var hash = this.hash;
      
        // Using jQuery's animate() method to add smooth page scroll
        // The optional number (800) specifies the number of milliseconds it takes to scroll to the specified area
        $('#inline').animate({
          scrollTop: $(hash).offset().top
        }, 200, function(){
    
          // Add hash (#) to URL when done scrolling (default click behavior)
          window.location.hash = hash;
        });
      } // End if
    });
  
    $('.mega-menu-2 .dropdown_content .heading-menu-bar li').on('mouseenter', function () {
      $('.mega-menu-2 .dropdown_content .active').removeClass('active')
      if(!$(this).hasClass('active')){
        var id = `#${$(this).data('target')}`;
        $(id).addClass('active');
        $(this).addClass('active');
      }
    });
  
    $('.mini_cart').click(function (e) {
      
      if (!Shopify.theme_settings.redirect_cart){
        e.preventDefault();
        $('body').addClass('stop-scroll');
        $('.cart_content ').addClass('active');
        $('.dark-bg').addClass('active');
      }
    });
  
    $('.dark-bg').click(function () {
      $('body').removeClass('stop-scroll');
      if ($('.cart_content').hasClass('active')) {
        $('.cart_content').removeClass('active');
      }
      $('.dark-bg').removeClass('active');
    });
  
    $('.search-box').on('keyup', function (e) {
      e.preventDefault();
      var value = $(this).val().toLowerCase();
      
      $('.brand-content ul').each(function () {
        var status = false;
  
        $(this).find('li').each(function () {
          var data = $(this).find('a').text();
          if (data.indexOf(value) >= 0) {
            $(this).removeClass('hide');
            $(this).addClass('show');
            status = true;
          } else {
            $(this).removeClass('show');
            $(this).addClass('hide');
          }
        });
  
        if (!status) {
          $(this).parent().hide();
        } else{
          $(this).parent().show();
        }
      })
    })
    
    $(document).on('click', '.chat_button', function (e) {
      e.preventDefault();
      if ($('.mobile_nav ').find('.open').length > 0) {
        $('.mobile_nav ').trigger('click');
      }
      GorgiasChat.open();
    })
  
    $('.contanct-field .scroll-pannel a').on('click', function (e) {
      e.preventDefault();
      var id = $(this).attr('href');
      $(window).scrollTop($(id).offset().top - 158);
    })
  
    $('.sidebar-menu .select-box').on('click',function(){
      $(this).next('ul').slideToggle(280);
    });
  
    $(document).on('click', '.modal_button', function (e) {
      e.preventDefault();
      let id = $(this).attr('href');
      $(id).toggleClass('active');
    });
  
    $(document).on('click', '.close', function (e) {
      e.preventDefault()
      $('body').removeClass('stop-scroll');
      $('body').removeClass('blocked-scroll');
      var id = $(this).attr('href');
      if (id == '#mini-cart') {
        $(this).parent().parent().removeClass('active');
      }
  
      $(id).hide();
      $(id).removeClass('active');
      $('.dark-bg').removeClass('active');
    });
  
    $(window).on('load', function(e) {
      $(".pageloader").fadeOut("slow");
    });
  
    $('.logo-slider').flickity({
      "draggable": true,
      "prevNextButtons": false,
      "wrapAround": true,
      "cellAlign": "left",
      "pageDots": false,
      "contain": true,
      "freeScroll": true,
      "prevNextButtons": true
    });
  
    $('.banner-slider').flickity({
      "draggable": true,
      "prevNextButtons": false,
      "wrapAround": true,
      "cellAlign": "left",
      "pageDots": false,
      "contain": true,
      "hash": true
    });
  
  
    $('.indicator-item').on('click', function (e) {
      e.preventDefault();
      $('.indicator-item').removeClass('active');
      $(this).addClass('active');
    })
  
    $(".form-btn").on('click ',function(e){
      e.preventDefault();
        var id =$(this).attr('zota-id');
      id = Number(id);   
      Zotabox.show(id);
    });
    
    $('.toggle_content .switch').on('click', function (e) {
      e.preventDefault();
      $(this).parent().find('.content_box').toggleClass('hide');
    })
  
  
    $("#clickform").on('click ',function(){
        var id =$(this).attr('zota-id');
      id = Number(id);   
      Zotabox.show(id);
    });
  
    $(document).on('click', '#globo-formbuilder-33223 .submit', function () {
      
      var tid = setInterval(() => {
        if ( $('#globo-formbuilder-33223 .globo-form-app > .message.success').css('display') == 'block' ) {
          var top = $('#globo-formbuilder-33223').offset().top - 160;
          $(window).scrollTop(top)
          clearInterval( tid );
        }
      }, 500);
    })
  
    $(document).on('focus', '#globo-formbuilder-33223 input', function () {
      var top = $(this).offset().top - 160;
      $(window).scrollTop(top)
    });
  
    if (template == 'pro-services') {
      var bombMap = new Datamap({
        element: document.getElementById('container1'),
        projection: 'mercator',
        responsive: true,
        scope: 'world',
        geographyConfig: {
            popupOnHover: false,
            highlightOnHover: false,
            borderColor: '#DEDEDE',
            highlightBorderWidth: 2,
        },
        fills: {
            red:"red",
            defaultFill: '#FFF'
        },
        data: {
            'RUS': {fillKey: 'RUS'},
            'PRK': {fillKey: 'PRK'},
            'PRC': {fillKey: 'PRC'},
            'IND': {fillKey: 'IND'},
            'GBR': {fillKey: 'GBR'},
            'FRA': {fillKey: 'FRA'},
            'PAK': {fillKey: 'PAK'},
            'USA': {fillKey: 'USA'}
        },
      });
  
      var bombs = [{
            name: 'International Space University ',
            radius: 10,
            yield: "A neutral, international university striving to develop future leaders in space science and a forum for the intercultural exchange of knowledge.",
            country: 'France',
            fillKey: 'red',
            significance: '',
            date: '1953-08-12',
            latitude: 48.5230,
            longitude: 7.7369
          },{
            name: 'Bundang Astro Camp',
            radius: 10,
            yield: "Specializing in astronomy and natural sciences, the Astro Camp fosters creative problem-solving skills in youth and prepares them for the future of science.",
            country: 'South Korea',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1955-11-22',
            latitude: 37.3827,
            longitude: 127.1189
  
          },{
            name: 'Pontificia Universidad Catlica de Chile',
            radius: 10,
            yield: "Chilean university specializing in astrophysics with heavy research in theoretical and observational astronomy.",
            country: 'Chile',
            fillKey: 'red',
            significance: 'Chilean university specializing in astrophysics with heavy research in theoretical and observational astronomy.',
            date: '1961-10-31',
            latitude: -33.4411,
            longitude: -70.6408
          },{
            name: 'University of Canterbury',
            radius: 10,
            yield: "Historic university erected more than a century ago and consistently ranked among the top institutions in the world.",
            country: 'New Zealand ',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: -43.379688,
            longitude:  172.598053
            
            
          },{
            name: 'Brisbane Girls Grammar School',
            radius: 10,
            yield: "Founded in 1875, this institute is a haven for the education of young women studying the arts and sciences.",
            country: 'Australia',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:  -27.458688,
            longitude: 153.019703
          },{
            name: 'New Era University',
            radius: 10,
            yield: "A private university in the Phillippines established in 1975 with worldwide accreditation.",
            country: 'Phillippines',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 14.6639 ,
            longitude: 121.0580
          },{
            name: 'York University',
            radius: 10,
            yield: "One of the largest universities in Canada with nearly a dozen faculties, this institution has gained recognition on an international scale.",
            country: 'Canada',
            fillKey: 'red',
            significance: 'One of the largest universities in Canada with nearly a dozen faculties, this institution has gained recognition on an international scale.',
            date: '1961-10-31',
            latitude:  43.7735,
            longitude: -79.5019
          },{
            name: 'Altair Astro LTD',
            radius: 10,
            yield: "Created by astronomers, for astronomers, Altair Astro strives to bring astronomy to the masses.",
            country: 'UK',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:  52.796260,
            longitude: 1.252325
          },{
            name: 'Robtics',
            radius: 10,
            yield: "Robtics provides astronomical equipment and services to the Netherlands and surrounding areas.",
            country: 'Netherlands',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:  6.836640,
            longitude: 7.352868
          },{
            name: 'Nasrda-Centre For Basic Space Science',
            radius: 10,
            yield: "Founded to carry out research in astronomy and other space-related sciences for the benefit of national and international projects.",
            country: 'Nigeria',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:  6.836640,
            longitude: 7.352868
          },{
            name: 'Astronomical Institute of Slovak Academy of Sciences',
            radius: 10,
            yield: "Founding institute in the Slovakian Academy of Sciences focusing on astrophysical and interplanetary research.",
            country: 'Slovakia',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:  49.152202, 
            longitude: 20.288099
          },{
            name: 'Science City CO, LTD ',
            radius: 10,
            yield: "Astronomical product supplier for public and private sectors in Thailand.",
            country: 'Thailand ',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:  13.796285, 
            longitude: 100.708382 
          },{
            name: 'Rigel Astronomia ',
            radius: 10,
            yield: "Telescope and astronomy equipment supplier based in Italy.",
            country: 'Italy',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:  41.796276, 
            longitude: 12.451548  
          },{
            name: 'Galaxy Scientific Group',
            radius: 10,
            yield: "Hong Kong-based company promoting astronomical services and construction in the region.",
            country: 'Hong Kong',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:  22.397294, 
            longitude: 114.196431 
          },{
            name: 'Konkoly Observatory',
            radius: 10,
            yield: "Hungarian Observatory established in 1871 which is both the largest research institute in the country and houses the largest telescopes in Hungary.",
            country: 'Hungarian',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:  47.500495,
            longitude: 18.964254 
          },{
            name: 'Indian Center for Space Physics ',
            radius: 10,
            yield: "A non-profit research center in India. Primary research is for astronomy and astrophysics",
            country: 'India',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:   22.465857, 
            longitude: 88.386908
          } ,{
            name: 'UNIVERSIDAD NACIONAL DE CORDOBA ',
            radius: 10,
            yield: "The oldest standing university in Argentina. Located Cordoba and offering more than a dozen educational disciplines.",
            country: 'Argentina',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:   -31.435510,  
            longitude: -64.185835
          },{
            name: 'European Southern Observatory',
            radius: 10,
            yield: "Headquartered in Germany, this Chilean observatory is situated among the most ideal astronomical observation locations in the southern hemisphere.",
            country: ' Chile',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:   -33.126985, 
            longitude: -70.675857 
          },{
            name: 'Kosmos Scientific de Mexico ',
            radius: 10,
            yield: "Primary distributor of astronomy and optics equipment in Mexico.",
            country: 'Mexico',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:   25.591157, 
            longitude: -100.253967 
          },{
            name: 'McDonald Observatory, TX ',
            radius: 10,
            yield: "McDonald Observatory, a research unit of The University of Texas at Austin, is one of the world's leading centers for astronomical research, teaching, and public education and outreach. ",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:   30.673039,
            longitude:  -104.022058 
          },{
            name: 'Palomar Observatory',
            radius: 10,
            yield: "Observatory operated by California Institute of Technology known for the 200-inch Hale Telescope. ",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 33.358380, 
            longitude: -116.866346 
          },{
            name: 'Griffith Observatory',
            radius: 10,
            yield: "This art deco landmark from 1935 features a high-tech planetarium, public telescopes & city views. ",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 34.118709, 
            longitude: -118.300372 
          },{
            name: 'Mt. Wilson Observatory',
            radius: 10,
            yield: "Celebrated observatory complex featuring powerful solar & nighttime telescopes, with tours & more.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 34.225553, 
            longitude:-118.057275 
          },{
            name: 'Lick Observatory',
            radius: 10,
            yield: "Storied astronomy center on Mount Hamilton featuring powerful telescopes, exhibits & valley views.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 37.341609, 
            longitude:-121.642910
          },{
            name: 'Keck Observatory',
            radius: 10,
            yield: "Site of twin optical & infrared telescopes on top of Mauna Kea used for astronomy research.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 19.826193, 
            longitude:-155.474704 
          },{
            name: 'Saddleback College',
            radius: 10,
            yield: "",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 33.554211,
            longitude: -117.664112  
          },{
            name: 'San Diego State University',
            radius: 10,
            yield: "Since its founding in 1897, the university has grown to become a leading public research university.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 32.775767, 
            longitude: -117.071771 
          },{
            name: 'Technological University of the Philippines',
            radius: 10,
            yield: "The Technological University of the Philippines was first established as the Manila Trade School in 1901",
            country: ' Philippines',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 14.510743,
            longitude:  121.035173  
          },{
            name: 'Macquarie University',
            radius: 10,
            yield: "Sydney's 3rd university, founded in 1964 and occupying an area of lawns and natural bushland.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: -33.773536, 
            longitude:  151.112624 
          },{
            name: 'The University of Texas at Dallas',
            radius: 10,
            yield: "The William B. Hanson Center for Space Sciences at UT Dallas focuses on theoretical and empirical studies of the Earths atmosphere, ionosphere and magnetosphere.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 32.985843, 
            longitude: -96.749938 
          },{
            name: 'University of New Mexico',
            radius: 10,
            yield: "Big public research school known for its many museums, Pueblo Revival buildings & medical programs.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 35.084406, 
            longitude: -106.619804 
          },{
            name: 'University of California, San Diego',
            radius: 10,
            yield: "#1 ranked research school in the US",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 38.648764, 
            longitude: -90.310614  
          },{
            name: 'Washington University in St. Louiso',
            radius: 10,
            yield: "Large, research-centric private school known for its medicine & engineering programs.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 32.880078, 
            longitude: -117.233949  
          },{
            name: 'The University of Hong Kong',
            radius: 10,
            yield: "University with a colonial-style main building and multidisciplinary programs across 10 faculties.",
            country: 'Hong Kong',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 22.284461, 
            longitude: 114.137056  
          },{
            name: 'The University of Toledo',
            radius: 10,
            yield: "public metropolitan research university with 20,500 students and picturesque campuses recognized nationally for their beauty.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 41.659104,  
            longitude: -83.614387 
          },{
            name: 'Georgia State University',
            radius: 10,
            yield: "Public research university located in the Downtown area & known for its sports & business programs.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 33.753274, 
            longitude:-84.385326 
          },{
            name: 'University of Waterloo',
            radius: 10,
            yield: "Expansive public research university known for its engineering, math, psychology & science programs.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 43.465748,  
            longitude:-80.521302
          },{
            name: 'Mercer University',
            radius: 10,
            yield: "Founded by early 19th century Baptists, Mercer  while no longer formally denominationally affiliated  remains committed to an educational environment that embraces the historic Baptist principles of intellectual and religious freedom",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 32.828623,  
            longitude:-83.649424 
          },{
            name: 'Biola University',
            radius: 10,
            yield: "Biola University is a nationally ranked Christian university in the heart of Southern California. ",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 33.905412,  
            longitude: -118.015190 
          },{
            name: 'University of Southern California',
            radius: 10,
            yield: "Founded in 1880, this private research school is known for journalism, cinematic arts & medicine. ",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 34.022156, 
            longitude: -118.284967  
          },{
            name: 'University of North Texas',
            radius: 10,
            yield: "Expansive public research university founded in 1890 & known for its music school, among others.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 33.207551, 
            longitude: -97.152522
          },{
            name: 'Texas A&M University',
            radius: 10,
            yield: "Texas A&M opened its doors in 1876 as the state's first public institution of higher learning.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 30.618448,  
            longitude: -96.336574
          },{
            name: 'University of North Dakota',
            radius: 10,
            yield: "Known for its aerospace, engineering & education programs, this public school was founded in 1883.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 47.922797, 
            longitude: -97.076608 
          },{
            name: 'Utah State University',
            radius: 10,
            yield: "Set at the mouth of a canyon, this scenic 1888 research university is near trails & climbing routes.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 41.745137,  
            longitude: -111.809753 
          },{
            name: 'Eastern Kentucky University',
            radius: 10,
            yield: "",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 37.735101, 
            longitude: -84.298736  
          },{
            name: 'Wayne State University',
            radius: 10,
            yield: "Located in Midtown Detroit, this 1868 research school is known for law, business & health sciences",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude: 42.359163,
            longitude:  -83.066224   
          },{
            name: 'University of Cape Town',
            radius: 10,
            yield: "Founded in 1829, this university is known for its research and location in front of Table Mountain.",
            country: 'SA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:-33.957688,
            longitude:   18.461187
          },{
            name: 'Arecibo Observatory',
            radius: 10,
            yield: "Renowned observatory & research center boasting a 1,000-foot-wide radio telescope.",
            country: 'USA',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:18.346453, 
            longitude: -66.752841
          },{
            name: 'University of Southern Queensland',
            radius: 10,
            yield: "We are the number 1 University in Queensland for graduate employability. A recognised leader in online and blended education, we are renowned for our supportive environment and student-focused commitment to learning and teaching.",
            country: ' Australia',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:-27.601086, 
            longitude:  151.929232
          },{
            name: 'Ido, Bareket observatory',
            radius: 10,
            yield: "",
            country: ' Israel',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:31.888557,
            longitude:  35.031245
          },{
            name: 'Siding Spring Observatory',
            radius: 10,
            yield: "Siding Spring Observatory (SSO), on the edge of the Warrumbungle National Park near Coonabarabran, NSW, is Australia's premier optical and infrared astronomical observatory.",
            country: ' Australia',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:-31.274854, 
            longitude: 149.068427
          },{
            name: 'Siding Spring Observatory',
            radius: 10,
            yield: "Siding Spring Observatory (SSO), on the edge of the Warrumbungle National Park near Coonabarabran, NSW, is Australia's premier optical and infrared astronomical observatory.",
            country: ' Australia',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:-31.274854, 
            longitude: 149.068427
          },{
            name: 'National Astronomical Observatory of Japan ',
            radius: 10,
            yield: "The heart of Japans research in astronomy, the National Astronomical Observatory in Japan (NAOJ) drives forward the development of space science and science as a whole.",
            country: 'Japan',
            fillKey: 'red',
            significance: 'so many EQ mounts',
            date: '1961-10-31',
            latitude:35.675534,  
            longitude: 139.537670
          }
        ];
    //draw bubbles for bombs
      bombMap.bubbles(bombs, {
        popupTemplate: function (geo, data) {
          return ['<div class="hoverinfo" style="display:none">' +  data.name,
                '<br/>Payload: ' +  data.yield ,
                '<br/>Country: ' +  data.country + '',
                '<br/>Stuff: ' +  data.significance + '',
                '</div>'].join('');
        }
      });
        //handle bubble clicks
      bombMap.svg.selectAll('.datamaps-bubble').on('click', function(){
        $(".bubble-container").addClass('bubshow')
        var databub = this.__data__;
        $(".bubble-container").addClass('animate').on("animationend", function(){
          $(this).removeClass('animate');
        });
  
        $("#bub1").text(databub.country);
        $("#bub2").text(databub.name);
        $("#bub3").text(databub.yield);
      
      });
      
      
      window.addEventListener('resize', function() {
            bombMap.resize();
      });
    }
  
   
    let label = $('.collection_content').data('label');
    if (label) {
      waitUntilDefined();
    }
  
  });
  
  function breadCalc(id) {
    var ammount = $('.snize-price', '#snize-product-'+id)[0].innerHTML;
    ammount = ammount.substring(1);
    ammount = ammount.replace(/,/g, '');
  
    var calc = calculate(ammount);
  
    if (!$('.snize-as-low-as', '#snize-product-'+id).length) {
      $(`#snize-product-${id} .snize-overhidden .snize-reviews`).after(`
        <div class="snize-as-low-as">As low as $<span id="1316765302848">${calc}</span>/Month</div>
      `);
    }
  }
  
  function calculate(amount) {
    var productPrice = amount;
    var apr = .0999;
    var loanTerm = 36;
    var monthlyPayment = Math.round((productPrice * (apr / 12)) / (1 - Math.pow((1 + (apr / 12)), (-1 * loanTerm))) * 100) / 100;
  
    return monthlyPayment;
  }
  
  function mainCode($) {
    $(document).on('Searchanise.ResultsUpdated', function(event, results) {
      $('.snize-product', results).each(function() {
        setTimeout(() => {
        if ($(this).data('snize_item_data') && $(this).data('snize_item_data').product_id) {
          
          breadCalc($(this).data('snize_item_data').product_id);
          
          AddLabel($(this).data('snize_item_data').product_id);
          $('.snize-product').each(function () {
            var html = $(this).find('.total-reviews').html();
            if (html != '' & html != undefined) {
              var num = html.replace(' review(s)','');
              $(this).find('.total-reviews').html(num);
              $(this).find('.total-reviews').css('display', 'flex');
  
            }
          })
          
          var html = $('.spr-badge-caption').html();
          var interval = setInterval(() => {
            html = $('.spr-badge-caption').html();
            if (html != undefined ) {
              if (html == 'No reviews') {
                var num = `(0)`;
              } else {
                var num = `(${html.replace(' review','')})`;
              }
              
              $('.spr-badge-caption').html(num.replace('s',''));
              clearInterval(interval);
            }
          }, 500);
        }
      }, 500);
      });
    });
  }
  
  function waitUntilDefined() {
    if (typeof Searchanise !== "undefined" && typeof Searchanise.$ !== "undefined") {
      mainCode(Searchanise.$);
    } else {
      setTimeout(waitUntilDefined, 400);
    }
  }
  
  function AddLabel(id) {
    if ($('.snize-product-label', '#snize-product-'+id)[0]) {
      var ammount = $('.snize-product-label', '#snize-product-'+id)[0].innerHTML;
      ammount = ammount.substring(1);
      ammount = ammount.replace(/,/g, '');
    
      var calc = calculate(ammount);
    
      if (!$('.snize-as-low-as', '#snize-product-'+id).length) {
        $(`#snize-product-${id} .snize-overhidden .snize-reviews`).after(`
          <div class="snize-as-low-as">As low as $<span id="1316765302848">${calc}</span>/Month</div>
        `);
      }
    }
    
  }      
                
  function checkpart(){
  jQuery.getJSON('/cart.js', function(cart) {
   // now have access to Shopify cart object
   var flagpart = false;
   $(cart.items).each(function(){
    var str = this.handle;
    if(str.match('stellarvue') && str.match('telescope')){
  flagpart = true;
    }
     
   
   
   });
  if(flagpart == false){
   jQuery.post('/cart/change.js', { quantity: 0, id:12618703765568 }); 
  
  location.reload();
  }
  
  
  } ); 
  
  }
  
  $(window).on('load', function () {
    $('.product-info .snize-product').each(function () {
      var html = $(this).find('.total-reviews').html();
      if (html != '' & html != undefined) {
        var num = html.replace(' review(s)','');
        $(this).find('.total-reviews').html(num);
        $(this).find('.total-reviews').show();
      }
    });
  
    var html = $('.spr-badge-caption').html();
    var interval = setInterval(() => {
      html = $('.spr-badge-caption').html();
      if (html != undefined ) {
        if (html == 'No reviews') {
          var num = `(0)`;
        } else {
          var num = `(${html.replace(' review','')})`;
        }
        
        $('.spr-badge-caption').html(num.replace('s',''));
        clearInterval(interval);
      }
    }, 500);
    $('.swiper-container').show();
    var myapprovedvendor = new Swiper('.swiper-container', {
      speed: 400,
      spaceBetween: 10,
      initialSlide: 5,
      //truewrapper adoptsheight of active slide
      autoHeight: false,
      // Optional parameters
      direction: 'horizontal',
      loop: true,
      // delay between transitions in ms
      autoplay: 5000,
      autoplayStopOnLast: false, // loop false also
      // If we need pagination
      pagination: '.swiper-pagination',
      paginationType: "bullets",
      draggable: true,
      // And if we need scrollbar
      scrollbar: {
        el: '.swiper-scrollbar',
        draggable: true
      },
      // "slide", "fade", "cube", "coverflow" or "flip"
      effect: 'slide',
      // Distance between slides in px.
      //
      slidesPerView: 5,
      //
      //
      slidesOffsetBefore: 0,
      //
      grabCursor: true,
     
      breakpoints: {
        // when window width is <= 320px
        375: {
          slidesPerView: 1,
          spaceBetween: 5
        },
        // when window width is <= 480px
        480: {
          slidesPerView: 2,
          spaceBetween: 5,
          centeredSlides: false
        },
        // when window width is <= 640px
        640: {
          slidesPerView: 3,
          spaceBetween: 10,
          centeredSlides: false
        },
        1080: {
          slidesPerView: 4,
          spaceBetween: 5
        },
        1200: {
          slidesPerView: 5,
          spaceBetween: 5
        }
      }
    });
  
    
  });
  
  
  jQuery(window).on('load', function(){
    var priceholder = 0; 
  
    $(".iwishMeta-title").each(function(e, val){
  
      var handle = val.getAttribute("data-handle");
      var holdr = $(val).children('span');  
  
      jQuery.getJSON("https://optcorp.com/products/"+handle, function(product) {
  
        var ic = product.product.variants[0].inventory_quantity;
        priceholder += parseFloat(product.product.variants[0].price);
  
        var ict =product.product.tags;
        if(ic > 1){
          holdr.text('In Stock');
          holdr.addClass("flag2");
        }else if(ic == 1){
          holdr.text('One Left');
          holdr.addClass("flag2");
        } else if(ict.indexOf("Drop Ship") > 0 ){
          holdr.text("Dropship");
          holdr.addClass("flag3");
        }else{
          holdr.text('Backorder');
        } 
        $('#totalinList').text(priceholder.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ","));
      });
    });
    $("#addAllbtn").click(function(){addAll();});
    $("#rmAll").click(function(){rmAll();});
  
  });
    
  
  
    function addAll(){
      $('form.iwish-product-form').each(function(el){
      console.log(this);
      var id = $(this).find("input[name='id']").attr('value');
  
      $.ajax({
  
        type:"POST",
        url:'https://optcorp.com/cart/add.js',
        data:{
  
          quantity:1,
          id:id 
        },
        async:false
      })
  
  
      }).promise().done( window.location.href = "https://optcorp.com/cart");
  
    }
  
    function rmAll(){
      $(".iwishRemoveBtn").each(function(){ 
        $(this).trigger('click')
      });
    };
  
    jQuery(window).on('load', function(){
      setTimeout(() => {
        var img = "{{'images.svg' | asset_url }}";
        var html = `<a class="drag_file"><img src="${img}">Click to upload one or more images</a>`;
        $('.finance-two-template .globo-formbuilder .g-container input[type="file"]').before(html);
        $('.finance-two-template .globo-formbuilder .message.success a').addClass('active');
        $('.finance-two-template .globo-formbuilder .message.success a').removeAttr('target')
        $('.drag_file').on('click', function (e) {
          e.preventDefault();
          $(this).parent().find('input[type="file"]').trigger('click').bind('change', function () {
            var filename = $("#chooseFile").val();
            
            if (/^\s*$/.test(filename)) {
              console.log("no file")
            }
            else {
              var img = "{{'images.svg' | asset_url }}";
              var html = `<img src="${img}">One file added!`;
              $('.drag_file').html(html);
              $('.drag_file').addClass('disable');
            }
          });;
        })
      }, 2500);
      
    })
  
    $(document).ready(function () {
      var navListItems = $('div.setup-panel div a'),
              allWells = $('.setup-content'),
              allNextBtn = $('.nextBtn'),
              allPrevBtn = $('.prevBtn');
  
      allWells.hide();
  
      navListItems.click(function (e) {
          e.preventDefault();
          var $target = $($(this).attr('href')),
                  $item = $(this);
  
          if (!$item.hasClass('disabled')) {
              navListItems.removeClass('btn-primary').addClass('btn-default');
              $item.addClass('btn-primary');
              allWells.hide();
              $target.show();
              $target.find('input:eq(0)').focus();
          }
      });
  
      allNextBtn.click(function(){
          var curStep = $(this).closest(".setup-content"),
              curStepBtn = curStep.attr("id"),
              nextStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().next().children("a");
          nextStepWizard.removeAttr('disabled').trigger('click');
      });
  
      allPrevBtn.click(function(){
          var curStep = $(this).closest(".setup-content"),
              curStepBtn = curStep.attr("id"),
              prevStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().prev().children("a");
          prevStepWizard.removeAttr('disabled').trigger('click');
      });
  
      $('div.setup-panel div a.btn-primary').trigger('click');
  });
  
